
	private function validatePolicyCredit($identificationNumber, $subsidiaryCityName)
	{
		$queryScoreClient = DB::connection('oportudata')->select("SELECT score FROM cifin_score WHERE scocedula = :identificationNumber ORDER BY scoconsul DESC LIMIT 1 ", ['identificationNumber' => $identificationNumber]);

		if (empty($queryScoreClient)) {
			return false;
		} else {
			$respScoreClient = $queryScoreClient[0]->score;

			/*$queryScoreCreditPolicy = DB::connection('mysql')->select("SELECT score FROM credit_policy LIMIT 1");
			$respScoreCreditPolicy = $queryScoreCreditPolicy[0]->score;*/
			$scoreMin = 528;
			if ($subsidiaryCityName == 'MEDELLÃN' || $subsidiaryCityName == 'BOGOTÃ') {
				$scoreMin = 726;
			}

			if ($respScoreClient >= -7 && $respScoreClient <= 0) {
				return true;
			}

			if ($respScoreClient >= $scoreMin) {
				return true;
			} else {
				$updateLeadState = DB::connection('oportudata')->select('UPDATE `CLIENTE_FAB` SET `ESTADO` = "RECHAZADO" WHERE `CEDULA` = :identificationNumber', ['identificationNumber' => $identificationNumber]);
				return false;
			}
		}
	}



	public function execCreditPolicy($identificationNumber)
	{
		$aprobado =  $this->UpToDateFinancialCifinInterface->check12MonthsPaymentVector($identificationNumber);

		if ($aprobado == false) {
			return -1; // Credito negado
		}

		// Negacion, codicion 2, saldo en mora
		$TotalCustomerCifinFinancialArrears = $this->CifinFinancialArrearsInterface->checkCustomerHasCifinFinancialArrear($identificationNumber)->sum('finvrmora');

		// $queryValorMoraFinanciero = sprintf("SELECT SUM(`finvrmora`) as totalMoraFin
		// FROM `cifin_finmora`
		// WHERE `finconsul` = (SELECT MAX(`finconsul`) FROM `cifin_finmora` WHERE `fincedula` = %s )
		// AND `fincedula` = %s AND `fincalid` != 'CODE' AND `fintipocon` != 'SRV' ", $identificationNumber, $identificationNumber);
		// $respValorMoraFinanciero = DB::connection('oportudata')->select($queryValorMoraFinanciero);


		$totalCustomerCifinRealArrears = $this->cifinRealArrearsInterface->checkCustomerHasCifinRealArrear($identificationNumber)->sum('rmvrmora');

		// $queryValorMoraReal = sprintf("SELECT SUM(`rmvrmora`) as totalMoraReal
		// FROM `cifin_realmora`
		// WHERE `rmconsul` = (SELECT MAX(`rmconsul`) FROM `cifin_realmora` WHERE `rmcedula` = %s )
		// AND `rmcedula` = %s AND (`rmtipoent` != 'COMU' OR `rmcalid` != 'CODE') AND `rmtipocon` != 'SRV' ", $identificationNumber, $identificationNumber);
		// $respValorMoraReal = DB::connection('oportudata')->select($queryValorMoraReal);
		// $totalValorMora = $respValorMoraFinanciero[0]->totalMoraFin + $respValorMoraReal[0]->totalMoraReal;

		$totalValorMora = $TotalCustomerCifinFinancialArrears + $totalCustomerCifinRealArrears;

		if ($totalValorMora > 100) {
			return -2; // Credito negado
		}

		return 1300000;
	}
