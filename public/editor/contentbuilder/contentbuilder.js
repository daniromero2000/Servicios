for(var cb_list="",cb_edit=!0,cb_snippetList="#divSnippetList",cb_snippetPageSliding=!1,oScripts=document.getElementsByTagName("script"),sScriptPath,i=0;i<oScripts.length;i++){var sSrc=oScripts[i].src.toLowerCase();-1!=sSrc.indexOf("contentbuilder-src.js")&&(sScriptPath=oScripts[i].src.replace(/contentbuilder-src.js/,"")),-1!=sSrc.indexOf("contentbuilder.js")&&(sScriptPath=oScripts[i].src.replace(/contentbuilder.js/,""))}var sScriptPathArray=sScriptPath.split("?");sScriptPath=sScriptPathArray[0];var sc=document.createElement("script");sc.src=sScriptPath+"load-image.all.min.js",document.getElementsByTagName("head")[0].appendChild(sc);var sc2=document.createElement("link");sc2.rel="stylesheet",sc2.type="text/css",sc2.href=sScriptPath+"codemirror/lib/codemirror.css";var verufyChanges=!1,elementGlobal="";function editorInit(t,e){var i={snippetFile:e,snippetOpen:!0,toolbar:"left",iconselect:"assets/ionicons/selecticon.html",textAreaElement:elementGlobal=t},o=$("#"+i.textAreaElement).text();$("#"+i.textAreaElement).after('<div id="contentarea" class="is-container container-fluid">'+o+"</div>"),$("#"+i.textAreaElement).css("display","none"),$("#contentarea").contentbuilder(i)}function equalHtmlDivToText(t){var e=$("#contentarea").html();$("#"+elementGlobal).text(e)}function refreshAllObjects(){try{for(var t=cb_list.split(","),e=0;e<t.length;e++)jQuery(t[e]).data("contentbuilder").applyBehavior()}catch(t){}}document.getElementsByTagName("head")[0].appendChild(sc2),function(S){var b;S.contentbuilder=function(t,s){var r={selectable:"h1,h2,h3,h4,h5,h6,p,blockquote,ul,ol,small,.edit,td,i",editMode:"default",onChange:function(){},onRender:function(){},onDrop:function(){},onImageBrowseClick:function(){},onImageSettingClick:function(){},snippetFile:"assets/default/snippets.html",modulePath:"assets/modules/",snippetPathReplace:["",""],hiquality:!1,snippetTool:"right",snippetOpen:!1,snippetPageSliding:!1,scrollHelper:!1,snippetCategories:[[0,"Default"],[-1,"All"],[1,"Title"],[2,"Title, Subtitle"],[3,"Info, Title"],[4,"Info, Title, Subtitle"],[5,"Heading, Paragraph"],[6,"Paragraph"],[7,"Paragraph, Images + Caption"],[8,"Heading, Paragraph, Images + Caption"],[33,"Buttons"],[34,"Cards"],[9,"Images + Caption"],[10,"Images + Long Caption"],[11,"Images"],[12,"Single Image"],[13,"Call to Action"],[14,"List"],[15,"Quotes"],[16,"Profile"],[17,"Map"],[20,"Video"],[18,"Social"],[21,"Services"],[22,"Contact Info"],[23,"Pricing"],[24,"Team Profile"],[25,"Products/Portfolio"],[26,"How It Works"],[27,"Partners/Clients"],[28,"As Featured On"],[29,"Achievements"],[32,"Skills"],[30,"Coming Soon"],[31,"Page Not Found"],[19,"Separator"],[100,"Custom Code"]],addSnippetCategories:[],snippetCustomCode:!1,snippetCustomCodeMessage:"<b>IMPORTANT</b>: This is a code block. Custom javascript code (&lt;script&gt; block) is allowed here but may not always work or compatible with the content builder, so proceed at your own risk. We do not support problems with custom code.",imageselect:"",fileselect:"",onImageSelectClick:function(){},onFileSelectClick:function(){},iconselect:"",imageEmbed:!0,sourceEditor:!0,buttons:["bold","italic","formatting","textsettings","color","font","formatPara","align","list","table","image","createLink","unlink","icon","tags","removeFormat","html"],colors:["#ffffc5","#e9d4a7","#ffd5d5","#ffd4df","#c5efff","#b4fdff","#c6f5c6","#fcd1fe","#ececec","#f7e97a","#d09f5e","#ff8d8d","#ff80aa","#63d3ff","#7eeaed","#94dd95","#ef97f3","#d4d4d4","#fed229","#cc7f18","#ff0e0e","#fa4273","#00b8ff","#0edce2","#35d037","#d24fd7","#888888","#ff9c26","#955705","#c31313","#f51f58","#1b83df","#0bbfc5","#1aa71b","#ae19b4","#333333"],snippetList:"#divSnippetList",snippetCategoryList:"#divTool",toolbar:"top",toolbarDisplay:"auto",axis:"",hideDragPreview:!1,customval:"",largerImageHandler:"",absolutePath:!1,customTags:[],moduleConfig:[]};this.settings={};var k=S(t);t=t;this.undoList=[],this.redoList=[],this.init=function(){this.settings=S.extend({},r,s),-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&(this.settings.hideDragPreview=!0),k.addClass("connectSortable"),cb_list=""==cb_list?"#"+k.attr("id"):cb_list+",#"+k.attr("id"),cb_snippetList=this.settings.snippetList,cb_snippetPageSliding=this.settings.snippetPageSliding,0==S("#divCb").length&&S("body").append('<div id="divCb"></div>');for(var t=0;t<this.settings.addSnippetCategories.length;t++)this.settings.snippetCategories.push(this.settings.addSnippetCategories[t]);if(0==S(".is-snippet-list").length){var e="";if(0==this.settings.snippetCustomCode)for(t=0;t<this.settings.snippetCategories.length;t++)100==this.settings.snippetCategories[t][0]&&this.settings.snippetCategories.splice(t,1);for(e='<div id="divSnippetCat" style="display:none">Default <span class="caret"></span></div><div id="divSnippetCatOptions">',t=0;t<this.settings.snippetCategories.length;t++)e+='<div data-value="'+this.settings.snippetCategories[t][0]+'">'+this.settings.snippetCategories[t][1]+"</div>";if(e+="</div>","#divSnippetList"==cb_snippetList){S("#divCb").append('<div id="divTool"></div>')}if(S(this.settings.snippetCategoryList).append(e),"#divSnippetList"==cb_snippetList){'<div id="divSnippetList"></div>','<a id="lnkToolOpen" href="#"><i class="cb-icon-left-open-big" style="font-size: 15px;"></i></a>';S("#divTool").append('<div id="divToolWait" style="position:absolute;top:0;left:0;width:100%;height:100%;display:table;background:rgba(255,255,255,0.2);z-index:1;"><div style="display:table-cell;vertical-align:middle;text-align:center;background:rgb(217, 217, 217);"><div class="loading"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div></div><div id="divSnippetList"></div><a id="lnkToolOpen" href="#"><i class="cb-icon-left-open-big" style="font-size: 15px;"></i></a>'),S("#divCb").append('<div id="divSnippetScrollUp" style="display:none;background:rgba(0,0,0,0.3);width:45px;height:45px;line-height:45px;color:#eee;position:fixed;z-index:100000;border-radius:8px;text-align:center;font-size:12px;cursor:pointer;font-family:sans-serif;">&#9650;</div><div id="divSnippetScrollDown" style="display:none;background:rgba(0,0,0,0.3);width:45px;height:45px;line-height:45px;color:#eee;position:fixed;z-index:100000;border-radius:8px;text-align:center;font-size:12px;cursor:pointer;font-family:sans-serif;">&#9660;</div>');var i=1e8;S("#divSnippetScrollUp").css("display","none"),S("#divSnippetScrollUp").on("click touchup",function(t){return S("#divSnippetList").animate({scrollTop:S("#divSnippetList").scrollTop()-(S("#divSnippetList").height()-150)+"px"},300,function(){0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetList").scrollTop()!=i?S("#divSnippetScrollDown").fadeIn(300):S("#divSnippetScrollDown").fadeOut(300)}),t.preventDefault(),t.stopImmediatePropagation(),!1}),S("#divSnippetScrollDown").on("click touchup",function(t){return S("#divSnippetList").animate({scrollTop:S("#divSnippetList").scrollTop()+(S("#divSnippetList").height()-150)+"px"},300,function(){0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),1e8==i&&(i=S("#divSnippetList").prop("scrollHeight")-S("#divSnippetList").height()-10),S("#divSnippetList").scrollTop()!=i?S("#divSnippetScrollDown").fadeIn(300):S("#divSnippetScrollDown").fadeOut(300)}),t.preventDefault(),t.stopImmediatePropagation(),!1});var o=S(window).width(),a=255;o<600&&(a=150);var n=this.settings.scrollHelper;(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))&&(n=!0),"right"==this.settings.snippetTool?(S("#divSnippetScrollUp").css("right","10px"),S("#divSnippetScrollDown").css("right","10px"),"0px"!=S("#divTool").css("right")&&(S("#divTool").css("width",a+"px"),S("#divTool").css("right","-"+a+"px")),S("#lnkToolOpen").off("click"),S("#lnkToolOpen").click(function(t){if(S(".row-tool").stop(!0,!0).fadeOut(0),S(".ui-draggable").removeClass("ui-dragbox-outlined"),S("#rte-toolbar").css("display","none"),S(".rte-pop").css("display","none"),cb_snippetPageSliding||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){if(0==parseInt(S("#divTool").css("right")))S("#divTool").animate({right:"-="+a+"px"},200),S("body").animate({marginRight:"-="+a+"px"},250),S("#rte-toolbar").animate({paddingRight:"-="+a+"px"},250),S("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeOut(300);else if(S("#divTool").animate({right:"+="+a+"px"},200),S("body").animate({marginRight:"+="+a+"px"},250),S("#rte-toolbar").animate({paddingRight:"+="+a+"px"},250),S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),n){var e=S("#divSnippetList").height()/2-60;S("#divSnippetScrollUp").css("top",e),S("#divSnippetScrollDown").css("top",e+60),0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeIn(300)}S("#rte-toolbar").css("display","none")}else if(0==parseInt(S("#divTool").css("right")))S("#divTool").animate({right:"-="+a+"px"},200),S("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),S("#divSnippetScrollUp").css("display","none"),S("#divSnippetScrollDown").css("display","none");else if(S("#divTool").animate({right:"+="+a+"px"},200),S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),n){e=S("#divSnippetList").height()/2-60;S("#divSnippetScrollUp").css("top",e),S("#divSnippetScrollDown").css("top",e+60),0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeIn(300)}t.preventDefault()}),S(".row-tool").css("right","auto"),o<600?S(".row-tool").css("left","-30px"):S(".row-tool").css("left","-37px"),this.settings.snippetOpen&&1!=S("#divTool").attr("data-snip-open")&&(S("#divTool").attr("data-snip-open",1),S("#divTool").animate({right:"+="+a+"px"},900),S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"))):(S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),S("#divSnippetScrollUp").css("left","10px"),S("#divSnippetScrollDown").css("left","10px"),S("#divTool").css("width",a+"px"),S("#divTool").css("left","-"+a+"px"),S("#lnkToolOpen").addClass("leftside"),S("#lnkToolOpen").off("click"),S("#lnkToolOpen").click(function(t){if(S(".row-tool").stop(!0,!0).fadeOut(0),S(".ui-draggable").removeClass("ui-dragbox-outlined"),S("#rte-toolbar").css("display","none"),S(".rte-pop").css("display","none"),cb_snippetPageSliding||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){if(0==parseInt(S("#divTool").css("left")))S("#divTool").animate({left:"-="+(a+0)+"px"},200),S("body").animate({marginLeft:"-="+a+"px"},250),S("#rte-toolbar").animate({paddingLeft:"-="+a+"px"},250),S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeOut(300);else if(S("#divTool").animate({left:"+="+(a+0)+"px"},200),S("body").animate({marginLeft:"+="+a+"px"},250),S("#rte-toolbar").animate({paddingLeft:"+="+a+"px"},250),S("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),n){var e=S("#divSnippetList").height()/2-60;S("#divSnippetScrollUp").css("top",e),S("#divSnippetScrollDown").css("top",e+60),0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeIn(300)}S("#rte-toolbar").css("display","none"),S(".rte-pop").css("display","none")}else if(0==parseInt(S("#divTool").css("left")))S("#divTool").animate({left:"-="+(a+0)+"px"},200),S("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),S("#divSnippetScrollUp").css("display","none"),S("#divSnippetScrollDown").css("display","none");else if(S("#divTool").animate({left:"+="+(a+0)+"px"},200),S("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),n){e=S("#divSnippetList").height()/2-60;S("#divSnippetScrollUp").css("top",e),S("#divSnippetScrollDown").css("top",e+60),0!=S("#divSnippetList").scrollTop()?S("#divSnippetScrollUp").fadeIn(300):S("#divSnippetScrollUp").fadeOut(300),S("#divSnippetScrollDown").fadeIn(300)}t.preventDefault()}),S(".row-tool").css("left","auto"),o<600?S(".row-tool").css("right","-30px"):S(".row-tool").css("right","-37px"),this.settings.snippetOpen&&1!=S("#divTool").attr("data-snip-open")&&(S("#divTool").attr("data-snip-open",1),S("#divTool").animate({left:"+="+a+"px"},900),S("#lnkToolOpen i").attr("class","cb-icon-left-open-big")))}S(cb_snippetList).addClass("is-snippet-list"),S("#divSnippetCat").click(function(t){S("#divSnippetCatOptions").hasClass("active")?S("#divSnippetCatOptions").removeClass("active"):(S("#divSnippetCatOptions").css("width",S(this).css("width")),S("#divSnippetCatOptions").addClass("active")),t.preventDefault(),t.stopImmediatePropagation()}),S("#divSnippetCatOptions > div").click(function(){var o=S(this).attr("data-value");S("#divSnippetCat").html(S(this).html()+' <span class="caret"></span>'),S("#divSnippetCatOptions").removeClass("active");var t=S(cb_snippetList+" > div");"-1"==o?t.fadeIn(200):t.fadeOut(200,function(){for(var t=S(this),e=t.attr("data-cat").split(","),i=0;i<e.length;i++)o==e[i]&&t.fadeIn(400)})}),$("html").click(function(t){return!(0<$(t.target).parents("#divSnippetCatOptions").length)&&("divSnippetCatOptions"!=$(t.target).attr("id")&&(!(0<$(t.target).parents("#divSnippetCat").length)&&("divSnippetCat"!=$(t.target).attr("id")&&void S("#divSnippetCatOptions").removeClass("active"))))}),S("#divCb").append('<div id="divSnippets" style="display:none"></div>'),S.get(this.settings.snippetFile,function(t){var e="",i="",o=1,a=!1;try{if(""!=k.data("contentbuilder").settings.snippetPathReplace[0]){var n=new RegExp(k.data("contentbuilder").settings.snippetPathReplace[0],"g");t=t.replace(n,k.data("contentbuilder").settings.snippetPathReplace[1]);var s=k.data("contentbuilder").settings.snippetPathReplace[0].replace(/\//g,"%2F"),r=k.data("contentbuilder").settings.snippetPathReplace[1].replace(/\//g,"%2F"),l=new RegExp(s,"g");t=t.replace(l,r)}}catch(t){}var d=S("<div/>").html(t).children("div");for(o=1;d.length>=o;o++){var c=(u=S(d[o-1])).html();e+='<div id="snip'+o+'">'+S("<div/>").text(c).html()+"</div>",null!=u.data("cat")&&(a=!0);var m=u.data("thumb");i+=a?'<div style="display:none" title="Snippet '+o+'" data-snip="'+o+'" data-cat="'+u.data("cat")+'"><img src="'+m+'" /></div>':'<div title="Snippet '+o+'" data-snip="'+o+'" data-cat="'+u.data("cat")+'"><img src="'+m+'" /></div>'}if(S("#divSnippets").html(e),S(cb_snippetList).html(i),a){for(var p=[],g=!1,h=S(cb_snippetList+" > div"),f=0;h.length>f;f++)for(var u,v=(u=S(h[f])).attr("data-cat").split(","),b=0;b<v.length;b++){0==(x=u.attr("data-cat").split(",")[b])&&(u.fadeIn(400),g=!0),-1==S.inArray(x,p)&&(p.push(x),0==S("#divSnippetCatOptions").find("[data-value='"+x+"']").length&&u.remove())}for(var C=S("#divSnippetCatOptions"),w=S("#divSnippetCatOptions > div"),y=0;w.length>y;y++){var x=S(w[y]).attr("data-value");-1==S.inArray(x,p)&&0!=x&&-1!=x&&C.find("[data-value='"+x+"']").remove()}g||(S(cb_snippetList+" > div").css("display","block"),S("#divSnippetCatOptions").find("[data-value='0']").remove(),S("#divSnippetCat").html('All <span class="caret"></span>')),S("#divSnippetCat").css("display","block")}"#divSnippetList"==cb_snippetList&&a&&S("#divSnippetList").css("border-top","rgba(0,0,0,0) 52px solid"),k.data("contentbuilder").applyDraggable(),S("#divToolWait").remove()})}else this.applyDraggable();k.children("*").wrap("<div class='ui-draggable'></div>"),k.children("*").append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>'),0==S("#temp-contentbuilder").length&&S("#divCb").append('<div id="temp-contentbuilder" style="display: none"></div>'),this.applyBehavior(),this.blockChanged(),this.settings.onRender(),k.sortable({helper:function(t,e){var i=S(e).clone();return i.css("position","absolute"),i.addClass("cloned-handler"),""==k.data("contentbuilder").settings.axis&&(i.parent().is("body")||i.appendTo(S("body"))),i.get(0)},sort:function(t,e){k.data("contentbuilder").settings.hideDragPreview&&e.helper.css({display:"none"})},items:".ui-draggable",connectWith:".connectSortable",distance:5,tolerance:"pointer",handle:".row-handle",delay:200,cursor:"move",placeholder:"block-placeholder",start:function(t,e){S(e.placeholder).hide(),S(e.placeholder).slideUp(80),cb_edit=!1},change:function(t,e){S(e.placeholder).hide().slideDown(80)},beforeStop:function(t,e){S(e.placeholder).hide()},deactivate:function(t,e){if(S(".cloned-handler").remove(),k.data("contentbuilder")){cb_edit=!0;0==e.item.find(".row-tool").length&&!0,e.item.parent().attr("id")==k.attr("id")&&(e.item.find("[data-html]").each(function(){var t=decodeURIComponent(S(this).attr("data-html"));S(this).html(t)}),e.item.replaceWith(e.item.html()),k.children("*").each(function(){S(this).hasClass("ui-draggable")||S(this).wrap("<div class='ui-draggable'></div>")}),k.children(".ui-draggable").each(function(){0==S(this).find(".row-tool").length&&S(this).append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>')}),k.children(".ui-draggable").each(function(){1==S(this).children("*").length&&S(this).remove(),2==S(this).children("*").length&&"img"==S(this).children(0).prop("tagName").toLowerCase()&&-1!=S(this).children(0).attr("src").indexOf("thumbnails/")&&S(this).remove()}),k.data("contentbuilder").settings.onDrop(t,e),k.data("contentbuilder").applyBehavior(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender(),k.data("contentbuilder").settings.onChange(),saveForUndo())}}}),-1!=cb_list.indexOf(",")&&S(cb_list).sortable("option","axis",!1),""!=this.settings.axis&&S(cb_list).sortable("option","axis",this.settings.axis),S.ui.isOverAxis2=function(t,e,i){return e<=t&&t<e+i},S.ui.isOver=function(t,e,i,o,a,n){return S.ui.isOverAxis2(t,i,a)&&S.ui.isOverAxis(e,o,n)},k.droppable({drop:function(t,e){if(S(e.draggable).data("snip")){var i=S(e.draggable).data("snip"),o=S("#snip"+i).text();return o=o.replace(/{id}/g,makeid()),S(e.draggable).data("snip",null),e.draggable.html(o)}},tolerance:"pointer",greedy:!0,hoverClass:"drop-zone",activeClass:"drop-zone",deactivate:function(t,e){S(cb_list).each(function(){var t=S(this);t.children(".ui-draggable").each(function(){0==S(this).find(".row-tool").length&&S(this).append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>')}),t.data("contentbuilder").applyBehavior()})}}),S(document).on("mousedown",function(t){var e;if(0<S(t.target).parents(".ui-draggable").length&&S(t.target).parents(".ui-draggable").parent().data("contentbuilder")&&(e=S(t.target).parents(".ui-draggable").parent()),"ovl"==S(t.target).attr("class")&&S(t.target).css("z-index","-1"),0<S(t.target).parents(".ui-draggable").length&&0<S(t.target).parents(cb_list).length){var i=-1<navigator.userAgent.toLowerCase().indexOf("firefox");return 0<S(t.target).parents("[data-html]").length&&(S(t.target).parents(".ui-draggable").addClass("code"),S(t.target).parents(".ui-draggable").find(".row-tool .row-html").addClass("row-module"),S(t.target).parents(".ui-draggable").find(".row-tool .cb-icon-code").removeClass("cb-icon-code").addClass("cb-icon-cog")),0<S(t.target).parents("[data-mode='readonly']").length&&(S(t.target).parents(".ui-draggable").addClass("code"),S(t.target).parents(".ui-draggable").find(".row-tool .row-html").css("display","none")),0<S(t.target).parents("[data-mode='readonly-protected']").length&&(S(t.target).parents(".ui-draggable").addClass("code"),S(t.target).parents(".ui-draggable").find(".row-tool .row-html").css("display","none"),S(t.target).parents(".ui-draggable").find(".row-tool .row-remove").css("display","none"),S(t.target).parents(".ui-draggable").find(".row-tool .row-copy").css("display","none")),S(".ui-draggable").removeClass("ui-dragbox-outlined"),S(t.target).parents(".ui-draggable").addClass("ui-dragbox-outlined"),i&&S(t.target).parents(".ui-draggable").addClass("firefox"),S(".row-tool").stop(!0,!0).fadeOut(0),e&&(0<S(t.target).parents(".ui-draggable").find("[data-html-edit='off']").length||!e.data("contentbuilder").settings.sourceEditor)&&S(t.target).parents(".ui-draggable").find(".row-tool .row-html").css({display:"none"}),void S(t.target).parents(".ui-draggable").find(".row-tool").stop(!0,!0).css({display:"none"}).fadeIn(300)}if(!("rte-toolbar"==S(t.target).parent().attr("id")||"rte-toolbar"==S(t.target).parent().parent().attr("id")||S(t.target).parent().hasClass("rte-pop")||S(t.target).parent().parent().hasClass("rte-pop")||S(t.target).parent().hasClass("md-modal")||S(t.target).is("[contenteditable]")||"absolute"==S(t.target).css("position")||"fixed"==S(t.target).css("position")||S(t.target).hasClass("md-modal"))){var o=!1;S(t.target).parents().each(function(t){(S(this).is("[contenteditable]")||"absolute"==S(this).css("position")||"fixed"==S(this).css("position")||S(this).hasClass("md-modal"))&&(o=!0)}),o||(S(".row-tool").stop(!0,!0).fadeOut(0),S(".ui-draggable").removeClass("ui-dragbox-outlined"),S("#rte-toolbar").css("display","none"),S(".rte-pop").css("display","none"))}})},this.applyDraggable=function(t){var e=!1;"1.11.0"==S.ui.version&&(e=!0),e?S(cb_snippetList+" > div").draggable({cursor:"move",helper:function(){return S("<div class='dynamic'></div>")[0]},delay:200,connectToSortable:cb_list,stop:function(t,e){S(cb_list).each(function(){S(this).children("div").each(function(){1==S(this).children("img").length&&S(this).remove()})})}}):S(cb_snippetList+" > div").draggable({cursor:"move",helper:"clone",drag:function(t,e){S(e.helper).css("overflow","hidden"),S(e.helper).css("padding-top","60px"),S(e.helper).css("box-sizing","border-box"),S(e.helper).css("width","150px"),S(e.helper).css("height","60px"),S(e.helper).css("border","rgba(225,225,225,0.9) 5px solid"),S(e.helper).css("background","rgba(225,225,225,0)")},connectToSortable:cb_list,stop:function(t,e){S(cb_list).each(function(){S(this).children("div").each(function(){1==S(this).children("img").length&&S(this).remove()})})}})},this.html=function(){this.settings.absolutePath&&(k.find("a").each(function(){var t=S(this).get(0).href;S(this).attr("href",t)}),k.find("img").each(function(){var t=S(this).get(0).src;S(this).attr("src",t)})),S("#temp-contentbuilder").html(k.html()),S("#temp-contentbuilder").find(".row-tool").remove(),S("#temp-contentbuilder").find(".ovl").remove(),S("#temp-contentbuilder").find("[contenteditable]").removeAttr("contenteditable"),S('*[class=""]').removeAttr("class"),S("#temp-contentbuilder").find(".ui-draggable").replaceWith(function(){return S(this).html()}),S("#temp-contentbuilder").find("[data-html]").each(function(){null!=S(this).attr("data-html")&&S(this).html(decodeURIComponent(S(this).attr("data-html")))});var t=S("#temp-contentbuilder").html().trim();return t=t.replace(/<font/g,"<span").replace(/<\/font/g,"</span")},this.clearControls=function(){S(".row-tool").stop(!0,!0).fadeOut(0),S(".ui-draggable").removeClass("ui-dragbox-outlined");var t=this.settings.selectable;k.find(t).blur()},this.viewHtml=function(){var e=this.html();if(S("#txtHtml").val(e),S("#md-html").css("width","80%"),S("#md-html").simplemodal({isModal:!0}),S("#md-html").data("simplemodal").show(),S("#txtHtml").css("display","none"),S("#txtHtml").data("CodeMirrorInstance")){(t=$("#txtHtml").data("CodeMirrorInstance")).setValue(e)}else{var t,i=S("#txtHtml")[0];if(0==S(".is-cmloaded").length)getScripts([sScriptPath+"codemirror/lib/codemirror.js"],function(){getScripts([sScriptPath+"codemirror/mode/xml/xml.js",sScriptPath+"codemirror/mode/javascript/javascript.js",sScriptPath+"codemirror/mode/css/css.js"],function(){S("body").addClass("is-cmloaded");var t=CodeMirror.fromTextArea(i,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"});t.on("change",function(t,e){S("#txtHtml").val(t.getValue())}),S("#txtHtml").data("CodeMirrorInstance",t)})});else(t=CodeMirror.fromTextArea(i,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"})).on("change",function(t,e){S("#txtHtml").val(t.getValue())}),S("#txtHtml").data("CodeMirrorInstance",t)}S("#btnHtmlOk").off("click"),S("#btnHtmlOk").on("click",function(t){var e=$("#txtHtml").data("CodeMirrorInstance");S("#txtHtml").val(e.getValue()),k.html(S("#txtHtml").val()),S("#md-html").data("simplemodal").hide(),k.children("*").wrap("<div class='ui-draggable'></div>"),k.children("*").append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>'),k.data("contentbuilder").applyBehavior(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender(),k.data("contentbuilder").settings.onChange(),saveForUndo()}),S("#btnHtmlCancel").off("click"),S("#btnHtmlCancel").on("click",function(t){S("#md-html").data("simplemodal").hide()})},this.loadHTML=function(t){k.html(t),k.children("*").wrap("<div class='ui-draggable'></div>"),k.children("*").append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>'),k.data("contentbuilder").applyBehavior(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender()},this.applyBehavior=function(){k.find("a").click(function(){return!1}),this.settings.absolutePath&&(k.find("a").each(function(){var t=S(this).get(0).href;S(this).attr("href",t)}),k.find("img").each(function(){var t=S(this).get(0).src;S(this).attr("src",t)}));var t=this.settings.selectable,e=this.settings.hiquality,i=this.settings.imageEmbed,o=this.settings.buttons,a=this.settings.colors,n=this.settings.editMode,s=this.settings.toolbar,r=this.settings.toolbarDisplay,l=this.settings.onImageSelectClick,d=this.settings.onFileSelectClick,c=this.settings.onImageBrowseClick,m=this.settings.onImageSettingClick,p=this.settings.customTags,g=this.settings.imageselect,h=this.settings.fileselect,f=this.settings.iconselect,u=this.settings.customval,v=this.settings.largerImageHandler;k.contenteditor({fileselect:h,imageselect:g,iconselect:f,onChange:function(){k.data("contentbuilder").settings.onChange()},editable:t,buttons:o,colors:a,editMode:n,toolbar:s,toolbarDisplay:r,onFileSelectClick:d,onImageSelectClick:l,customTags:p}),k.data("contenteditor").render(),k.find("img").each(function(){0<S(this).parents("[data-html]").length||0<S(this).parents("[data-mode='readonly']").length||0<S(this).parents("[data-mode='readonly-protected']").length||(S(this).imageembed({hiquality:e,imageselect:g,fileselect:h,imageEmbed:i,onImageBrowseClick:c,onImageSettingClick:m,onImageSelectClick:l,onFileSelectClick:d,largerImageHandler:v,customval:u}),0!=S(this).parents("figure").length&&"absolute"==S(this).parents("figure").find("figcaption").css("position")&&S(this).parents("figure").imageembed({hiquality:e,imageselect:g,fileselect:h,imageEmbed:i,onImageBrowseClick:c,onImageSettingClick:m,onImageSelectClick:l,onFileSelectClick:d,largerImageHandler:v,customval:u}))}),k.find(".embed-responsive").each(function(){0<S(this).parents("[data-html]").length||0<S(this).parents("[data-mode='readonly']").length||0<S(this).parents("[data-mode='readonly-protected']").length||0==S(this).find(".ovl").length&&S(this).append('<div class="ovl" style="position:absolute;background:#fff;opacity:0.2;cursor:pointer;top:0;left:0px;width:100%;height:100%;z-index:-1"></div>')}),k.on("mouseenter mouseleave",".embed-responsive",function(t){switch(t.type){case"mouseenter":if(0<S(this).parents("[data-html]").length)return;if(0<S(this).parents("[data-mode='readonly']").length)return;if(0<S(this).parents("[data-mode='readonly-protected']").length)return;"none"==S(this).parents(".ui-draggable").css("outline-style")&&S(this).find(".ovl").css("z-index","1");break;case"mouseleave":S(this).find(".ovl").css("z-index","-1")}}),k.find(t).off("focus"),k.find(t).focus(function(){k.data("contentbuilder").settings.selectable;var t=-1<navigator.userAgent.toLowerCase().indexOf("firefox");S(".ui-draggable").removeClass("code"),0<S(this).parents("[data-html]").length&&S(this).parents(".ui-draggable").addClass("code"),0<S(this).parents("[data-mode='readonly']").length&&S(this).parents(".ui-draggable").addClass("code"),0<S(this).parents("[data-mode='readonly-protected']").length&&S(this).parents(".ui-draggable").addClass("code"),S(".ui-draggable").removeClass("ui-dragbox-outlined"),S(this).parents(".ui-draggable").addClass("ui-dragbox-outlined"),t&&S(this).parents(".ui-draggable").addClass("firefox"),S(".row-tool").stop(!0,!0).fadeOut(0),(0<S(this).parents(".ui-draggable").find("[data-html-edit='off']").length||!k.data("contentbuilder").settings.sourceEditor)&&S(this).parents(".ui-draggable").find(".row-tool .row-html").css({display:"none"}),S(this).parents(".ui-draggable").find(".row-tool").stop(!0,!0).css({display:"none"}).fadeIn(300)}),k.children("div").find(".row-remove").off("click"),k.children("div").find(".row-remove").click(function(){S("#md-delrowconfirm").css("max-width","550px"),S("#md-delrowconfirm").simplemodal(),S("#md-delrowconfirm").data("simplemodal").show(),b=S(this).parents(".ui-draggable"),S("#btnDelRowOk").off("click"),S("#btnDelRowOk").on("click",function(t){S("#md-delrowconfirm").data("simplemodal").hide(),b.fadeOut(400,function(){S("#divToolImg").stop(!0,!0).fadeOut(0),S("#divToolImgSettings").stop(!0,!0).fadeOut(0),S("#divRteLink").stop(!0,!0).fadeOut(0),S("#divFrameLink").stop(!0,!0).fadeOut(0),b.remove(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender(),k.data("contentbuilder").settings.onChange(),saveForUndo()})}),S("#btnDelRowCancel").off("click"),S("#btnDelRowCancel").on("click",function(t){S("#md-delrowconfirm").data("simplemodal").hide()})}),k.children("div").find(".row-copy").off("click"),k.children("div").find(".row-copy").click(function(){b=S(this).parents(".ui-draggable"),S("#temp-contentbuilder").html(b.html()),S("#temp-contentbuilder").find("[contenteditable]").removeAttr("contenteditable"),S('#temp-contentbuilder *[class=""]').removeAttr("class"),S('#temp-contentbuilder *[style=""]').removeAttr("style"),S("#temp-contentbuilder .ovl").remove(),S("#temp-contentbuilder .row-tool").remove();var t=S("#temp-contentbuilder").html().trim();b.after(t),k.children("*").each(function(){S(this).hasClass("ui-draggable")||S(this).wrap("<div class='ui-draggable'></div>")}),k.children(".ui-draggable").each(function(){0==S(this).find(".row-tool").length&&S(this).append('<div class="row-tool"><div class="row-handle"><i class="cb-icon-move"></i></div><div class="row-html"><i class="cb-icon-code"></i></div><div class="row-copy"><i class="cb-icon-plus"></i></div><div class="row-remove"><i class="cb-icon-cancel"></i></div></div>')}),k.children(".ui-draggable").each(function(){1==S(this).children("*").length&&S(this).remove()}),k.data("contentbuilder").applyBehavior(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender(),k.data("contentbuilder").settings.onChange(),saveForUndo()}),k.children("div").find(".row-html").off("click"),k.children("div").find(".row-html").click(function(){if(0<(b=S(this).parents(".ui-draggable")).find("[data-html]").length){var i=b.find("[data-html]");S("body").find("[data-html]").removeAttr("data-module-active"),i.attr("data-module-active","1");var t=i.attr("data-module");if("code"==i.attr("data-mode")&&(t="code"),"code"==t){S("#infoSource").html(k.data("contentbuilder").settings.snippetCustomCodeMessage);var e=decodeURIComponent(i.attr("data-html"));S("#txtContentCustomCode").val(e);var o="900px";if(S("#md-editcontentcustomcode").css("width","100%"),S("#md-editcontentcustomcode").css("max-width",o),S("#md-editcontentcustomcode").simplemodal({isModal:!0}),S("#md-editcontentcustomcode").data("simplemodal").show(),S("#txtContentCustomCode").data("CodeMirrorInstance")){(a=$("#txtContentCustomCode").data("CodeMirrorInstance")).setValue(e)}else{var a,n=S("#txtContentCustomCode")[0];if(0==S(".is-cmloaded").length)getScripts([sScriptPath+"codemirror/lib/codemirror.js"],function(){getScripts([sScriptPath+"codemirror/mode/xml/xml.js",sScriptPath+"codemirror/mode/javascript/javascript.js",sScriptPath+"codemirror/mode/css/css.js"],function(){S("body").addClass("is-cmloaded");var t=CodeMirror.fromTextArea(n,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"});t.on("change",function(t,e){S("#hidContentCustomCode").val(t.getValue())}),S("#txtContentCustomCode").data("CodeMirrorInstance",t)})});else(a=CodeMirror.fromTextArea(n,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"})).on("change",function(t,e){S("#hidContentCustomCode").val(t.getValue())}),S("#txtContentCustomCode").data("CodeMirrorInstance",a)}S("#btnContentCustomCodeOk").off("click"),S("#btnContentCustomCodeOk").on("click",function(t){var e=$("#txtContentCustomCode").data("CodeMirrorInstance");S("#hidContentCustomCode").val(e.getValue()),i.attr("data-html",encodeURIComponent(S("#hidContentCustomCode").val())),i.html(S("#hidContentCustomCode").val()),S("#md-editcontentcustomcode").data("simplemodal").hide(),k.data("contentbuilder").settings.onChange(),saveForUndo()}),S("#btnContentCustomCodeCancel").off("click"),S("#btnContentCustomCodeCancel").on("click",function(t){S("#md-editcontentcustomcode").data("simplemodal").hide()})}else{var s=i.attr("data-module-desc");s?S("#md-editcontentmodule").find(".md-title").html(s):S("#md-editcontentmodule").find(".md-title").html("Module Settings"),(o=i.attr("data-dialog-width"))&&""!=o||(o="65%"),S("#md-editcontentmodule").css("width","100%"),S("#md-editcontentmodule").css("max-width",o),S("#md-editcontentmodule").simplemodal({isModal:!0}),S("#md-editcontentmodule").data("simplemodal").show(),S("#ifrContentModulePanel").attr("src",k.data("contentbuilder").settings.modulePath+t+".html"),S("#btnContentModuleOk").off("click"),S("#btnContentModuleOk").on("click",function(t){i.attr("data-html",encodeURIComponent(S("#hidContentModuleCode").val())),i.attr("data-settings",encodeURIComponent(S("#hidContentModuleSettings").val())),i.html(S("#hidContentModuleCode").val()),S("#md-editcontentmodule").data("simplemodal").hide(),k.data("contentbuilder").settings.onChange(),saveForUndo()}),S("#btnContentModuleCancel").off("click"),S("#btnContentModuleCancel").on("click",function(t){S("#md-editcontentmodule").data("simplemodal").hide()})}}else{if($activeCol=S(this).parents(".ui-draggable").children("*").not(".row-tool"),S("#md-html").css("width","60%"),S("#md-html").simplemodal({isModal:!0}),S("#md-html").data("simplemodal").show(),S("#temp-contentbuilder").html($activeCol.html()),S("#temp-contentbuilder").find("[contenteditable]").removeAttr("contenteditable"),S('#temp-contentbuilder *[class=""]').removeAttr("class"),S('#temp-contentbuilder *[style=""]').removeAttr("style"),S("#temp-contentbuilder .ovl").remove(),e=(e=S("#temp-contentbuilder").html().trim()).replace(/<font/g,"<span").replace(/<\/font/g,"</span"),S("#txtHtml").val(e),S("#txtHtml").css("display","none"),S("#txtHtml").data("CodeMirrorInstance")){(r=$("#txtHtml").data("CodeMirrorInstance")).setValue(e)}else{var r;n=S("#txtHtml")[0];if(0==S(".is-cmloaded").length)getScripts([sScriptPath+"codemirror/lib/codemirror.js"],function(){getScripts([sScriptPath+"codemirror/mode/xml/xml.js",sScriptPath+"codemirror/mode/javascript/javascript.js",sScriptPath+"codemirror/mode/css/css.js"],function(){S("body").addClass("is-cmloaded");var t=CodeMirror.fromTextArea(n,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"});t.on("change",function(t,e){S("#txtHtml").val(t.getValue())}),S("#txtHtml").data("CodeMirrorInstance",t)})});else(r=CodeMirror.fromTextArea(n,{value:e,mode:"text/html",lineWrapping:!0,lineNumbers:!0,tabMode:"indent"})).on("change",function(t,e){S("#txtHtml").val(t.getValue())}),S("#txtHtml").data("CodeMirrorInstance",r)}S("#btnHtmlOk").off("click"),S("#btnHtmlOk").on("click",function(t){var e=$("#txtHtml").data("CodeMirrorInstance");S("#txtHtml").val(e.getValue()),$activeCol.html(S("#txtHtml").val()),S("#md-html").data("simplemodal").hide(),k.data("contentbuilder").applyBehavior(),k.data("contentbuilder").blockChanged(),k.data("contentbuilder").settings.onRender(),k.data("contentbuilder").settings.onChange(),saveForUndo()}),S("#btnHtmlCancel").off("click"),S("#btnHtmlCancel").on("click",function(t){S("#md-html").data("simplemodal").hide()})}})},this.blockChanged=function(){equalHtmlDivToText(s.textAreaElement),0==k.children().length?k.addClass("empty"):k.removeClass("empty")},this.destroy=function(){if(k.data("contentbuilder")){var t=k.data("contentbuilder").html();k.html(t),k.sortable("destroy");for(var e=cb_list.split(","),i=[],o=0;o<e.length;o++)e[o]!="#"+k.attr("id")&&i.push(e[o]);cb_list=i.join(",");for(o=0;o<instances.length;o++)S(instances[o]).attr("id")==k.attr("id")&&instances.splice(o,1);k.removeClass("connectSortable"),k.css({"min-height":""}),k.removeData("contentbuilder"),k.removeData("contenteditor"),refreshAllObjects()}},this.init()},S.fn.contentbuilder=function(e){return this.each(function(){if(null==S(this).data("contentbuilder")){var t=new S.contentbuilder(this,e);S(this).data("contentbuilder",t)}saveForUndo()})}}(jQuery);var ce_toolbarDisplay="auto",ce_outline=!1,instances=[],savedSelPublic,savedSel;function ce_closePop(){jQuery(".rte-pop").css("display","none"),jQuery('[data-rte-cmd="formatting"]').removeClass("on"),jQuery('[data-rte-cmd="textsettings"]').removeClass("on"),jQuery('[data-rte-cmd="color"]').removeClass("on"),jQuery('[data-rte-cmd="font"]').removeClass("on"),jQuery('[data-rte-cmd="formatPara"]').removeClass("on"),jQuery('[data-rte-cmd="align"]').removeClass("on"),jQuery('[data-rte-cmd="list"]').removeClass("on"),jQuery('[data-rte-cmd="table"]').removeClass("on")}function pasteContent(t){var r=saveSelection();jQuery("#idContentWord").remove();var e=t.offset().top;jQuery("#divCb").append("<div style='position:absolute;z-index:-1000;top:"+e+"px;left:-1000px;width:1px;height:1px;overflow:auto;' name='idContentWord' id='idContentWord' contenteditable='true'></div>"),document.getElementById("idContentWord").focus(),setTimeout(function(){try{restoreSelection(r);jQuery(getSelectionStartNode());if(0==jQuery("#idContentWord").length)return;var t="",e=!1;(0<jQuery("#idContentWord table").length||0<jQuery("#idContentWord img").length||0<jQuery("#idContentWord p").length||0<jQuery("#idContentWord a").length)&&(e=!0),e?(t=cleanHTML(t=jQuery("#idContentWord").html()),jQuery("#idContentWord").html(t),1<jQuery("#idContentWord").children("p,h1,h2,h3,h4,h5,h6,ul,li").length&&jQuery("#idContentWord").contents().filter(function(){return 3==this.nodeType&&""!=jQuery.trim(this.nodeValue)}).wrap("<p></p>").end().filter("br").remove(),t='<div class="edit">'+jQuery("#idContentWord").html()+"</div>"):(jQuery("#idContentWord").find("p,h1,h2,h3,h4,h5,h6").each(function(){jQuery(this).html(jQuery(this).html()+" ")}),t=jQuery("#idContentWord").text()),jQuery("#idContentWord").remove();var i=window.getSelection(),o=i.getRangeAt(0);o.extractContents(),o.collapse(!0);var a=o.createContextualFragment(t),n=a.lastChild;o.insertNode(a),o.setStartAfter(n),o.setEndAfter(n),o.collapse(!1);var s=o.commonAncestorContainer;if(s&&s.parentNode)try{s.parentNode.normalize()}catch(t){}i.removeAllRanges(),i.addRange(o)}catch(t){jQuery("#idContentWord").remove()}},200)}function saveSelection(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){for(var t=[],e=0,i=sel.rangeCount;e<i;++e)t.push(sel.getRangeAt(e));return t}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function restoreSelection(t){if(t)if(window.getSelection){sel=window.getSelection(),sel.removeAllRanges();for(var e=0,i=t.length;e<i;++e)sel.addRange(t[e])}else document.selection&&t.select&&t.select()}function getSelectionStartNode(){var t,e;if(window.getSelection&&(t=(e=getSelection()).anchorNode),!t&&document.selection){var i=(e=document.selection).getRangeAt?e.getRangeAt(0):e.createRange();t=i.commonAncestorContainer?i.commonAncestorContainer:i.parentElement?i.parentElement():i.item(0)}if(t)return"#text"==t.nodeName?t.parentNode:t}!function(u){var v,b,C,w;u.contenteditor=function(t,g){var h={editable:"h1,h2,h3,h4,h5,h6,p,ul,ol,small,.edit,td",editMode:"default",hasChanged:!1,onRender:function(){},onChange:function(){},outline:!1,fileselect:"",imageselect:"",iconselect:"",onFileSelectClick:function(){},onImageSelectClick:function(){},toolbar:"top",toolbarDisplay:"auto",buttons:["bold","italic","formatting","textsettings","color","font","formatPara","align","list","table","image","createLink","unlink","icon","tags","removeFormat","html"],colors:["#ffffc5","#e9d4a7","#ffd5d5","#ffd4df","#c5efff","#b4fdff","#c6f5c6","#fcd1fe","#ececec","#f7e97a","#d09f5e","#ff8d8d","#ff80aa","#63d3ff","#7eeaed","#94dd95","#ef97f3","#d4d4d4","#fed229","#cc7f18","#ff0e0e","#fa4273","#00b8ff","#0edce2","#35d037","#d24fd7","#888888","#ff9c26","#955705","#c31313","#f51f58","#1b83df","#0bbfc5","#1aa71b","#ae19b4","#333333"],customTags:[]};this.settings={};var f=u(t);t=t;this.init=function(){this.settings=u.extend({},h,g);var t=!1;""!=this.settings.fileselect&&(t=!0),"function(){}"!=(this.settings.onFileSelectClick+"").replace(/\s/g,"")&&(t=!0);var e=!1;""!=this.settings.imageselect&&(e=!0),"function(){}"!=(this.settings.onImageSelectClick+"").replace(/\s/g,"")&&(e=!0),0==u("#divCb").length&&u("body").append('<div id="divCb"></div>'),ce_toolbarDisplay=this.settings.toolbarDisplay,ce_outline=this.settings.outline;var i="";"left"==this.settings.toolbar&&(i=' class="rte-side"'),"right"==this.settings.toolbar&&(i=' class="rte-side right"');var o="";""!=this.settings.iconselect&&(o='<button data-rte-cmd="icon" title="Icon"> <i class="cb-icon-smile"></i> </button>');var a="";0<this.settings.customTags.length&&(a='<button data-rte-cmd="tags" title="Tags"> <i class="cb-icon-ticket"></i> </button>');for(var n='<div id="rte-toolbar"'+i+'><div class="rte-draggable"><i class="cb-icon-dot"></i></div>',s=0;s<this.settings.buttons.length;s++){var r=this.settings.buttons[s];"bold"==r&&(n+='<button href="#" data-rte-cmd="bold" title="Bold"> <i class="cb-icon-bold"></i> </button>'),"italic"==r&&(n+='<button data-rte-cmd="italic" title="Italic"> <i class="cb-icon-italic"></i> </button>'),"underline"==r&&(n+='<button data-rte-cmd="underline" title="Underline"> <i class="cb-icon-underline"></i> </button>'),"strikethrough"==r&&(n+='<button data-rte-cmd="strikethrough" title="Strikethrough"> <i class="cb-icon-strike"></i> </button>'),"formatting"==r&&(n+='<button data-rte-cmd="formatting" title="Formatting"> <i class="cb-icon-font"></i> </button>'),"textsettings"==r&&(n+='<button data-rte-cmd="textsettings" title="Text Settings"> <i class="cb-icon-sliders" style="font-size:16px;line-height: 16px;"></i> </button>'),"color"==r&&(n+='<button data-rte-cmd="color" title="Color"> <i class="cb-icon-color"></i> </button>'),"fontsize"==r&&(n+='<button data-rte-cmd="fontsize2" title="Font Size"> <i class="cb-icon-fontsize"></i> </button>'),"removeFormat"==r&&(n+='<button data-rte-cmd="removeFormat" title="Clean"> <i class="cb-icon-eraser"></i> </button>'),"formatPara"==r&&(n+='<button data-rte-cmd="formatPara" title="Paragraph"> <i class="cb-icon-header"></i> </button>'),"font"==r&&(n+='<button data-rte-cmd="font" title="Font"> <i class="cb-icon-font-family" style="font-size:11px"></i> </button>'),"align"==r&&(n+='<button data-rte-cmd="align" title="Alignment"> <i class="cb-icon-align-justify"></i> </button>'),"list"==r&&(n+='<button data-rte-cmd="list" title="List"> <i class="cb-icon-list-bullet"></i> </button>'),"image"==r&&(n+='<button href="#" data-rte-cmd="image" title="Image"> <i class="cb-icon-picture"></i> </button>'),"createLink"==r&&(n+='<button data-rte-cmd="createLink" title="Link"> <i class="cb-icon-link"></i> </button>'),"unlink"==r&&(n+='<button data-rte-cmd="unlink" title="Remove Link"> <i class="cb-icon-unlink"></i> </button>'),"table"==r&&(n+='<button href="#" data-rte-cmd="table" title="table"> <i class="cb-icon-table" style="font-size:14px;line-height:14px;"></i> </button>'),"icon"==r&&(n+=o),"tags"==r&&(n+=a),"html"==r&&(n+='<button data-rte-cmd="html" title="HTML"> <i class="cb-icon-code"></i> </button>')}for(var l='<table id="tableInsert" class="table-insert" style="border-collapse:collapse;border-radius:5px;overflow:hidden;">',d=1;d<=5;d++){l+="<tr>";for(s=1;s<=5;s++)l+='<td data-row="'+d+'" data-col="'+s+'">'+d+"x"+s+"</td>";l+="</tr>"}n+='</div><div id="divRteLink"><i class="cb-icon-link"></i> Edit</div><div id="divFrameLink"><i class="cb-icon-link"></i> Edit</div><div id="divRteTable"><button id="btnEditTable" title="Edit"><i class="cb-icon-pencil"></i></button><button id="btnDeleteTable" title="Delete"><i class="cb-icon-cancel"></i></button></div><div class="md-modal md-draggable" id="md-createlink"><div class="md-content"><div class="md-body"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div class="md-label">Link:</div>'+(t?'<input type="text" id="txtLink" class="inptxt" style="float:left;width:60%;" value="http://"></input><i class="cb-icon-link md-btnbrowse" id="btnLinkBrowse" style="width:10%;"></i>':'<input type="text" id="txtLink" class="inptxt" value="http://" style="float:left;width:70%"></input>')+'<br style="clear:both"><div class="md-label">Text:</div><input type="text" id="txtLinkText" class="inptxt" style="float:right;width:70%"></input><br style="clear:both"><div class="md-label">Title:</div><input type="text" id="txtLinkTitle" class="inptxt" style="float:right;width:70%"></input><br style="clear:both"><div class="md-label">Target:</div><label style="float:left;" for="chkNewWindow" class="inpchk"><input type="checkbox" id="chkNewWindow"></input> New Window</label><br style="clear:both"></div><div class="md-footer"><button id="btnLinkOk"> Ok </button></div></div></div><div class="md-modal md-draggable" id="md-insertimage"><div class="md-content"><div class="md-body"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div class="md-browse"><div class="md-drop-area"><input id="fileInsertImage" type="file" accept="image/*" /><div class="drag-text"><p><i class="cb-icon-camera"></i> Drag and drop an image or click to browse.</p></div></div><div class="md-preview-area"><div><img id="imgInsertImagePreview" src="#" alt="your image" /><i class="ion-ios-close-empty"></i></div></div></div><div class="md-label">Or Specify Image Source:</div>'+(e?'<input type="text" id="txtImgUrl_rte" class="inptxt" style="float:left;width:60%"></input><i class="cb-icon-link md-btnbrowse" id="btnImageBrowse_rte" style="width:10%;"></i>':'<input type="text" id="txtImgUrl_rte" class="inptxt" style="float:left;width:70%"></input>')+'<br style="clear:both"></div><div class="md-footer"><button id="btnImgOk_rte"> Ok </button></div></div></div><div class="md-modal" id="md-createsrc"><div class="md-content"><div class="md-body"><input type="text" id="txtSrc" class="inptxt" value="http://"></input></div><div class="md-footer"><button id="btnSrcOk"> Ok </button></div></div></div><div class="md-modal" id="md-createiframe"><div class="md-content"><div class="md-body"><textarea id="txtIframe" class="inptxt" style="height:350px;"></textarea></div><div class="md-footer"><button id="btnIframeOk"> Ok </button></div></div></div><div class="rte-pop" id="pop-table">'+(l+="</table>")+'</div><div class="rte-pop" id="pop-align"><button class="md-pickalign" data-align="left" title="Left"> <i class="cb-icon-align-left"></i> </button><button class="md-pickalign" data-align="center" title="Center"> <i class="cb-icon-align-center"></i> </button><button class="md-pickalign" data-align="right" title="Right"> <i class="cb-icon-align-right"></i> </button><button class="md-pickalign" data-align="justify" title="Full"> <i class="cb-icon-align-justify"></i> </button></div><div class="md-modal md-draggable" id="md-edittable"><div class="md-content"><div class="md-body"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div class="md-tabs"><span id="tabTableDesign" class="active">Design</span><span id="tabTableLayout">Layout</span></div><div id="divTableDesign" style="overflow-y:auto;overflow-x:hidden;box-sizing:border-box;padding:10px 10px 10px"><div>Background:<br><input type="text" id="inpCellBgColor" value=""/></div><div>Text Color:<br><input type="text" id="inpCellTextColor" value=""/></div><div>Border Thickness:<br><select id="selCellBorderWidth" style="width:120px;"><option value="0">No Border</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div><div>Border Color:<br><input type="text" id="inpCellBorderColor" value=""/></div><div>Apply To:<br><select id="selTableApplyTo" style="width:120px;"><option value="table">Table</option><option value="currentrow">Current Row</option><option value="currentcol">Current Column</option><option value="evenrows">Even Rows</option><option value="oddrows">Odd Rows</option><option value="currentcell">Current Cell</option></select></div></div><div id="divTableLayout" style="overflow-y:auto;overflow-x:hidden;display:none;box-sizing:border-box;padding:10px 10px 10px"><div>Insert Row:<br><button data-rte-cmd="rowabove" title="Insert Row (Above)" style="width:100px;margin-right:5px"> Above </button><button data-rte-cmd="rowbelow" title="Insert Row (Below)" style="width:100px;"> Below </button></div><div>Insert Column:<br><button data-rte-cmd="columnleft" title="Insert Column (Left)" style="width:100px;margin-right:5px"> Left </button><button data-rte-cmd="columnright" title="Insert Column (Right)" style="width:100px;"> Right </button></div><div>Delete:<br><button data-rte-cmd="delrow" title="Delete Row" style="width:100px;margin-right:5px"> Row </button><button data-rte-cmd="delcolumn" title="Delete Column" style="width:100px;"> Column </button></div><div style="margin-bottom:15px;">Merge:<br><button data-rte-cmd="mergecell" title="Merge Cell" style="width:205px"> Merge Cell </button></div></div></div></div></div><div class="md-modal" id="md-deltableconfirm"><div class="md-content"><div class="md-body"><div style="padding:20px 20px 25px;text-align:center;"><p>Are you sure you want to delete this table?</p><button id="btnDelTableCancel"> CANCEL </button><button id="btnDelTableOk" style="margin-left:12px"> OK </button></div></div></div></div><div class="rte-pop" id="pop-list"><button class="md-picklist half" data-list="indent" title="Indent" style="margin-right:0px"> <i class="cb-icon-indent-right"></i> </button><button class="md-picklist half" data-list="outdent" title="Outdent"> <i class="cb-icon-indent-left"></i> </button><button class="md-picklist" data-list="insertUnorderedList" title="Bulleted List"> <i class="cb-icon-list-bullet"></i> </button><button class="md-picklist" data-list="insertOrderedList" title="Numbered List"> <i class="cb-icon-list-numbered"></i> </button></div><div class="rte-pop" id="pop-formatting"><div><button data-rte-cmd="underline" title="Underline"> <i class="cb-icon-underline"></i> </button><button data-rte-cmd="strikethrough" title="Strikethrough"> <i class="cb-icon-strike"></i> </button><button data-rte-cmd="superscript" title="Superscript"> <i class="cb-icon-superscript"></i> </button><button data-rte-cmd="subscript" title="Subscript"> <i class="cb-icon-subscript"></i> </button><button data-rte-cmd="uppercase" title="Uppercase"> <i class="cb-icon-uppercase"></i> </button></div></div><div class="rte-pop arrow-left" id="pop-textsettings"><div>Font Size: <span id="outFontSize"></span><br><button data-rte-cmd="fontsize" data-val="decrease" class="updown"> - </button><button data-rte-cmd="fontsize" data-val="increase" class="updown"> + </button><button data-rte-cmd="fontsize" data-val="clear" class="updown" style="font-size:11px"> <i class="cb-icon-eraser"></i> </button><br style="clear:both"></div><div>Letter Spacing: <span id="outLetterSpacing"></span><br><button data-rte-cmd="letterspacing" data-val="decrease" class="updown"> - </button><button data-rte-cmd="letterspacing" data-val="increase" class="updown"> + </button><button data-rte-cmd="letterspacing" data-val="clear" class="updown" style="font-size:11px"> <i class="cb-icon-eraser"></i> </button><br style="clear:both"></div><div>Line Height: <span id="outLineHeight"></span><br><button data-rte-cmd="lineheight" data-val="decrease" class="updown"> - </button><button data-rte-cmd="lineheight" data-val="increase" class="updown"> + </button><button data-rte-cmd="lineheight" data-val="clear" class="updown" style="font-size:11px"> <i class="cb-icon-eraser"></i> </button><br style="clear:both"></div></div><div class="rte-pop" id="pop-fontfamily"><div><iframe id="ifrFonts" src="'+sScriptPath+'blank.html"></iframe><button class="md-pickfontfamily" data-font-family="" data-provider="" style="display:none"></button></div></div><div class="rte-pop" id="pop-headings"><div><iframe id="ifrHeadings" src="'+sScriptPath+'blank.html"></iframe><button class="md-pickheading" data-font-family="" data-provider="" style="display:none"></button></div></div><div class="rte-pop" id="pop-colors"><div style="margin:8px;"><input type="text" id="inpTextColor"/><button id="btnTextColorClear" style="margin-left:9px;margin-bottom: 2px;padding:0 12px;width:42px;height:37px;border-radius:4px;"> <i class="cb-icon-eraser"></i> </button><div style="overflow-x:auto;overflow-y:hidden;width:245px;height:170px"><div class="cust_colors">[COLORS]</div></div><div style="width:100%;margin-top:6px;"><select id="selColorApplyTo" style="width:120px;"><option value="1">Text Color</option><option value="2">Background</option><option value="3">Block Background</option></select></div><br style="clear:both" /></div></div><div class="md-modal md-draggable" id="md-fontsize" style="border-radius:12px"><div class="md-content" style="border-radius:12px"><div class="md-body"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><iframe id="ifrFontSize" style="width:100%;height:319px;border: none;display: block;" src="'+sScriptPath+'blank.html"></iframe><button class="md-pickfontsize" data-font-size="" style="display:none"></button></div></div></div><div class="md-modal md-draggable" id="md-html"><div class="md-content"><div class="md-body"><div class="md-modal-handle" style="display:none"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><textarea id="txtHtml" class="inptxt" style="height:450px;"></textarea></div><div class="md-footer"><button id="btnHtmlCancel" class="secondary"> Cancel </button><button id="btnHtmlOk" class="primary"> Ok </button></div></div></div><div class="md-modal md-draggable" id="md-editcontentmodule"><div class="md-content"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div class="md-body"><iframe id="ifrContentModulePanel" style="width:100%;height:500px;display:block;border:none;" src="'+sScriptPath+'blank.html"></iframe><input id="hidContentModuleCode" type="hidden" /><input id="hidContentModuleSettings" type="hidden" /></div><div class="md-footer"><button id="btnContentModuleCancel" class="secondary"> Cancel </button><button id="btnContentModuleOk" class="primary"> Ok </button></div></div></div><div class="md-modal md-draggable" id="md-editcontentcustomcode"><div class="md-content"><div class="md-modal-handle"></div><div class="md-body" style="background: #fff;"><div id="infoSource">IMPORTANT</b>: This is a custom section. Custom javascript code (&lt;script&gt; block) is allowed here but may not always work or compatible with the content builder, so proceed at your own risk. We do not support problems with custom code.</div><textarea id="txtContentCustomCode" class="inptxt" style="background: #fff;"></textarea><input id="hidContentCustomCode" type="hidden" /></div><div class="md-footer"><button id="btnContentCustomCodeCancel" class="secondary"> Cancel </button><button id="btnContentCustomCodeOk" class="primary"> Ok </button></div></div></div><div class="md-modal" id="md-fileselect"><div class="md-content"><div class="md-body">'+(t?'<iframe id="ifrFileBrowse" style="width:100%;height:400px;border: none;display: block;" src="'+sScriptPath+'blank.html"></iframe>':"")+'</div></div></div><input type="hidden" id="active-input" /><div class="md-modal" id="md-delrowconfirm"><div class="md-content"><div class="md-body"><div style="padding:20px 20px 25px;text-align:center;"><p>Are you sure you want to delete this block?</p><button id="btnDelRowCancel"> CANCEL </button><button id="btnDelRowOk" style="margin-left:12px"> OK </button></div></div></div></div><div class="md-modal md-draggable" id="md-icon-select"><div class="md-content"><div class="md-body md-settings"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><iframe id="ifrIconSelect" style="width:100%;height:500px;hidden;border:none;float:left;" src="'+sScriptPath+'blank.html"></iframe></div></div></div><div class="md-modal md-draggable" id="md-tags-select"><div class="md-content"><div class="md-body md-settings"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div id="divCustomTags" style="width:100%;"></div></div></div></div><div id="temp-contenteditor"></div>';var c="";arrC=new Array("#000000","#3300ff","#9900ff","#ff0099","#cc0099","#990099","#990033","#cc0033","#ff0033","|","#444444","#3366ff","#9966ff","#ff6699","#cc6699","#996699","#996633","#cc6633","#ff6633","|","#888888","#3399ff","#9999ff","#ff9999","#cc9999","#999999","#999933","#cc9933","#ff9933","|","#cccccc","#33ccff","#99ccff","#ffcc99","#cccc99","#99cc99","#99cc33","#cccc33","#ffcc33","|","#ffffff","#33ffff","#99ffff","#ffff99","#ccff99","#99ff99","#99ff33","#ccff33","#ffff33"),c+='<div style="clear:both;height:30px;">';for(d=0;d<arrC.length;d++)if("|"!=arrC[d]){var m="";"#ffffff"==arrC[d]&&98==d&&(m=""),c+='<button class="md-pick" style="background:'+arrC[d]+m+';"></button>'}else c+='</div><div style="clear:both;height:30px;">';c+="</div>",n=n.replace("[COLORS]",c),0==u("#rte-toolbar").length&&(u("#divCb").append(n),this.prepareRteCommand("superscript"),this.prepareRteCommand("subscript"),this.prepareRteCommand("undo"),this.prepareRteCommand("redo"),u("#rte-toolbar").draggable({cursor:"move",handle:".rte-draggable",start:function(t,e){u(".rte-pop").css("display","none")}}),"left"==this.settings.toolbar||("right"==this.settings.toolbar?u(".rte-pop").addClass("arrow-right"):u(".rte-pop").addClass("arrow-top")));var p=!1;f.on("keyup",function(t){f.data("contenteditor").realtime()}),f.on("mouseup",function(t){f.data("contenteditor").realtime()}),u(document).on("paste","#"+f.attr("id"),function(t){pasteContent(b)}),f.on("keydown",function(t){if(46==t.which||8==t.which)try{if(window.getSelection?i=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode:document.selection&&(i=document.selection.createRange().parentElement()),"p"==i.nodeName.toLowerCase()){var e="";if(window.getSelection?e=window.getSelection().toString():document.getSelection?e=document.getSelection().toString():document.selection&&(e=document.selection.createRange().text),e==i.innerText)return u(i).html("<br>"),!1}}catch(t){}if(17!=t.which){if((86==t.which&&1==p||86==t.which&&t.metaKey)&&pasteContent(b),t.ctrlKey&&(65==t.keyCode||97==t.keyCode)){t.preventDefault();var i,o=detectIE();try{window.getSelection?i=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode:document.selection&&(i=document.selection.createRange().parentElement())}catch(t){return}if(o){(a=document.body.createTextRange()).moveToElementText(i),a.select()}else{var a;(a=document.createRange()).selectNodeContents(i);var n=window.getSelection();n.removeAllRanges(),n.addRange(a)}}}else p=!0}).keyup(function(t){17==t.which&&(p=!1),f.find("[style]").each(function(){-1!=u(this).attr("style").indexOf("font-size")&&u(this).css("font-size")==u(this).parent().css("font-size")&&u(this).css("font-size",""),-1!=u(this).attr("style").indexOf("line-height")&&u(this).css("line-height")==u(this).parent().css("line-height")&&u(this).css("line-height","")})}),u(document).on("mousedown",function(t){0<u(t.target).parents(".ui-draggable").length&&u(t.target).parents(".ui-draggable").parent().data("contentbuilder")&&u(t.target).parents(".ui-draggable").parent();var e=!1;if("none"!=u("#rte-toolbar").css("display")){var i=u(t.target).prop("tagName").toLowerCase();if(u(t.target).parents().each(function(t){(u(this).is("[contenteditable]")||u(this).hasClass("md-modal")||u(this).hasClass("cp-color-picker")||"divCb"==u(this).attr("id"))&&(e=!0)}),u(t.target).is("[contenteditable]"))e=!0;else if(!e){if(b=null,"auto"==ce_toolbarDisplay)try{window.getSelection?i=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode:document.selection&&(i=document.selection.createRange().parentElement());var o=!1;u(i).parents().each(function(){u(this).data("contentbuilder")&&(o=!0)}),o||u("#rte-toolbar").css("display","none"),ce_closePop()}catch(t){}if(ce_outline)for(var a=0;a<instances.length;a++)u(instances[a]).css("outline",""),u(instances[a]).find("*").css("outline","");u(".row-tool").stop(!0,!0).fadeOut(0),u(".ui-draggable").removeClass("ui-dragbox-outlined"),u("#rte-toolbar").css("display","none"),ce_closePop(),u("#divRteTable").stop(!0,!0).fadeOut(0),u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide(),u("#md-createlink").data("simplemodal")&&u("#md-createlink").data("simplemodal").hide(),v&&"http://"==v.attr("href")&&v.replaceWith(v.html()),u("#md-insertimage").data("simplemodal")&&u("#md-insertimage").data("simplemodal").hide(),u("#md-img").data("simplemodal")&&u("#md-img").data("simplemodal").hide(),u("#md-createsrc").data("simplemodal")&&u("#md-createsrc").data("simplemodal").hide(),u("#md-createiframe").data("simplemodal")&&u("#md-createiframe").data("simplemodal").hide(),u("#md-icon-select").data("simplemodal")&&u("#md-icon-select").data("simplemodal").hide(),u("#md-tags-select").data("simplemodal")&&u("#md-tags-select").data("simplemodal").hide()}}}),f.on("focus",function(){var t=$(this);return t.data("before",t.html()),t}).on("keyup",function(){var t=$(this);return t.data("before")!==t.html()&&(t.data("before",t.html()),f.data("contenteditor").settings.onChange(),saveForUndo()),t})},this.contentRender=function(){this.settings=u.extend({},h,g);var t=this.settings.iconselect;""!=t&&f.find(".ui-draggable > div:first-child i").each(function(){0<u(this).parents("[data-html]").length||0<u(this).parents("[data-mode='readonly']").length||0<u(this).parents("[data-mode='readonly-protected']").length||""==u(this).html()&&(u(this).off("click"),u(this).click(function(){$activeIcon=u(this),-1!=u("#ifrIconSelect").attr("src").indexOf("blank.html")&&u("#ifrIconSelect").attr("src",t),u("#md-icon-select").css("max-width","775px"),u("#md-icon-select").simplemodal({noOverlay:!0}),u("#md-icon-select").data("simplemodal").show(),f.data("contenteditor").closePop()}))})},this.realtime=function(){var t;detectIE();try{var e;window.getSelection?e=(t=window.getSelection().getRangeAt(0).commonAncestorContainer).parentNode:document.selection&&(e=(t=document.selection.createRange()).parentElement())}catch(t){return}if(!(0<u(e).parents("[data-html]").length||0<u(e).parents("[data-mode='readonly']").length||0<u(e).parents("[data-mode='readonly-protected']").length)){"a"==e.nodeName.toLowerCase()?"block"!=u("#md-createlink").css("display")&&u("#divRteLink").addClass("forceshow"):u("#divRteLink").removeClass("forceshow"),t&&u(t).is("[contenteditable]")&&u("#rte-toolbar").stop(!0,!0).fadeIn(200),u(e).is("[contenteditable]")&&u("#rte-toolbar").stop(!0,!0).fadeIn(200),0<u(e).parents("[contenteditable]").length&&u("#rte-toolbar").stop(!0,!0).fadeIn(200),f.data("contenteditor").closePop();var i,o=f.data("contenteditor").settings.editable;if(""==o||(f.find(o).off("mousedown"),f.find(o).on("mousedown",function(t){if(b=u(this),u("#rte-toolbar").stop(!0,!0).fadeIn(200),ce_outline){for(var e=0;e<instances.length;e++)u(instances[e]).css("outline",""),u(instances[e]).find("*").css("outline","");u(this).css("outline","rgba(0, 0, 0, 0.43) dashed 1px")}}),f.find(".edit").find(o).removeAttr("contenteditable")),0<u(e).parents("table").length){var a=u(e).parents("table").first(),n=a.offset().top-30,s=a.offset().left+a.width()-parseInt(u("#divRteTable").css("width"));u("#divRteTable").css("top",n+"px"),u("#divRteTable").css("left",s+"px"),"none"==u("#divRteTable").css("display")&&u("#divRteTable").stop(!0,!0).css({display:"none"}).fadeIn(20)}else u("#divRteTable").stop(!0,!0).fadeOut(0);if(savedSelPublic=saveSelection(),$activeIcon=null,u(t).prop("tagName")){if(0<u(e).parents("[contenteditable]").length){var r=u(t).prop("tagName").toLowerCase();"td"==r||"th"==r?w=u(t):0<u(t).parents("td,th").length?w=u(t).parents("td,th").first():(w=null,u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide())}}else 0<u(t).parents("td,th").length?w=u(t).parents("td,th").first():(w=null,u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide());if(u("#md-createlink").data("simplemodal")&&u("#md-createlink").data("simplemodal").hide(),v&&"http://"==v.attr("href")&&v.replaceWith(v.html()),u("#md-img").data("simplemodal")&&u("#md-img").data("simplemodal").hide(),u("#md-createsrc").data("simplemodal")&&u("#md-createsrc").data("simplemodal").hide(),u("#md-createiframe").data("simplemodal")&&u("#md-createiframe").data("simplemodal").hide(),0<u(e).parents(".ui-draggable").length&&u(e).parents(".ui-draggable").parent().data("contentbuilder")&&(i=u(e).parents(".ui-draggable").parent()),i){var l=i.data("contentbuilder").settings.snippetPageSliding,d=255;u(window).width()<600&&(d=150),"right"==i.data("contentbuilder").settings.snippetTool?l||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)?0==parseInt(u("#divTool").css("right"))&&(u("#divTool").animate({right:"-="+d+"px"},200),u("body").animate({marginRight:"-="+d+"px"},250),u("#rte-toolbar").animate({paddingRight:"-="+d+"px"},250),u("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),u("#divSnippetScrollUp").fadeOut(300),u("#divSnippetScrollDown").fadeOut(300)):0==parseInt(u("#divTool").css("right"))&&(u("#divTool").animate({right:"-="+d+"px"},200),u("#lnkToolOpen i").attr("class","cb-icon-left-open-big"),u("#divSnippetScrollUp").css("display","none"),u("#divSnippetScrollDown").css("display","none")):l||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)?0==parseInt(u("#divTool").css("left"))&&(u("#divTool").animate({left:"-="+(d+0)+"px"},200),u("body").animate({marginLeft:"-="+d+"px"},250),u("#rte-toolbar").animate({paddingLeft:"-="+d+"px"},250),u("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),u("#divSnippetScrollUp").fadeOut(300),u("#divSnippetScrollDown").fadeOut(300)):0==parseInt(u("#divTool").css("left"))&&(u("#divTool").animate({left:"-="+(d+0)+"px"},200),u("#lnkToolOpen i").attr("class","cb-icon-right-open-big"),u("#divSnippetScrollUp").css("display","none"),u("#divSnippetScrollDown").css("display","none"))}f.data("contenteditor").getState(),equalHtmlDivToText()}},this.getState=function(){document.queryCommandState("bold")?u("[data-rte-cmd=bold]").addClass("on"):u("[data-rte-cmd=bold]").removeClass("on"),document.queryCommandState("italic")?u("[data-rte-cmd=italic]").addClass("on"):u("[data-rte-cmd=italic]").removeClass("on"),document.queryCommandState("underline")?u("[data-rte-cmd=underline]").addClass("on"):u("[data-rte-cmd=underline]").removeClass("on"),document.queryCommandState("strikethrough")?u("[data-rte-cmd=strikethrough]").addClass("on"):u("[data-rte-cmd=strikethrough]").removeClass("on"),document.queryCommandState("superscript")?u("[data-rte-cmd=superscript]").addClass("on"):u("[data-rte-cmd=superscript]").removeClass("on"),document.queryCommandState("subscript")?u("[data-rte-cmd=subscript]").addClass("on"):u("[data-rte-cmd=subscript]").removeClass("on"),document.queryCommandState("JustifyFull")?u("[data-align=justify]").addClass("on"):u("[data-align=justify]").removeClass("on"),document.queryCommandState("JustifyLeft")?u("[data-align=left]").addClass("on"):u("[data-align=left]").removeClass("on"),document.queryCommandState("JustifyRight")?u("[data-align=right]").addClass("on"):u("[data-align=right]").removeClass("on"),document.queryCommandState("JustifyCenter")?u("[data-align=center]").addClass("on"):u("[data-align=center]").removeClass("on");var e=document.queryCommandValue("FontName").split(",")[0];e=e.replace('"',"").replace('"',""),e=u.trim(e).toLowerCase(),-1==u("#ifrFonts").attr("src").indexOf("fonts.html")&&u("#ifrFonts").attr("src",sScriptPath+"fonts.html?1"),u("#ifrFonts").contents().find("[data-font-family]").removeClass("on"),u("#ifrFonts").contents().find("[data-font-family]").each(function(){var t=u(this).attr("data-font-family");t=t.split(",")[0],(t=u.trim(t).toLowerCase())==e&&""!=t&&u(this).addClass("on")});var t,i,o=document.queryCommandValue("FormatBlock");"normal"==(o=o.toLowerCase())&&(o="p"),"heading 1"==o&&(o="h1"),"heading 2"==o&&(o="h2"),"heading 3"==o&&(o="h3"),"heading 4"==o&&(o="h4"),"heading 5"==o&&(o="h5"),"heading 6"==o&&(o="h6"),"formatted"==o&&(o="pre"),-1==u("#ifrHeadings").attr("src").indexOf("headings.html")&&u("#ifrHeadings").attr("src",sScriptPath+"headings.html?1"),u("#ifrHeadings").contents().find("[data-heading]").removeClass("on"),u("#ifrHeadings").contents().find("[data-heading]").each(function(){u(this).attr("data-heading")==o&&""!=o&&u(this).addClass("on")}),window.getSelection?t=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),t=document.selection.createRange().parentElement()),"uppercase"==u(t).css("text-transform")?u("[data-rte-cmd=uppercase]").addClass("on"):u("[data-rte-cmd=uppercase]").removeClass("on")},this.closePop=function(){u(".rte-pop").css("display","none"),u('[data-rte-cmd="formatting"]').removeClass("on"),u('[data-rte-cmd="textsettings"]').removeClass("on"),u('[data-rte-cmd="color"]').removeClass("on"),u('[data-rte-cmd="font"]').removeClass("on"),u('[data-rte-cmd="formatPara"]').removeClass("on"),u('[data-rte-cmd="align"]').removeClass("on"),u('[data-rte-cmd="list"]').removeClass("on"),u('[data-rte-cmd="table"]').removeClass("on")},this.render=function(){var o,t=f.data("contenteditor").settings.editable;""==t?(f.attr("contenteditable","true"),f.off("mousedown"),f.on("mousedown",function(t){if(b=u(this),u("#rte-toolbar").stop(!0,!0).fadeIn(200),ce_outline){for(var e=0;e<instances.length;e++)u(instances[e]).css("outline",""),u(instances[e]).find("*").css("outline","");u(this).css("outline","rgba(0, 0, 0, 0.43) dashed 1px")}})):(f.find(t).each(function(){if("default"==f.data("contenteditor").settings.editMode)0<u(this).parents("[data-html]").length&&u(this).hasClass("edit")&&u(this).attr("contenteditable","true");else{if(0<u(this).parents("[data-html]").length)return;if(0<u(this).parents("[data-mode='readonly']").length)return;if(0<u(this).parents("[data-mode='readonly-protected']").length)return;var t=u(this).attr("contenteditable");void 0!==t&&!1!==t||u(this).attr("contenteditable","true")}}),f.find(t).off("mousedown"),f.find(t).on("mousedown",function(t){if(b=u(this),ce_outline){for(var e=0;e<instances.length;e++)u(instances[e]).css("outline",""),u(instances[e]).find("*").css("outline","");u(this).css("outline","rgba(0, 0, 0, 0.43) dashed 1px")}}),f.find(".edit").find(t).removeAttr("contenteditable")),f.find(".is-btn").attr("contenteditable","false"),f.find(".is-btn").each(function(){u(this).focus(function(){u(this).blur()})}),"default"==f.data("contenteditor").settings.editMode?(f.find("h1,h2,h3,h4,h5,h6").off("keydown"),f.find("h1,h2,h3,h4,h5,h6").on("keydown",function(t){if(13==t.keyCode){var e=detectIE();if(!(e&&e<=10)){var i,o=(i=window.getSelection()).getRangeAt(0);o.extractContents(),o.collapse(!0);var a=o.createContextualFragment("<br>"),n=a.lastChild;o.insertNode(a),o.setStartAfter(n),o.setEndAfter(n),1==o.endContainer.nodeType&&o.endOffset==o.endContainer.childNodes.length-1&&(o.insertNode(o.createContextualFragment("<br />")),o.setStartAfter(n),o.setEndAfter(n));var s=o.commonAncestorContainer;if(s&&s.parentNode)try{s.parentNode.normalize()}catch(t){}return i.removeAllRanges(),i.addRange(o),!1}if((i=document.selection.createRange()).parentElement)return i.pasteHTML("<br>"),t.cancelBubble=!0,t.returnValue=!1,i.select(),i.moveEnd("character",1),i.moveStart("character",1),i.collapse(!1),!1}}),f.children("div.ui-draggable").each(function(){try{var t=u(this).children().first().children().first().attr("data-html");if(void 0!==t&&!1!==t)return;if(0<u(this).children().first().children().first().parents("[data-html]").length)return;if(0<u(this).children().first().children().first().parents("[data-mode='readonly']").length)return;if(0<u(this).children().first().children().first().parents("[data-mode='readonly-protected']").length)return}catch(t){}var e=!1;try{"table"==u(this).children().first().children().first().prop("tagName").toLowerCase()&&(e=!0)}catch(t){}e?u(this).find("td,th").each(function(){1==u(this).children().length&&"table"==u(this).children().first().prop("tagName").toLowerCase()||u(this).attr("contenteditable",!0)}):u(this).children().first().children().each(function(){u(this).attr("contenteditable",!0)});var i=detectIE(),o=detectEdge();if(i&&i<=11||o)try{"table"==u(this).children().first().children().first().prop("tagName").toLowerCase()&&u(this).children().first().attr("contenteditable",!0)}catch(t){}}),f.find("div").off("keyup"),f.find("div").on("keyup",function(t){var e,i;try{window.getSelection?(i=window.getSelection().getRangeAt(0).commonAncestorContainer,e=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode):document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement())}catch(t){return}if(13==t.keyCode&&!t.shiftKey)if(0<detectIE());else{var o=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),a=(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),window.opera),n=-1<navigator.userAgent.toLowerCase().indexOf("firefox");(o||a)&&("p"!=u(e).prop("tagName").toLowerCase()&&"div"!=u(e).prop("tagName").toLowerCase()||document.execCommand("formatBlock",!1,"<p>")),n&&(u(i).html()||document.execCommand("formatBlock",!1,"<p>"))}}),f.find("div").off("keydown"),f.find("div").on("keydown",function(t){var e;try{window.getSelection?(e=window.getSelection().getRangeAt(0).commonAncestorContainer,window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode):document.selection&&(e=document.selection.createRange(),document.selection.createRange().parentElement())}catch(t){return}if((8==t.keyCode||46==t.keyCode)&&u(e).html()){var i=u(e).prop("tagName").toLowerCase();if(("h1"==i||"h1"==i||"h2"==i||"h3"==i||"h4"==i||"h5"==i||"h6"==i||"p"==i)&&""==u(e).text()){document.execCommand("removeFormat",!1,null),u(e).remove();var o=window.getSelection(),a=o.getRangeAt(0);a.extractContents(),a.collapse(!0),o.removeAllRanges(),o.addRange(a),t.preventDefault(),t.stopImmediatePropagation()}}})):(f.find("p").off("keydown"),f.find("p").on("keydown",function(t){if(13==t.keyCode&&0==f.find("li").length){if(!(0<=navigator.userAgent.toLowerCase().indexOf("msie"))){var e,i=(e=window.getSelection()).getRangeAt(0);i.extractContents(),i.collapse(!0);var o=i.createContextualFragment("<br>"),a=o.lastChild;i.insertNode(o),i.setStartAfter(a),i.setEndAfter(a),1==i.endContainer.nodeType&&i.endOffset==i.endContainer.childNodes.length-1&&(i.insertNode(i.createContextualFragment("<br />")),i.setStartAfter(a),i.setEndAfter(a));var n=i.commonAncestorContainer;if(n&&n.parentNode)try{n.parentNode.normalize()}catch(t){}return e.removeAllRanges(),e.addRange(i),!1}if((e=document.selection.createRange()).parentElement)return e.pasteHTML("<br>"),t.cancelBubble=!0,t.returnValue=!1,e.select(),e.moveEnd("character",1),e.moveStart("character",1),e.collapse(!1),!1}})),u('[data-rte-cmd="fontsize"]').off("click"),u('[data-rte-cmd="fontsize"]').click(function(){if(savedSelPublic){if(restoreSelection(savedSelPublic),window.getSelection?s=3==(r=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?r.parentNode:r:document.selection&&(r=document.selection.createRange(),s=document.selection.createRange().parentElement()),"true"!=u(s).attr("contenteditable")&&0==u(s).parents("[contenteditable]").length)return;if("clear"!=u(this).attr("data-val")){var t=parseInt(u(s).css("font-size"));"increase"==u(this).attr("data-val")&&(t+=1),"decrease"==u(this).attr("data-val")&&(t-=1);var e=t+"px",i=getSelected();if(""!=u.trim(i)&&u(s).text()!=i){document.execCommand("fontSize",!1,"7");for(var o=document.getElementsByTagName("font"),a=0,n=o.length;a<n;++a)"7"==o[a].size&&(o[a].removeAttribute("size"),o[a].style.fontSize=e);savedSelPublic=saveSelection()}else u(s).text()==i?u(s).html()?u(s).css("font-size",e):u(s).parent().css("font-size",e):u(s).css("font-size",e);u("#outFontSize").html(e)}else{var s,r;u(s).css("font-size",""),window.getSelection?s=3==(r=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?r.parentNode:r:document.selection&&(r=document.selection.createRange(),s=document.selection.createRange().parentElement());var l=parseInt(u(s).css("font-size"));u("#outFontSize").html(l+"px"),u("#outFontSize").attr("data-initial-value",l)}saveForUndo(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange()}}),u('[data-rte-cmd="letterspacing"]').off("click"),u('[data-rte-cmd="letterspacing"]').click(function(){if(savedSelPublic){if(restoreSelection(savedSelPublic),window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),"true"!=u(e).attr("contenteditable")&&0==u(e).parents("[contenteditable]").length)return;if("clear"!=u(this).attr("data-val")){var t=parseInt(u(e).css("letter-spacing"));"increase"==u(this).attr("data-val")&&(t+=1),"decrease"==u(this).attr("data-val")&&(t-=1),u(e).css("letter-spacing",t+"px"),u("#outLetterSpacing").html(t+"px")}else{var e,i;u(e).css("letter-spacing",""),window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement());var o=parseInt(u(e).css("letter-spacing"));u("#outLetterSpacing").html(o+"px"),u("#outLetterSpacing").attr("data-initial-value",o)}saveForUndo(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange()}}),u('[data-rte-cmd="lineheight"]').off("click"),u('[data-rte-cmd="lineheight"]').click(function(){if(savedSelPublic){if(restoreSelection(savedSelPublic),window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),"true"!=u(e).attr("contenteditable")&&0==u(e).parents("[contenteditable]").length)return;if("clear"!=u(this).attr("data-val")){var t=parseInt(u(e).css("line-height"));"increase"==u(this).attr("data-val")&&(t+=1),"decrease"==u(this).attr("data-val")&&(t-=1),u(e).css("line-height",t+"px"),u("#outLineHeight").html(t+"px")}else{var e,i;u(e).css("line-height",""),window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement());var o=parseInt(u(e).css("line-height"));u("#outLineHeight").html(o+"px"),u("#outLineHeight").attr("data-initial-value",o)}saveForUndo(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange()}}),u('[data-rte-cmd="removeElement"]').off("click"),u('[data-rte-cmd="removeElement"]').click(function(t){b.remove(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").render(),saveForUndo(),t.preventDefault()}),u('[data-rte-cmd="fontsize2"]').off("click"),u('[data-rte-cmd="fontsize2"]').click(function(s){var r=saveSelection();u("#md-fontsize").css("max-width","190px"),u("#md-fontsize").simplemodal(),u("#md-fontsize").data("simplemodal").show(r),f.data("contenteditor").closePop(),s.preventDefault(),-1==u("#ifrFontSize").attr("src").indexOf("fontsize.html")&&u("#ifrFontSize").attr("src",sScriptPath+"fontsize.html");var l=getSelected();u(".md-pickfontsize").off("click"),u(".md-pickfontsize").click(function(){var t,e;if(restoreSelection(r),window.getSelection?t=3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?e.parentNode:e:document.selection&&(e=document.selection.createRange(),t=document.selection.createRange().parentElement()),0!=u(t).parents("[contenteditable]").length){var i=u(this).attr("data-font-size");if(""!=u.trim(l)&&u(t).text()!=l){document.execCommand("fontSize",!1,"7");for(var o=document.getElementsByTagName("font"),a=0,n=o.length;a<n;++a)"7"==o[a].size&&(o[a].removeAttribute("size"),o[a].style.fontSize=i)}else u(t).text()==l?u(t).html()?u(t).css("font-size",i):u(t).parent().css("font-size",i):u(t).css("font-size",i);u(this).blur(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,s.preventDefault(),saveForUndo()}else u("#md-fontsize").data("simplemodal").hide()})}),u('[data-rte-cmd="removeFormat"]').off("click"),u('[data-rte-cmd="removeFormat"]').click(function(t){document.execCommand("removeFormat",!1,null),document.execCommand("removeFormat",!1,null),u(this).blur(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="unlink"]').off("click"),u('[data-rte-cmd="unlink"]').click(function(t){document.execCommand("unlink",!1,null),u("#divRteLink").removeClass("forceshow"),u(this).blur(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="html"]').off("click"),u('[data-rte-cmd="html"]').click(function(t){var e;window.getSelection?e=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode:document.selection&&(e=document.selection.createRange().parentElement());var i=!1;u(e).parents().each(function(){u(this).data("contentbuilder")&&(u(this).data("contentbuilder").viewHtml(),i=!0,o=e)}),!i&&o&&u(e=o).parents().each(function(){u(this).data("contentbuilder")&&u(this).data("contentbuilder").viewHtml()}),t.preventDefault()}),u('[data-rte-cmd="formatPara"]').off("click"),u('[data-rte-cmd="formatPara"]').click(function(e){savedSelPublic=saveSelection();var t=u(this).offset().top-u(window).scrollTop(),i=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-headings").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?i=i-57-132:i+=57):t+=51,u("#pop-headings").css("position","fixed"),u("#pop-headings").css("top",t+"px"),u("#pop-headings").css("left",i+"px"),f.data("contenteditor").closePop(),u("#pop-headings").css("display","block"),u(this).addClass("on"),-1==u("#ifrHeadings").attr("src").indexOf("headings.html")&&u("#ifrHeadings").attr("src",sScriptPath+"headings.html?1"),detectIE()&&restoreSelection(savedSelPublic),f.data("contenteditor").getState();try{var o=u("#ifrHeadings").contents(),a=o.find("#divHeadings"),n=o.find(".on");a.animate({scrollTop:a.scrollTop()+n.position().top-7},1e3)}catch(e){}u(".md-pickheading").off("click"),u(".md-pickheading").click(function(){restoreSelection(savedSelPublic);var t=u(this).attr("data-heading");document.execCommand("formatBlock",!1,"<"+t+">"),f.data("contenteditor").getState(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,e.preventDefault(),savedSelPublic=saveSelection(),saveForUndo()})}),u('[data-rte-cmd="font"]').off("click"),u('[data-rte-cmd="font"]').click(function(m){savedSelPublic=saveSelection();var t=u(this).offset().top-u(window).scrollTop(),e=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-fontfamily").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?e=e-57-132:e+=57):t+=51,u("#pop-fontfamily").css("position","fixed"),u("#pop-fontfamily").css("top",t+"px"),u("#pop-fontfamily").css("left",e+"px"),f.data("contenteditor").closePop(),u("#pop-fontfamily").css("display","block"),u(this).addClass("on"),-1==u("#ifrFonts").attr("src").indexOf("fonts.html")&&u("#ifrFonts").attr("src",sScriptPath+"fonts.html?1");var p=getSelected();f.data("contenteditor").getState();try{var i=u("#ifrFonts").contents(),o=i.find("#divFontList"),a=i.find(".on");o.animate({scrollTop:o.scrollTop()+a.position().top-7},1e3)}catch(m){}u(".md-pickfontfamily").off("click"),u(".md-pickfontfamily").click(function(){var t,e;restoreSelection(savedSelPublic),window.getSelection?"H1"!=(t=3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?e.parentNode:e).nodeName&&"H2"!=t.nodeName&&"H3"!=t.nodeName&&"H4"!=t.nodeName&&"H5"!=t.nodeName&&"H6"!=t.nodeName&&"P"!=t.nodeName&&(t=t.parentNode):document.selection&&(e=document.selection.createRange(),"H1"!=(t=document.selection.createRange().parentElement()).nodeName&&"H2"!=t.nodeName&&"H3"!=t.nodeName&&"H4"!=t.nodeName&&"H5"!=t.nodeName&&"H6"!=t.nodeName&&"P"!=t.nodeName&&(t=t.parentElement()));var i=u(this).attr("data-font-family");if(""!=u.trim(p)&&u(t).text()!=p){document.execCommand("fontName",!1,i);for(var o=document.getElementsByTagName("font"),a=0,n=o.length;a<n;++a)o[a].face==i&&(o[a].removeAttribute("face"),o[a].style.fontFamily=i)}else u(t).text()==p?u(t).html()?u(t).css("font-family",i):u(t).parent().css("font-family",i):u(t).css("font-family",i);var s=u(this).attr("data-font-style");s=s?":"+s:"";var r=i.split(",")[0];if("google"==u(this).attr("data-provider")){var l=!1,d=document.getElementsByTagName("link");for(a=0;a<d.length;a++){var c=d[a].href.toLowerCase();-1!=(c=c.replace(/\+/g," ").replace(/%20/g," ")).indexOf(r.toLowerCase())&&(l=!0)}l||u(t).parents().each(function(){u(this).data("contentbuilder")&&u(this).append('<link href="//fonts.googleapis.com/css?family='+r+s+'" rel="stylesheet" property="stylesheet" type="text/css">')})}u(cb_list).each(function(){var i=u(this);i.find("link").each(function(){var t=u(this).attr("href").toLowerCase();if(-1!=t.indexOf("googleapis")){var e=(t=t.replace(/\+/g," ").replace(/%20/g," ")).substr(t.indexOf("family=")+7);-1!=e.indexOf(":")&&(e=e.split(":")[0]),-1!=e.indexOf("|")&&(e=e.split("|")[0]),i.data("contentbuilder").html().toLowerCase().split(e).length<3&&u(this).attr("data-rel","_del")}})}),f.find('[data-rel="_del"]').remove(),f.data("contenteditor").getState(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,m.preventDefault(),saveForUndo()})}),u('[data-rte-cmd="image"]').off("click"),u('[data-rte-cmd="image"]').click(function(t){savedSelPublic=saveSelection(),u("#md-insertimage").css("max-width","550px"),u("#md-insertimage").simplemodal({noOverlay:!0}),u("#md-insertimage").data("simplemodal").show(savedSel),f.data("contenteditor").closePop(),u("#fileInsertImage").clearInputs(),u(".md-preview-area").hide(),u(".md-drop-area").show(),u(".md-drop-area").removeClass("image-dropping"),u("#txtImgUrl_rte").val(""),u("#btnImgOk_rte").off("click"),u("#btnImgOk_rte").click(function(){if(savedSelPublic){restoreSelection(savedSelPublic);var t,e,i,o="";if(""!=(o="none"==u(".md-drop-area").css("display")?u("#imgInsertImagePreview").attr("src"):u("#txtImgUrl_rte").val()))pasteHtmlAtCaret('<img src="'+o+'" />',!0),u("#md-insertimage").data("simplemodal").hide(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),window.getSelection?t=3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?e.parentNode:e:document.selection&&(e=document.selection.createRange(),t=document.selection.createRange().parentElement()),u(t).parents().each(function(){u(this).data("contentbuilder")&&u(this).data("contentbuilder").applyBehavior()}),window.getSelection?i=window.getSelection():document.selection&&(i=document.selection),i.removeAllRanges(),u("#rte-toolbar").css("display","none")}}),t.preventDefault()}),u("#fileInsertImage").off("change"),u("#fileInsertImage").on("change",function(t){var e=t.target;if(e.files&&e.files[0]){var i=new FileReader;i.onload=function(t){u(".md-drop-area").hide(),u("#imgInsertImagePreview").attr("src",t.target.result),u(".md-preview-area").show(),u(".image-title").html(e.files[0].name)},i.readAsDataURL(e.files[0]),u("#txtImgUrl_rte").val("")}}),u(".md-drop-area").off("dragover"),u(".md-drop-area").on("dragover",function(){u(".md-drop-area").addClass("image-dropping")}),u(".md-drop-area").off("dragleave"),u(".md-drop-area").on("dragleave",function(){u(".md-drop-area").removeClass("image-dropping")}),u(".md-preview-area i").off("click"),u(".md-preview-area i").click(function(t){u("#fileInsertImage").clearInputs(),u(".md-preview-area").hide(),u(".md-drop-area").show(),u(".md-drop-area").removeClass("image-dropping")}),u("#txtImgUrl_rte").off("keyup"),u("#txtImgUrl_rte").on("keyup",function(){u("#fileInsertImage").clearInputs(),u(".md-preview-area").hide(),u(".md-drop-area").show(),u(".md-drop-area").removeClass("image-dropping")}),u("#btnImageBrowse_rte").off("click"),u("#btnImageBrowse_rte").on("click",function(t){"function(){}"!=(f.data("contenteditor").settings.onImageSelectClick+"").replace(/\s/g,"")?f.data("contenteditor").settings.onImageSelectClick({targetInput:u("#txtImgUrl_rte").get(0),theTrigger:u("#btnImageBrowse_rte").get(0)}):(u("#ifrImageBrowse").attr("src",f.data("contenteditor").settings.imageselect),u("#active-input").val("txtImgUrl_rte"),u("#md-imageselect").css("width","65%"),u("#md-imageselect").simplemodal({onFinish:function(){""!=u("#txtImgUrl_rte").val()&&(u("#fileInsertImage").clearInputs(),u(".md-preview-area").hide(),u(".md-drop-area").show(),u(".md-drop-area").removeClass("image-dropping"))}}),u("#md-imageselect").data("simplemodal").show())}),u('[data-rte-cmd="formatting"]').off("click"),u('[data-rte-cmd="formatting"]').click(function(t){savedSelPublic=saveSelection();var e,i=u(this).offset().top-u(window).scrollTop(),o=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-formatting").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?o-=58:o+=57):i+=51,u("#pop-formatting").css("position","fixed"),u("#pop-formatting").css("top",i+"px"),u("#pop-formatting").css("left",o+"px"),f.data("contenteditor").closePop(),u("#pop-formatting").css("display","block"),u(this).addClass("on"),f.data("contenteditor").getState(),window.getSelection?3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType&&e.parentNode:document.selection&&(e=document.selection.createRange(),document.selection.createRange().parentElement()),t.preventDefault()}),u('[data-rte-cmd="textsettings"]').off("click"),u('[data-rte-cmd="textsettings"]').click(function(t){savedSelPublic=saveSelection();var e,i,o=u(this).offset().top-u(window).scrollTop(),a=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-textsettings").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?a=a-57-132:a+=57):o+=51,u("#pop-textsettings").css("position","fixed"),u("#pop-textsettings").css("top",o+"px"),u("#pop-textsettings").css("left",a+"px"),f.data("contenteditor").closePop(),u("#pop-textsettings").css("display","block"),u(this).addClass("on"),window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement());var n=parseInt(u(e).css("font-size"));u("#outFontSize").html(n+"px"),u("#outFontSize").attr("data-initial-value",n);var s=parseInt(u(e).css("letter-spacing"));u("#outLetterSpacing").html(s+"px"),u("#outLetterSpacing").attr("data-initial-value",s);var r=parseInt(u(e).css("line-height"));u("#outLineHeight").html(r+"px"),u("#outLineHeight").attr("data-initial-value",r),t.preventDefault()}),u('[data-rte-cmd="color"]').off("click"),u('[data-rte-cmd="color"]').click(function(t){savedSelPublic=saveSelection();var i,e,o=u(this).offset().top-u(window).scrollTop(),a=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-colors").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?a=a-57-215:a+=57):o+=51,u("#pop-colors").css("position","fixed"),u("#pop-colors").css("top",o+"px"),u("#pop-colors").css("left",a+"px"),f.data("contenteditor").closePop(),u("#pop-colors").css("display","block"),u(this).addClass("on"),window.getSelection?(e=window.getSelection().getRangeAt(0).commonAncestorContainer,i=3==e.nodeType?e.parentNode:e):document.selection&&(e=document.selection.createRange(),i=document.selection.createRange().parentElement()),u("#selColorApplyTo").off("change"),u("#selColorApplyTo").on("change",function(){var t=u("#selColorApplyTo").val();if(1==t){var e=u(i).css("color");u("#inpTextColor").val(e),u("#inpTextColor").css("background-color",e),u("#inpTextColor").contrastingText()}if(2==t){e=u(i).css("background-color");u("#inpTextColor").val(e),u("#inpTextColor").css("background-color",e),u("#inpTextColor").contrastingText()}if(3==t){e=u(i).parents(".ui-draggable").children().first().css("background-color");u("#inpTextColor").val(e),u("#inpTextColor").css("background-color",e),u("#inpTextColor").contrastingText()}}),u("#selColorApplyTo").change();var n=!1;try{"table"==f.children("div.ui-draggable").first().children().first().children().first().prop("tagName").toLowerCase()&&(n=!0)}catch(t){}n&&u("#selColorApplyTo").children().each(function(){"3"==u(this).attr("value")&&u(this).remove()});var r=getSelected();u(".md-pick").off("click"),u(".md-pick").click(function(){var t=u(this).css("background-color");u("#inpTextColor").val(t),u("#inpTextColor").css("background-color",t),u("#inpTextColor").contrastingText(),restoreSelection(savedSelPublic),f.data("contenteditor").applyColor(t,r),savedSelPublic=saveSelection(),f.data("contenteditor").settings.onChange(),saveForUndo()}),u("#inpTextColor").colorPicker||$("#inpTextColor").colorPicker.destroy(),u("#inpTextColor").colorPicker({dark:"#222",light:"#DDD",renderCallback:function(t,e){if(!0===e)u("#inpTextColor").attr("data-initial-color",u("#inpTextColor").val());else if(!1===e)u("#inpTextColor").attr("data-initial-color")!=u("#inpTextColor").val()&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpTextColor").attr("data-initial-color",u("#inpTextColor").val()));else{var i=u("#inpTextColor").val();restoreSelection(savedSelPublic),f.data("contenteditor").applyColor(i,r),savedSelPublic=saveSelection()}}});var s=!1;u("#inpTextColor").off("keyup"),u("#inpTextColor").on("keyup",function(t){s=!0}),u("#inpTextColor").off("blur"),u("#inpTextColor").on("blur",function(t){var e=u("#inpTextColor").val();restoreSelection(savedSelPublic),f.data("contenteditor").applyColor(e,r),savedSelPublic=saveSelection(),(u("#inpTextColor").attr("data-initial-color")!=u("#inpTextColor").val()||s)&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpTextColor").attr("data-initial-color",u("#inpTextColor").val()),s=!1)}),u("#btnTextColorClear").off("click"),u("#btnTextColorClear").click(function(){var t,e;restoreSelection(savedSelPublic),window.getSelection?t=3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?e.parentNode:e:document.selection&&(e=document.selection.createRange(),t=document.selection.createRange().parentElement());var i=u("#selColorApplyTo").val();if(""!=u.trim(r)&&u(t).text()!=r){1==i&&document.execCommand("ForeColor",!1,""),2==i&&document.execCommand("BackColor",!1,"");for(var o=document.getElementsByTagName("font"),a=0,n=o.length;a<n;++a){var s=o[a].color;o[a].removeAttribute("color"),o[a].style.color=s}}else u(t).text()==r?(1==i&&(u(t).html()?u(t).css("color",""):u(t).parent().css("color","")),2==i&&(u(t).html()?u(t).css("background-color",""):u(t).parent().css("background-color",""))):(1==i&&u(t).css("color",""),2==i&&u(t).css("background-color",""));3==i&&u(t).parents(".ui-draggable").children().first().css("background-color",""),u("#selColorApplyTo").change()})}),u('[data-rte-cmd="bold"]').off("click"),u('[data-rte-cmd="bold"]').click(function(t){var e,i,o,a=saveSelection(),n=getSelected();if(window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),o=isNaN(u(e).css("font-weight"))?"bold"==u(e).css("font-weight")?"normal":"bold":u(e).css("font-weight")<=500?"bold":"normal",""!=u.trim(n)){try{document.execCommand("bold",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("bold",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}a=saveSelection()}else{if("b"==u(e).prop("tagName").toLowerCase()){selectElementContents(e);try{document.execCommand("bold",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("bold",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}}else u(e).css("font-weight",o)}""==u.trim(n)&&restoreSelection(a),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="italic"]').off("click"),u('[data-rte-cmd="italic"]').click(function(t){var e,i,o,a=saveSelection(),n=getSelected();if(window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),o="italic"==u(e).css("font-style")?"normal":"italic",""!=u.trim(n)){try{document.execCommand("italic",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("italic",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}a=saveSelection()}else{var s=u(e).prop("tagName").toLowerCase();if("i"==s||"em"==s){selectElementContents(e);try{document.execCommand("italic",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("italic",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}}else u(e).css("font-style",o)}""==u.trim(n)&&restoreSelection(a),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="underline"]').off("click"),u('[data-rte-cmd="underline"]').click(function(t){var e,i,o,a=saveSelection(),n=getSelected();if(window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),o=-1!=u(e).css("text-decoration").indexOf("underline")?"":"underline",""!=u.trim(n)){try{document.execCommand("underline",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("underline",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}a=saveSelection()}else{if("u"==u(e).prop("tagName").toLowerCase()){selectElementContents(e);try{document.execCommand("underline",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("underline",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}}else u(e).css("text-decoration",o)}""==u.trim(n)&&restoreSelection(a),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="strikethrough"]').off("click"),u('[data-rte-cmd="strikethrough"]').click(function(t){var e,i,o,a=saveSelection(),n=getSelected();if(window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),o=-1!=u(e).css("text-decoration").indexOf("line-through")?"":"line-through",""!=u.trim(n)){try{document.execCommand("strikethrough",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("strikethrough",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}a=saveSelection()}else{if("strike"==u(e).prop("tagName").toLowerCase()){selectElementContents(e);try{document.execCommand("strikethrough",!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand("strikethrough",!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}}else u(e).css("text-decoration",o)}""==u.trim(n)&&restoreSelection(a),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="uppercase"]').off("click"),u('[data-rte-cmd="uppercase"]').click(function(t){var e,i,o,a=saveSelection(),n=getSelected();window.getSelection?e=3==(i=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?i.parentNode:i:document.selection&&(i=document.selection.createRange(),e=document.selection.createRange().parentElement()),o="uppercase"==u(e).css("text-transform")?"":"uppercase",u(e).css("text-transform",o),""==u.trim(n)&&restoreSelection(a),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()}),u('[data-rte-cmd="table"]').off("click"),u('[data-rte-cmd="table"]').click(function(t){var s=saveSelection(),e=u(this).offset().top-u(window).scrollTop(),i=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-table").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?i=i-57-163:i+=57):e+=51,u("#pop-table").css("position","fixed"),u("#pop-table").css("top",e+"px"),u("#pop-table").css("left",i+"px"),f.data("contenteditor").closePop(),u("#pop-table").css("display","block"),u(this).addClass("on"),t.preventDefault(),u("#tableInsert td").off("mouseover"),u("#tableInsert td").on("mouseover",function(t){var i=u(this).attr("data-row"),o=u(this).attr("data-col"),a=0;u("#tableInsert tr").each(function(){var e=0;u(this).children("td").each(function(){var t=u(this);a<i&&e<o?t.addClass("highlight"):t.removeClass("highlight"),e++}),a++})}),u("#tableInsert").off("mouseout"),u("#tableInsert").on("mouseout",function(t){u("#tableInsert tr").each(function(){u(this).children("td").each(function(){u(this).removeClass("highlight")})})}),u("#tableInsert td").off("click"),u("#tableInsert td").click(function(t){restoreSelection(s);for(var e=u(this).attr("data-row"),i=u(this).attr("data-col"),o='<table class="default" style="border-collapse:collapse;width:100%;">',a=1;a<=e;a++){o+="<tr>";for(var n=1;n<=i;n++)o+='<td valign="top"><br></td>';o+="</tr>"}pasteHtmlAtCaret(o+="</table>"),f.data("contenteditor").closePop(),f.data("contenteditor").render(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()})}),u("#btnDeleteTable").off("click"),u("#btnDeleteTable").click(function(t){u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide(),u("#md-deltableconfirm").css("max-width","550px"),u("#md-deltableconfirm").simplemodal(),u("#md-deltableconfirm").data("simplemodal").show(),u("#btnDelTableOk").off("click"),u("#btnDelTableOk").on("click",function(t){u("#md-deltableconfirm").data("simplemodal").hide();var e=w.parents("table").first();e.fadeOut(400,function(){u("#divRteTable").stop(!0,!0).fadeOut(0),e.remove(),f.data("contenteditor").render(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()})}),u("#btnDelTableCancel").off("click"),u("#btnDelTableCancel").on("click",function(t){u("#md-deltableconfirm").data("simplemodal").hide()})}),u("#btnEditTable").off("click"),u("#btnEditTable").click(function(t){var p=saveSelection();f.data("contenteditor").closePop(),u("#md-edittable").css("width","267px"),u("#md-edittable").simplemodal({noOverlay:!0}),u("#md-edittable").data("simplemodal").show(),u("#tabTableDesign").off("click"),u("#tabTableDesign").on("click",function(t){u("#tabTableDesign").addClass("active"),u("#tabTableLayout").removeClass("active"),u("#divTableLayout").fadeOut(300,function(){u("#divTableDesign").fadeIn(0)})}),u("#tabTableLayout").off("click"),u("#tabTableLayout").on("click",function(t){u("#tabTableDesign").removeClass("active"),u("#tabTableLayout").addClass("active"),u("#divTableDesign").fadeOut(0,function(){u("#divTableLayout").fadeIn(300)})}),u("#inpCellBgColor").colorPicker||$("#inpCellBgColor").colorPicker.destroy(),u("#inpCellBgColor").colorPicker({dark:"#222",light:"#DDD",renderCallback:function(t,e){if(!0===e)u("#inpCellBgColor").attr("data-initial-color",u("#inpCellBgColor").val());else if(!1===e)u("#inpCellBgColor").attr("data-initial-color")!=u("#inpCellBgColor").val()&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellBgColor").attr("data-initial-color",u("#inpCellBgColor").val()));else{if(!w)return;var i=u("#inpCellBgColor").val();restoreSelection(p);var o=u("#selTableApplyTo").val(),a=w.parents("table").first()[0],n=w.parents("tr").first()[0],s=w[0];"currentcell"==o&&w.css("background-color",i);for(var r=0;r<a.rows.length;r++)for(var l=a.rows[r],d=0;d<l.cells.length;d++){var c=l.cells[d];"table"==o&&u(c).css("background-color",i),"evenrows"==o&&isEven(r+1)&&u(c).css("background-color",i),"oddrows"!=o||isEven(r+1)||u(c).css("background-color",i),"currentrow"==o&&l==w.parents("tr").first()[0]&&u(c).css("background-color",i),"currentcol"==o&&d==getCellIndex(a,n,s)&&u(c).css("background-color",i)}}}});var c=!1;u("#inpCellBgColor").off("keyup"),u("#inpCellBgColor").on("keyup",function(t){c=!0}),u("#inpCellBgColor").off("blur"),u("#inpCellBgColor").on("blur",function(){if(w){restoreSelection(p);var t=u("#inpCellBgColor").val(),e=u("#selTableApplyTo").val(),i=w.parents("table").first()[0],o=w.parents("tr").first()[0],a=w[0];"currentcell"==e&&w.css("background-color",t);for(var n=0;n<i.rows.length;n++)for(var s=i.rows[n],r=0;r<s.cells.length;r++){var l=s.cells[r];"table"==e&&u(l).css("background-color",t),"evenrows"==e&&isEven(n+1)&&u(l).css("background-color",t),"oddrows"!=e||isEven(n+1)||u(l).css("background-color",t),"currentrow"==e&&s==w.parents("tr").first()[0]&&u(l).css("background-color",t),"currentcol"==e&&r==getCellIndex(i,o,a)&&u(l).css("background-color",t)}(u("#inpCellBgColor").attr("data-initial-color")!=u("#inpCellBgColor").val()||c)&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellBgColor").attr("data-initial-color",u("#inpCellBgColor").val()),c=!1)}}),u("#inpCellTextColor").colorPicker||$("#inpCellTextColor").colorPicker.destroy(),u("#inpCellTextColor").colorPicker({dark:"#222",light:"#DDD",renderCallback:function(t,e){if(!0===e)u("#inpCellTextColor").attr("data-initial-color",u("#inpCellTextColor").val());else if(!1===e)u("#inpCellTextColor").attr("data-initial-color")!=u("#inpCellTextColor").val()&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellTextColor").attr("data-initial-color",u("#inpCellTextColor").val()));else{if(!w)return;var i=u("#inpCellTextColor").val();restoreSelection(p);var o=u("#selTableApplyTo").val(),a=w.parents("table").first()[0],n=w.parents("tr").first()[0],s=w[0];"currentcell"==o&&w.css("color",i);for(var r=0;r<a.rows.length;r++)for(var l=a.rows[r],d=0;d<l.cells.length;d++){var c=l.cells[d];"table"==o&&u(c).css("color",i),"evenrows"==o&&isEven(r+1)&&u(c).css("color",i),"oddrows"!=o||isEven(r+1)||u(c).css("color",i),"currentrow"==o&&l==w.parents("tr").first()[0]&&u(c).css("color",i),"currentcol"==o&&d==getCellIndex(a,n,s)&&u(c).css("color",i)}}}}),u("#inpCellTextColor").off("keyup"),u("#inpCellTextColor").on("keyup",function(t){c=!0}),u("#inpCellTextColor").off("blur"),u("#inpCellTextColor").on("blur",function(){if(w){restoreSelection(p);var t=u("#inpCellTextColor").val(),e=u("#selTableApplyTo").val(),i=w.parents("table").first()[0],o=w.parents("tr").first()[0],a=w[0];"currentcell"==e&&w.css("color",t);for(var n=0;n<i.rows.length;n++)for(var s=i.rows[n],r=0;r<s.cells.length;r++){var l=s.cells[r];"table"==e&&u(l).css("color",t),"evenrows"==e&&isEven(n+1)&&u(l).css("color",t),"oddrows"!=e||isEven(n+1)||u(l).css("color",t),"currentrow"==e&&s==w.parents("tr").first()[0]&&u(l).css("color",t),"currentcol"==e&&r==getCellIndex(i,o,a)&&u(l).css("color",t)}(u("#inpCellTextColor").attr("data-initial-color")!=u("#inpCellTextColor").val()||c)&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellTextColor").attr("data-initial-color",u("#inpCellTextColor").val()),c=!1)}}),u("#inpCellBorderColor").colorPicker||$("#inpCellBorderColor").colorPicker.destroy(),u("#inpCellBorderColor").colorPicker({dark:"#222",light:"#DDD",renderCallback:function(t,e){if(!0===e)u("#inpCellBorderColor").attr("data-initial-color",u("#inpCellBorderColor").val());else if(!1===e)u("#inpCellBorderColor").attr("data-initial-color")!=u("#inpCellBorderColor").val()&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellBorderColor").attr("data-initial-color",u("#inpCellBorderColor").val()));else{if(!w)return;var i=u("#inpCellBorderColor").val(),o=u("#selCellBorderWidth").val();"0"==o&&(u("#selCellBorderWidth").val(1),o=1),restoreSelection(p);var a=u("#selTableApplyTo").val(),n=w.parents("table").first()[0],s=w.parents("tr").first()[0],r=w[0];"currentcell"==a&&(w.css("border-color",i),w.css("border-width",o+"px"),w.css("border-style","solid"));for(var l=0;l<n.rows.length;l++)for(var d=n.rows[l],c=0;c<d.cells.length;c++){var m=d.cells[c];"table"==a&&(u(m).css("border-color",i),u(m).css("border-width",o+"px"),u(m).css("border-style","solid")),"evenrows"==a&&isEven(l+1)&&(u(m).css("border-color",i),u(m).css("border-width",o+"px"),u(m).css("border-style","solid")),"oddrows"!=a||isEven(l+1)||(u(m).css("border-color",i),u(m).css("border-width",o+"px"),u(m).css("border-style","solid")),"currentrow"==a&&d==w.parents("tr").first()[0]&&(u(m).css("border-color",i),u(m).css("border-width",o+"px"),u(m).css("border-style","solid")),"currentcol"==a&&c==getCellIndex(n,s,r)&&(u(m).css("border-color",i),u(m).css("border-width",o+"px"),u(m).css("border-style","solid"))}}}}),u("#inpCellBorderColor").off("keyup"),u("#inpCellBorderColor").on("keyup",function(t){c=!0}),u("#inpCellBorderColor").off("blur"),u("#inpCellBorderColor").on("blur",function(){if(w){restoreSelection(p);var t=u("#inpCellBorderColor").val(),e=u("#selCellBorderWidth").val(),i=u("#selTableApplyTo").val(),o=w.parents("table").first()[0],a=w.parents("tr").first()[0],n=w[0];"currentcell"==i&&(w.css("border-color",t),w.css("border-width",e+"px"),w.css("border-style","solid"),""==t&&(w.css("border-color",""),w.css("border-width",""),w.css("border-style",""),u("#selCellBorderWidth").val(0)));for(var s=0;s<o.rows.length;s++)for(var r=o.rows[s],l=0;l<r.cells.length;l++){var d=r.cells[l];"table"==i&&(u(d).css("border-color",t),u(d).css("border-width",e+"px"),u(d).css("border-style","solid"),""==t&&(u(d).css("border-color",""),u(d).css("border-width",""),u(d).css("border-style",""),u("#selCellBorderWidth").val(0))),"evenrows"==i&&isEven(s+1)&&(u(d).css("border-color",t),u(d).css("border-width",e+"px"),u(d).css("border-style","solid"),""==t&&(u(d).css("border-color",""),u(d).css("border-width",""),u(d).css("border-style",""),u("#selCellBorderWidth").val(0))),"oddrows"!=i||isEven(s+1)||(u(d).css("border-color",t),u(d).css("border-width",e+"px"),u(d).css("border-style","solid"),""==t&&(u(d).css("border-color",""),u(d).css("border-width",""),u(d).css("border-style",""),u("#selCellBorderWidth").val(0))),"currentrow"==i&&r==w.parents("tr").first()[0]&&(u(d).css("border-color",t),u(d).css("border-width",e+"px"),u(d).css("border-style","solid"),""==t&&(u(d).css("border-color",""),u(d).css("border-width",""),u(d).css("border-style",""),u("#selCellBorderWidth").val(0))),"currentcol"==i&&l==getCellIndex(o,a,n)&&(u(d).css("border-color",t),u(d).css("border-width",e+"px"),u(d).css("border-style","solid"),""==t&&(u(d).css("border-color",""),u(d).css("border-width",""),u(d).css("border-style",""),u("#selCellBorderWidth").val(0)))}(u("#inpCellBorderColor").attr("data-initial-color")!=u("#inpCellBorderColor").val()||c)&&(f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,saveForUndo(),u("#inpCellBorderColor").attr("data-initial-color",u("#inpCellBorderColor").val()),c=!1)}}),u("#selCellBorderWidth").off("change"),u("#selCellBorderWidth").on("change",function(){if(w){var t=u("#selCellBorderWidth").val(),e=u("#inpCellBorderColor").val();""==e&&(u("#inpCellBorderColor").val("rgb(0, 0, 0)"),u("#inpCellBorderColor").css("background-color","rgb(0, 0, 0)"),u("#inpCellBorderColor").css("color","#ddd"),e="rgb(0, 0, 0)"),restoreSelection(p);var i=u("#selTableApplyTo").val(),o=w.parents("table").first()[0],a=w.parents("tr").first()[0],n=w[0];"currentcell"==i&&(w.css("border-width",t+"px"),w.css("border-style","solid"),w.css("border-color",e),"0"==t&&(w.css("border-width",""),w.css("border-style",""),w.css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color","")));for(var s=0;s<o.rows.length;s++)for(var r=o.rows[s],l=0;l<r.cells.length;l++){var d=r.cells[l];"table"==i&&(u(d).css("border-width",t+"px"),u(d).css("border-style","solid"),u(d).css("border-color",e),"0"==t&&(u(d).css("border-width",""),u(d).css("border-style",""),u(d).css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color",""))),"evenrows"==i&&isEven(s+1)&&(u(d).css("border-width",t+"px"),u(d).css("border-style","solid"),u(d).css("border-color",e),"0"==t&&(u(d).css("border-width",""),u(d).css("border-style",""),u(d).css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color",""))),"oddrows"!=i||isEven(s+1)||(u(d).css("border-width",t+"px"),u(d).css("border-style","solid"),u(d).css("border-color",e),"0"==t&&(u(d).css("border-width",""),u(d).css("border-style",""),u(d).css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color",""))),"currentrow"==i&&r==w.parents("tr").first()[0]&&(u(d).css("border-width",t+"px"),u(d).css("border-style","solid"),u(d).css("border-color",e),"0"==t&&(u(d).css("border-width",""),u(d).css("border-style",""),u(d).css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color",""))),"currentcol"==i&&l==getCellIndex(o,a,n)&&(u(d).css("border-width",t+"px"),u(d).css("border-style","solid"),u(d).css("border-color",e),"0"==t&&(u(d).css("border-width",""),u(d).css("border-style",""),u(d).css("border-color",""),u("#inpCellBorderColor").val(""),u("#inpCellBorderColor").css("background-color","")))}f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="rowabove"]').off("click"),u('[data-rte-cmd="rowabove"]').click(function(t){if(w){for(var e=w.parents("table").first()[0],i=w.parents("tr").first()[0],o=e.insertRow(i.rowIndex),a=0;a<i.cells.length;a++){var n=o.insertCell(o.cells.length);u(n).attr("style",w.attr("style")),u(n).attr("valign","top"),u(n).html("<br>")}f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="rowbelow"]').off("click"),u('[data-rte-cmd="rowbelow"]').click(function(t){if(w){for(var e=w.parents("table").first()[0],i=w.parents("tr").first()[0],o=e.insertRow(i.rowIndex+1),a=0;a<i.cells.length;a++){var n=o.insertCell(o.cells.length);u(n).attr("style",w.attr("style")),u(n).attr("valign","top"),u(n).html("<br>")}f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="columnleft"]').off("click"),u('[data-rte-cmd="columnleft"]').click(function(t){if(w){for(var e=w.parents("table").first()[0],i=(w.parents("tr").first()[0],w[0].cellIndex),o=0;o<e.rows.length;o++){var a=e.rows[o].insertCell(i);u(a).attr("style",w.attr("style")),u(a).attr("valign","top"),u(a).html("<br>")}f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="columnright"]').off("click"),u('[data-rte-cmd="columnright"]').click(function(t){if(w){for(var e=w.parents("table").first()[0],i=(w.parents("tr").first()[0],w[0].cellIndex),o=0;o<e.rows.length;o++){var a=e.rows[o].insertCell(i+1);u(a).attr("style",w.attr("style")),u(a).attr("valign","top"),u(a).html("<br>")}f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="delrow"]').off("click"),u('[data-rte-cmd="delrow"]').click(function(t){if(w){var e=w.parents("table").first()[0],i=w.parents("tr").first()[0];e.deleteRow(i.rowIndex),w=null,0==e.rows.length&&(e.parentNode.removeChild(e),u("#divRteTable").stop(!0,!0).fadeOut(0),u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide()),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="delcolumn"]').off("click"),u('[data-rte-cmd="delcolumn"]').click(function(t){if(w){for(var e=w.parents("table").first()[0],i=(w.parents("tr").first()[0],w[0].cellIndex),o=0;o<e.rows.length;o++)e.rows[o].deleteCell(i);w=null,0==e.rows[0].cells.length&&(e.parentNode.removeChild(e),u("#divRteTable").stop(!0,!0).fadeOut(0),u("#md-edittable").data("simplemodal")&&u("#md-edittable").data("simplemodal").hide()),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}}),u('[data-rte-cmd="mergecell"]').off("click"),u('[data-rte-cmd="mergecell"]').click(function(t){if(w){var e=w.parents("table").first()[0],i=w.parents("tr").first()[0],o=w[0];o.colSpan=o.colSpan+1,o.cellIndex+1<e.rows[i.rowIndex].cells.length&&e.rows[i.rowIndex].deleteCell(o.cellIndex+1),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),saveForUndo()}})}),u('[data-rte-cmd="align"]').off("click"),u('[data-rte-cmd="align"]').click(function(a){var n=saveSelection(),t=u(this).offset().top-u(window).scrollTop(),e=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-align").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?e-=58:e+=57):t+=51,u("#pop-align").css("position","fixed"),u("#pop-align").css("top",t+"px"),u("#pop-align").css("left",e+"px"),f.data("contenteditor").closePop(),u("#pop-align").css("display","block"),u(this).addClass("on"),a.preventDefault(),u(".md-pickalign").off("click"),u(".md-pickalign").click(function(){var t,e;restoreSelection(n),window.getSelection?t=3==(e=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?e.parentNode:e:document.selection&&(e=document.selection.createRange(),t=document.selection.createRange().parentElement());var i=u(this).data("align"),o=u(t).prop("tagName").toLowerCase();"h1"==o||"h2"==o||"h3"==o||"h4"==o||"h5"==o||"h6"==o||"p"==o||"div"==o?u(t).css("text-align",i):u(t).parents("h1,h2,h3,h4,h5,h6,p,div").first().css("text-align",i),u(this).blur(),f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),a.preventDefault(),saveForUndo()})}),u('[data-rte-cmd="list"]').off("click"),u('[data-rte-cmd="list"]').click(function(t){var o=saveSelection(),e=u(this).offset().top-u(window).scrollTop(),i=u(this).offset().left;u("#rte-toolbar").hasClass("rte-side")?(u("#pop-list").addClass("rte-side"),u("#rte-toolbar").hasClass("right")?i-=58:i+=57):e+=51,u("#pop-list").css("position","fixed"),u("#pop-list").css("top",e+"px"),u("#pop-list").css("left",i+"px"),f.data("contenteditor").closePop(),u("#pop-list").css("display","block"),u(this).addClass("on"),t.preventDefault(),u(".md-picklist").off("click"),u(".md-picklist").click(function(){restoreSelection(o);var e=u(this).data("list");try{if("normal"==e)document.execCommand("outdent",!1,null),document.execCommand("outdent",!1,null),document.execCommand("outdent",!1,null);else document.execCommand(e,!1,null),window.getSelection?i=(i=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode).parentNode:document.selection&&(i=(i=document.selection.createRange().parentElement()).parentElement()),"UL"!=i.nodeName&&"OL"!=i.nodeName||"p"==u(i).parent().prop("tagName").toLowerCase()&&(i.setAttribute("contenteditable",!0),u(i).parent().replaceWith(function(){return this.innerHTML}))}catch(t){var i;b.parents("div").addClass("edit"),window.getSelection?i=(i=window.getSelection().getRangeAt(0).commonAncestorContainer.parentNode).parentNode:document.selection&&(i=(i=document.selection.createRange().parentElement()).parentElement()),i.setAttribute("contenteditable",!0),"normal"==e?(document.execCommand("outdent",!1,null),document.execCommand("outdent",!1,null),document.execCommand("outdent",!1,null)):document.execCommand(e,!1,null),i.removeAttribute("contenteditable"),f.data("contenteditor").render()}f.data("contenteditor").getState(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").settings.onChange(),t.preventDefault(),saveForUndo()})}),u('[data-rte-cmd="createLink"]').off("click"),u('[data-rte-cmd="createLink"]').click(function(t){var e,i="";if(void 0!==window.getSelection){var o=window.getSelection();if(o.rangeCount){for(var a=document.createElement("div"),n=0,s=o.rangeCount;n<s;++n)a.appendChild(o.getRangeAt(n).cloneContents());i=a.innerHTML}}else void 0!==document.selection&&"Text"==document.selection.type&&(i=document.selection.createRange().htmlText);if(""==i){for(var r=window.getSelection(),l=r.getRangeAt(0),d=r.anchorNode;0!==l.startOffset;)if(l.setStart(d,l.startOffset-1),0===l.toString().search(/\s/)){l.setStart(d,l.startOffset+1);break}for(;l.endOffset<d.length;)if(l.setEnd(d,l.endOffset+1),-1!==l.toString().search(/\s/)){l.setEnd(d,l.endOffset-1);break}selectRange(l)}window.getSelection?e=window.getSelection().getRangeAt(0).commonAncestorContainer:document.selection&&(e=document.selection.createRange()),"a"==e.nodeName.toLowerCase()?v=u(e):(document.execCommand("createLink",!1,"http://dummy"),(v=u("a[href='http://dummy']").first()).attr("href","http://")),u("#md-createlink").css("max-width","550px"),u("#md-createlink").simplemodal({noOverlay:!0,onCancel:function(){"http://"==v.attr("href")&&v.replaceWith(v.html())}}),u("#md-createlink").data("simplemodal").show(),f.data("contenteditor").closePop(),u("#txtLink").val(v.attr("href")),u("#txtLinkText").val(v.html()),u("#txtLinkTitle").val(v.attr("title")),"_blank"==v.attr("target")?u("#chkNewWindow").prop("checked",!0):u("#chkNewWindow").prop("checked",!1),u("#btnLinkOk").off("click"),u("#btnLinkOk").on("click",function(t){v.attr("href",u("#txtLink").val()),"http://"!=u("#txtLink").val()&&""!=u("#txtLink").val()||v.replaceWith(v.html()),v.html(u("#txtLinkText").val()),v.attr("title",u("#txtLinkTitle").val()),u("#chkNewWindow").is(":checked")?v.attr("target","_blank"):v.removeAttr("target"),u("#md-createlink").data("simplemodal").hide(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").render(),saveForUndo()}),t.preventDefault()}),u('[data-rte-cmd="icon"]').off("click"),u('[data-rte-cmd="icon"]').click(function(t){$savedSel=saveSelection(),$activeIcon=null;var e=f.data("contenteditor").settings.iconselect;-1!=u("#ifrIconSelect").attr("src").indexOf("blank.html")&&u("#ifrIconSelect").attr("src",e),u("#md-icon-select").css("max-width","775px"),u("#md-icon-select").simplemodal({noOverlay:!0}),u("#md-icon-select").data("simplemodal").show($savedSel),f.data("contenteditor").closePop(),t.preventDefault()}),u('[data-rte-cmd="tags"]').off("click"),u('[data-rte-cmd="tags"]').click(function(t){u("#md-tags-select").css("max-width","255px"),u("#md-tags-select").simplemodal({noOverlay:!0}),u("#md-tags-select").data("simplemodal").show(savedSel),f.data("contenteditor").closePop();for(var e="",i=0;i<f.data("contenteditor").settings.customTags.length;i++)e+='<button class="md-pick-tag" style="width:100%" data-value="'+f.data("contenteditor").settings.customTags[i][1]+'"> '+f.data("contenteditor").settings.customTags[i][0]+" </button>";u("#divCustomTags").html(e),u(".md-pick-tag").off("click"),u(".md-pick-tag").click(function(){pasteHtmlAtCaret(u(this).data("value"),!0),u("#md-tags-select").data("simplemodal").hide(),saveForUndo()}),t.preventDefault()}),f.off("mouseenter mouseleave",".embed-responsive"),f.on("mouseenter mouseleave",".embed-responsive",function(t){switch(t.type){case"mouseenter":if(0<u(this).parents("[data-html]").length)return;if(0<u(this).parents("[data-mode='readonly']").length)return;if(0<u(this).parents("[data-mode='readonly-protected']").length)return;var e,i,o=u(window).scrollTop(),a=u(this).offset().top,n=u(this).offset().left,s=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),r=detectIE(),l=!0;if((s||r)&&(l=!1),l)e=a-20+(o-o),i=n;else{if(r){var d=f.getPos().top,c=-d/1.1+d/1.1,m=f.getPos().left,p=-m+m,g=u(this).getPos();e=g.top-20+c,i=g.left+p}s&&(e=a-20,i=n)}u("#divFrameLink").css("top",e+"px"),u("#divFrameLink").css("left",i+"px"),u("#divFrameLink").stop(!0,!0).css({display:"none"}).fadeIn(20),C=u(this).find("iframe"),u("#divFrameLink").off("click"),u("#divFrameLink").on("click",function(t){var e=C.attr("src");null!=/^.*\/\/www.youtube.com\/embed\//.exec(e)||null!=/^.*\/\/player.vimeo.com\/video\//.exec(e)?(u("#md-createiframe").data("simplemodal")&&u("#md-createiframe").data("simplemodal").hide(),u("#md-createsrc").css("max-width","550px"),u("#md-createsrc").simplemodal({noOverlay:!0}),u("#md-createsrc").data("simplemodal").show(),f.data("contenteditor").closePop(),u("#txtSrc").val(C.attr("src")),u("#btnSrcOk").off("click"),u("#btnSrcOk").on("click",function(t){var e=u("#txtSrc").val(),i=/^http[s]?:\/\/(((www.youtube.com\/watch\?(feature=player_detailpage&)?)v=)|(youtu.be\/))([^#\&\?]*)/.exec(e),o=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(video\/))?([0-9]+)\/?/.exec(e);if(null!=i||null!=o){if(null!=i&&7<=i.length)e="//www.youtube.com/embed/"+i[6]+"?rel=0";if(null!=o&&7<=o.length)e="//player.vimeo.com/video/"+o[6]}C.attr("src",e),""==u("#txtSrc").val()&&C.attr("src",""),u("#md-createsrc").data("simplemodal").hide(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").render(),saveForUndo()})):(u("#md-createsrc").data("simplemodal")&&u("#md-createsrc").data("simplemodal").hide(),u("#md-createiframe").css("max-width","550px"),u("#md-createiframe").simplemodal({noOverlay:!0}),u("#md-createiframe").data("simplemodal").show(),f.data("contenteditor").closePop(),u("#txtIframe").val(C[0].outerHTML),u("#btnIframeOk").off("click"),u("#btnIframeOk").on("click",function(t){var e=u("#txtIframe").val();""!=e&&C.replaceWith(e),u("#md-createiframe").data("simplemodal").hide(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").render(),saveForUndo()}))}),u("#divFrameLink").off("mouseenter mouseleave"),u("#divFrameLink").on("mouseenter mouseleave",function(t){switch(t.type){case"mouseenter":u(this).stop(!0,!0).css("display","block");break;case"mouseleave":u(this).stop(!0,!0).fadeOut(0)}}),"none"==u(this).parents(".ui-draggable").css("outline-style")&&u(this).find(".ovl").css("z-index","1");break;case"mouseleave":u(this).find(".ovl").css("z-index","-1"),u("#divFrameLink").stop(!0,!0).fadeOut(0)}}),f.off("mouseenter mouseleave","a"),f.on("mouseenter mouseleave","a",function(t){if(!u(this).hasClass("not-a"))switch(t.type){case"mouseenter":if("block"==u("#md-createlink").css("display"))return;if(0<u(this).parents("[data-html]").length)return;if(0<u(this).parents("[data-mode='readonly']").length)return;if(0<u(this).parents("[data-mode='readonly-protected']").length)return;if(1==u(this).children("img").length&&1==u(this).children().length)return;var e,i,o=u(window).scrollTop(),a=u(this).offset().top,n=u(this).offset().left,s=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),r=detectIE(),l=!0;if((s||r)&&(l=!1),l)e=a-27+(o-o),i=n;else{if(r){var d=f.getPos().top,c=-d/1.1+d/1.1,m=f.getPos().left,p=-m+m,g=u(this).getPos();e=g.top-25+c,i=g.left+p}s&&(e=a-25,i=n)}u("#divRteLink").css("top",e+"px"),u("#divRteLink").css("left",i+"px"),u("#divRteLink").stop(!0,!0).css({display:"none"}).fadeIn(20),v=u(this),u("#divRteLink").off("click"),u("#divRteLink").on("click",function(t){u("#md-createlink").css("max-width","550px"),u("#md-createlink").simplemodal({noOverlay:!0,onCancel:function(){"http://"==v.attr("href")&&v.replaceWith(v.html())}}),u("#md-createlink").data("simplemodal").show(),f.data("contenteditor").closePop(),u("#txtLink").val(v.attr("href")),u("#txtLinkText").val(v.html()),u("#txtLinkTitle").val(v.attr("title")),"_blank"==v.attr("target")?u("#chkNewWindow").prop("checked",!0):u("#chkNewWindow").prop("checked",!1),u("#btnLinkOk").off("click"),u("#btnLinkOk").on("click",function(t){v.attr("href",u("#txtLink").val()),"http://"!=u("#txtLink").val()&&""!=u("#txtLink").val()||v.replaceWith(v.html()),v.html(u("#txtLinkText").val()),v.attr("title",u("#txtLinkTitle").val()),u("#chkNewWindow").is(":checked")?v.attr("target","_blank"):v.removeAttr("target"),u("#md-createlink").data("simplemodal").hide(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,f.data("contenteditor").render(),saveForUndo()})}),u("#divRteLink").off("mouseenter mouseleave"),u("#divRteLink").on("mouseenter mouseleave",function(t){switch(t.type){case"mouseenter":u(this).stop(!0,!0).css("display","block");break;case"mouseleave":u(this).stop(!0,!0).fadeOut(0)}});break;case"mouseleave":u("#divRteLink").stop(!0,!0).fadeOut(0)}}),u("#btnLinkBrowse").off("click"),u("#btnLinkBrowse").on("click",function(t){u("#divToolImg").stop(!0,!0).fadeOut(0),u("#divToolImgSettings").stop(!0,!0).fadeOut(0),u("#divRteLink").stop(!0,!0).fadeOut(0),u("#divFrameLink").stop(!0,!0).fadeOut(0),"function(){}"!=(f.data("contenteditor").settings.onFileSelectClick+"").replace(/\s/g,"")?f.data("contenteditor").settings.onFileSelectClick({targetInput:u("#txtLink").get(0),theTrigger:u("#btnLinkBrowse").get(0)}):(u("#ifrFileBrowse").attr("src",f.data("contenteditor").settings.fileselect),u("#active-input").val("txtLink"),u("#md-fileselect").css("width","65%"),u("#md-fileselect").simplemodal(),u("#md-fileselect").data("simplemodal").show(),f.data("contenteditor").closePop())}),f.data("contenteditor").settings.onRender(),f.data("contenteditor").contentRender()},this.prepareRteCommand=function(e){u('[data-rte-cmd="'+e+'"]').off("click"),u('[data-rte-cmd="'+e+'"]').click(function(t){try{document.execCommand(e,!1,null)}catch(t){f.attr("contenteditable",!0),document.execCommand(e,!1,null),f.removeAttr("contenteditable"),f.data("contenteditor").render()}f.data("contenteditor").getState(),f.data("contenteditor").settings.onChange(),f.data("contenteditor").settings.hasChanged=!0,t.preventDefault()})},this.applyColor=function(t,e){var i,o;window.getSelection?i=3==(o=window.getSelection().getRangeAt(0).commonAncestorContainer).nodeType?o.parentNode:o:document.selection&&(o=document.selection.createRange(),i=document.selection.createRange().parentElement());var a=u("#selColorApplyTo").val();if(""!=u.trim(e)&&u(i).text()!=e){1==a&&document.execCommand("ForeColor",!1,t),2==a&&document.execCommand("BackColor",!1,t);for(var n=document.getElementsByTagName("font"),s=0,r=n.length;s<r;++s){""!=(t=n[s].color)&&(n[s].removeAttribute("color"),n[s].style.color=t)}detectIE()&&b.find("span").each(function(){if(1==u(this).find("span").length&&u(this).text()==u(this).find("span:first").text()){var t=u(this).find("span:first").attr("style");u(this).html(u(this).find("span:first").html());var e=u(this).attr("style")+";"+t;u(this).attr("style",e)}})}else u(i).text()==e?(1==a&&(u(i).html()?u(i).css("color",t):u(i).parent().css("color",t)),2==a&&(u(i).html()?u(i).css("background-color",t):u(i).parent().css("background-color",t))):(1==a&&u(i).css("color",t),2==a&&u(i).css("background-color",t));3==a&&u(i).parents(".ui-draggable").children().first().css("background-color",t)},this.init()},u.fn.contenteditor=function(e){return this.each(function(){if(instances.push(this),null==u(this).data("contenteditor")){var t=new u.contenteditor(this,e);u(this).data("contenteditor",t)}})}}(jQuery);var getSelectedNode=function(){var t,e;if(window.getSelection&&(t=(e=getSelection()).anchorNode),!t&&document.selection){var i=(e=document.selection).getRangeAt?e.getRangeAt(0):e.createRange();t=i.commonAncestorContainer?i.commonAncestorContainer:i.parentElement?i.parentElement():i.item(0)}if(t)return"#text"==t.nodeName?t.parentNode:t},$savedSel,$activeIcon,$imgActive;function getSelected(){if(window.getSelection)return window.getSelection();if(document.getSelection)return document.getSelection();var t=document.selection&&document.selection.createRange();return!!t.text&&t.text}function pasteHtmlAtCaret(t,e){var i,o;if(window.getSelection){if((i=window.getSelection()).getRangeAt&&i.rangeCount){(o=i.getRangeAt(0)).deleteContents();var a=document.createElement("div");a.innerHTML=t;for(var n,s,r=document.createDocumentFragment();n=a.firstChild;)s=r.appendChild(n);var l=r.firstChild;o.insertNode(r),s&&((o=o.cloneRange()).setStartAfter(s),e?o.setStartBefore(l):o.collapse(!0),i.removeAllRanges(),i.addRange(o))}}else if((i=document.selection)&&"Control"!=i.type){var d=i.createRange();d.collapse(!0),i.createRange().pasteHTML(t),e&&((o=i.createRange()).setEndPoint("StartToStart",d),o.select())}}function applyIconClass(t){if($activeIcon){var e="";$activeIcon.hasClass("size-12")&&(e="size-12"),$activeIcon.hasClass("size-14")&&(e="size-14"),$activeIcon.hasClass("size-16")&&(e="size-16"),$activeIcon.hasClass("size-18")&&(e="size-18"),$activeIcon.hasClass("size-21")&&(e="size-21"),$activeIcon.hasClass("size-24")&&(e="size-24"),$activeIcon.hasClass("size-32")&&(e="size-32"),$activeIcon.hasClass("size-48")&&(e="size-48"),$activeIcon.hasClass("size-64")&&(e="size-64"),$activeIcon.hasClass("size-80")&&(e="size-80"),$activeIcon.hasClass("size-96")&&(e="size-96"),$activeIcon.css("font-size",""),-1==t.indexOf("size-")&&""!=t?($activeIcon.attr("class",t),""!=e&&$activeIcon.addClass(e)):($activeIcon.removeClass("size-12"),$activeIcon.removeClass("size-14"),$activeIcon.removeClass("size-16"),$activeIcon.removeClass("size-18"),$activeIcon.removeClass("size-21"),$activeIcon.removeClass("size-24"),$activeIcon.removeClass("size-32"),$activeIcon.removeClass("size-48"),$activeIcon.removeClass("size-64"),$activeIcon.removeClass("size-80"),$activeIcon.removeClass("size-96"),$activeIcon.addClass(t))}else{restoreSelection(savedSelPublic);var i=makeid();pasteHtmlAtCaret(' <i id="'+i+'" class="'+t+'"></i> ',!0),($activeIcon=jQuery("#"+i)).removeAttr("id"),jQuery(cb_list).each(function(){jQuery(this).data("contenteditor").contentRender()})}}function applyLargerImage(t){$imgActive.parents("a").attr("href",t),jQuery(".my-file[type=file]").clearInputs()}function makeid(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",i=0;i<2;i++)t+=e.charAt(Math.floor(Math.random()*e.length));var o="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(i=0;i<5;i++)o+=a.charAt(Math.floor(Math.random()*a.length));return t+o}function sleep(t){for(var e=(new Date).getTime(),i=0;i<1e7&&!((new Date).getTime()-e>t);i++);}function getScripts(e,i){var o=0;e.forEach(function(t){$.getScript(t,function(){++o==e.length&&i()})})}!function(X){var K,Y,J,tt;X.imageembed=function(t,c){var m={hiquality:!1,imageselect:"",fileselect:"",imageEmbed:!0,linkDialog:!0,zoom:0,customval:0,largerImageHandler:"",onChanged:function(){},onImageBrowseClick:function(){},onImageSettingClick:function(){},onImageSelectClick:function(){},onFileSelectClick:function(){}};this.settings={};var G=X(t);t=t;this.init=function(){this.settings=X.extend({},m,c),0==X("#divCb").length&&X("body").append('<div id="divCb"></div>');var t="",e="";-1!=navigator.appName.indexOf("Microsoft")?(t='<div id="divToolImg"><div class="fileinputs"><input type="file" name="fileImage" id="fileImage" class="my-file" /><div class="fakefile"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAC+klEQVRoQ+2au24aQRSGz+ySkEvPA9AQubNEhXgCSogEShmZGkSQpTS8AjUNSAjXlCRNStpQ8QK8AI6UOLazM5lZvGRvswsz43hYz0iWZe3uzPnOf25rQOVymcAzWsgAZ1xto3DGBQajsFE4Yx4wIZ0xQSM4RmGjcMY8YEI6Y4LKFy0H/9TCJ7b1VsiOo0PaAAv5Wf4ho/CBPjQhneYokRyezWZQKpW4WzuOA71eD5bLZdrx++vahnSz2YRutwu5XC4RZrPZQL1eP33g4XAI1Wo1FeRYlbVQ+FA1U+kfblitVtBut2Nvf3LgQqEAk8kE2G9VC2MM4/EYRqNRZMsnBy4WizCdTiGfz6vidffhqaw98Ha7hU6nA+v1OuCQfr8PLBV46ySB/bAeoL8qJ0GfHLA/D8P9OOmap/jJAXvq1mq12NB1lW404LL/GVqtD5QTPfwwZEJz+DtcXHwEDPf0z3+f+2mbw17oxvZjhIBgGz71LqFSqcQ6xK8wgT+AyZ0L/t+AMflNz3MiNYZXpXkKI2SDhfKw3V67xYwXAdGQJhT6lj77SqgbHP3ywMLMITeB8GIn84C9PJ3P5/s+vYPdGbxYLGAwGABv3k4aPkSIBYAZMg0tfBs4L6kP+yvy7OoKzt6dg3+UTJrQtABmpOHQThs8PGjbeuMrSuDmbdLLhTbAYZXTgJmTEMrBj+sbbs6yPb1KzMIewOJOWiLh7Nog85UH/7vxobO0bb12QYJrV4jCxZA56OuXb26Oq1pSwOGwTgtPz2gLvaRqv9gzOORXpAiyiywN3jdagXtlwaWACbnf9UWBxdRjbWmnLA1l3qK92kYs79UsOeCYaq3GrOAuokNGnC1SwLRWg4NpT37kpREwHUIwzb9HXs8LWKccZsKK/Nv24IBwYdkIGm5jB+8QuVEyh+WA2XDBqjVygfyvheJAaU9KA6cdoNt1A6ybIqrtMQqr9qhu+xmFdVNEtT1GYdUe1W0/o7Buiqi2xyis2qO67WcU1k0R1fb8BZv85KDCNGIQAAAAAElFTkSuQmCC" /></div></div></div>',e=""):(t='<div style="display:none"><input type="file" name="fileImage" id="fileImage" class="my-file"></div>',e='<div id="divToolImg"><i id="lnkEditImage" class="cb-icon-camera"></i></div>');var i='<div id="divTempContent" style="display:none"></div><div class="overlay-bg" style="position:fixed;top:0;left:0;width:1;height:1;z-index:10000;background:#fff;opacity:0.8"></div><div id="divImageEdit" style="position:absolute;display:none;z-index:10000"><div id="my-mask" style="width:200px;height:200px;overflow:hidden;"><img id="my-image" src="" style="max-width:none" /></div><div id="img-control" style="margin-top:1px;position:absolute;top:-31px;left:0px;width:235px;opacity:0.8"><button id="btnImageCancel" type="button" value="Cancel" ><i class="cb-icon-back"></i></button><button id="btnZoomOut" type="button" value="-" ><i class="cb-icon-minus"></i></button><button id="btnZoomIn" type="button" value="+" ><i class="cb-icon-plus"></i></button><button id="btnImageMore" type="button" value="..." >...</button><button id="btnChangeImage" type="button" value="Ok" ><i class="cb-icon-ok"></i> Ok</button></div><div id="divImageMore" style="display:none"><label for="chkImageNoCrop"><input id="chkImageNoCrop" type="checkbox" />No Crop</label><br>'+(""==this.settings.largerImageHandler?"":'<label for="chkImageClickToEnlarge"><input id="chkImageClickToEnlarge" type="checkbox" />Click to enlarge</label><br>')+'<button id="btnImageMoreOk" type="button" value="Ok" ><i class="cb-icon-ok"></i> Ok</button></div></div><div style="display:none;"><canvas id="myCanvas"></canvas><canvas id="myTmpCanvas"></canvas><canvas id="myTmpCanvasNoCrop"></canvas></div><form id="canvasform" name="canvasform" method="post" action="" target="canvasframe" enctype="multipart/form-data">'+t+'<input id="hidRefId" name="hidRefId" type="hidden" value="'+this.settings.customval+'" /></form><iframe id="canvasframe" name="canvasframe" style="width:1px;height:1px;border:none;visibility:hidden;position:absolute"></iframe>',o=!1;""!=this.settings.imageselect&&(o=!0),"function(){}"!=(this.settings.onImageSelectClick+"").replace(/\s/g,"")&&(o=!0);var a=!1;""!=this.settings.fileselect&&(a=!0),"function(){}"!=(this.settings.onFileSelectClick+"").replace(/\s/g,"")&&(a=!0);var C=this.settings.imageEmbed,n=e+'<div id="divToolImgSettings"><i id="lnkImageSettings" class="cb-icon-link"></i></div><div id="divToolImgLoader"><i id="lnkImageLoader" class="cb-icon-spin animate-spin"></i></div><div class="md-modal md-draggable" id="md-img"><div class="md-content"><div class="md-body"><div class="md-modal-handle"><i class="cb-icon-dot"></i><i class="cb-icon-cancel md-modal-close"></i></div><div class="md-tabs"><span id="tabImgLnk" class="active">IMAGE</span><span id="tabImgPl">CHANGE DIMENSION</span></div><div id="divImgPl" style="overflow-y:auto;overflow-x:hidden;display:none;box-sizing:border-box;padding:10px 10px 10px">';n+='<div style="padding:12px 0 0;width:100%;text-align:center;">',n+='DIMENSION (WxH): &nbsp; <select id="selImgW">';for(var s=50,r=0;r<231;r++){var l="";90==r&&(l=' selected="selected"'),n+='<option value="'+s+'"'+l+">"+s+"px</option>",s+=5}n+="</select> &nbsp; ",n+='<select id="selImgH">';var d=50;for(r=0;r<111;r++){l="";40==r&&(l=' selected="selected"'),n+='<option value="'+d+'"'+l+">"+d+"px</option>",d+=5}n+="</select> &nbsp; ",n+='<select id="selImgStyle">',n+='<option value="square">Square</option>',n+='<option value="circle">Circle</option>',n+="</select><br>",n+='<button id="btnInsertPlh" style="margin-left:12px;margin-top:12px;"> REPLACE </button><br>',n+="<p>(Re-embedding/uploading image needed)</p>",n+='</div></div><div id="divImgLnk"><div class="md-label">Source:</div>'+(o?'<input type="text" id="txtImgUrl" class="inptxt" style="float:left;width:60%"></input><i class="cb-icon-link md-btnbrowse" id="btnImageBrowse" style="width:10%;"></i>':'<input type="text" id="txtImgUrl" class="inptxt" style="float:left;width:70%"></input>')+'<br style="clear:both"><div class="md-label">Title:</div><input type="text" id="txtAltText" class="inptxt" style="float:right;width:70%"></input><br style="clear:both"><div class="md-label">Link:</div>'+(a?'<input type="text" id="txtLinkUrl" class="inptxt" style="float:left;width:60%"></input><i class="cb-icon-link md-btnbrowse" id="btnFileBrowse" style="width:10%;"></i>':'<input type="text" id="txtLinkUrl" class="inptxt" style="float:left;width:70%"></input>')+'<br style="clear:both"><div class="md-label">Target:</div><label style="float:left;" for="chkNewWindow2" class="inpchk"><input type="checkbox" id="chkNewWindow2"></input> New Window</label><br style="clear:both"><div id="divEmbedOriginal"><div class="md-label">&nbsp;</div><label style="float:left;" for="chkCrop" class="inpchk"><input type="checkbox" id="chkCrop"></input> Crop</label><br style="clear:both" /></div></div></div><div id="divImgLnkOk" class="md-footer"><button id="btnImgOk"> Ok </button></div></div></div><div class="md-modal" id="md-imageselect"><div class="md-content"><div class="md-body">'+(o?'<iframe id="ifrImageBrowse" style="width:100%;height:400px;border: none;display: block;" src="'+sScriptPath+'blank.html"></iframe>':"")+"</div></div></div>",0==X("#md-fileselect").length&&(n+='<div class="md-modal" id="md-fileselect"><div class="md-content"><div class="md-body">'+(a?'<iframe id="ifrFileBrowse" style="width:100%;height:400px;border: none;display: block;" src="'+sScriptPath+'blank.html"></iframe>':"")+"</div></div></div>"),0==X("#active-input").length&&(n+='<input type="hidden" id="active-input" />'),0==X("#divToolImg").length&&(X("#divCb").append(i),X("#divCb").append(n)),K=document.getElementById("myTmpCanvas"),Y=document.getElementById("myTmpCanvasNoCrop"),G.on("mouseenter mouseleave",function(t){switch(t.type){case"mouseenter":var e;null!=localStorage.getItem("zoom")?e=localStorage.zoom:("normal"==(e=G.parents('[style*="zoom"]').css("zoom"))&&(e=1),null==e&&(e=1));var i,o,a,n=navigator.userAgent.toLowerCase().indexOf("firefox");-1!=(e+="").indexOf("%")&&(e=e.replace("%","")/100),"NaN"==e&&(e=1),localStorage.zoom=e,e*=1,""==cb_list&&(e=1),1==G.data("imageembed").settings.zoom&&(e=1);var s=X(window).scrollTop(),r=X(this).offset().top,l=X(this).offset().left,d=(n=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),detectIE()),c=detectEdge(),m=!0;(n||d||c)&&(m=!1);var p=X(this).data("imageembed").settings.imageEmbed?-35:9;if(m)i=(r+parseInt(X(this).css("height"))/2-15)*e+(s-s*e),a=(l+parseInt(X(this).css("width"))/2-15)*e,o=i+p;else{if(d){var g=0,h=0;G.parents().each(function(){X(this).data("contentbuilder")&&(g=X(this).getPos().top,h=X(this).getPos().left)});var f=-g*e+g,u=-h*e+h,v=X(this).getPos();i=(v.top-15+parseInt(X(this).css("height"))/2)*e+f,a=(v.left-15+parseInt(X(this).css("width"))/2)*e+u,o=i+p}if(n)a=l-15+parseInt(X(this).css("width"))*e/2,o=(i=r-15+parseInt(X(this).css("height"))*e/2)+p}var b=!1;1==($imgActive=X(this)).attr("data-fixed")&&(b=!0),cb_edit&&!b&&(X("#divToolImg").css("top",i+"px"),X("#divToolImg").css("left",a+"px"),X(this).data("imageembed").settings.imageEmbed&&X("#divToolImg").stop(!0,!0).css({display:"none"}).fadeIn(20),X(this).data("imageembed").settings.linkDialog?(X("#divToolImgSettings").css("top",o+"px"),X("#divToolImgSettings").css("left",a+"px"),X("#divToolImgSettings").stop(!0,!0).css({display:"none"}).fadeIn(20)):X("#divToolImgSettings").css("top","-10000px")),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))&&X("#lnkImageSettings").on("touchstart mouseenter focus",function(t){"touchstart"==t.type&&(t.stopImmediatePropagation(),t.preventDefault()),X("#lnkImageSettings").click(),t.preventDefault(),t.stopImmediatePropagation()}),X("#divToolImg").off("click"),X("#divToolImg").on("click",function(t){X("#divToolImg").data("image",$imgActive),"function(){}"!=(G.data("imageembed").settings.onImageBrowseClick+"").replace(/\s/g,"")?G.data("imageembed").settings.onImageBrowseClick():X("input.my-file[type=file]").click(),t.preventDefault(),t.stopImmediatePropagation()}),X("#divToolImg").off("mouseenter mouseleave"),X("#divToolImg").on("mouseenter mouseleave",function(t){switch(t.type){case"mouseenter":C&&X("#divToolImg").stop(!0,!0).css("display","block"),X("#divToolImgSettings").stop(!0,!0).css("display","block");break;case"mouseleave":X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0)}}),G.off("mouseenter mouseleave","figcaption"),G.on("mouseenter mouseleave","figcaption",function(t){switch(t.type){case"mouseenter":C&&X("#divToolImg").stop(!0,!0).css("display","block"),X("#divToolImgSettings").stop(!0,!0).css("display","block");break;case"mouseleave":X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0)}}),X("#divToolImgSettings").off("mouseenter mouseleave"),X("#divToolImgSettings").on("mouseenter mouseleave",function(t){switch(t.type){case"mouseenter":C&&X("#divToolImg").stop(!0,!0).css("display","block"),X("#divToolImgSettings").stop(!0,!0).css("display","block");break;case"mouseleave":X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0)}}),X("#lnkImageSettings").off("click"),X("#lnkImageSettings").on("click",function(t){if(X("#divToolImg").data("image",$imgActive),X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0),"function(){}"==(G.data("imageembed").settings.onImageSettingClick+"").replace(/\s/g,"")){X("#md-img").css("max-width","550px"),X("#md-img").simplemodal({noOverlay:!0}),X("#md-img").data("simplemodal").show(),G.parents().each(function(){X(this).data("contenteditor")&&X(this).data("contenteditor").closePop()});var a=G;"figure"==G.prop("tagName").toLowerCase()&&(a=G.find("img:first")),-1==a.attr("src").indexOf("base64")?X("#txtImgUrl").val(a.attr("src")):X("#txtImgUrl").val("[Image Data]"),X("#txtAltText").val(a.attr("alt")),X("#txtLinkUrl").val(""),X("#chkNewWindow2").prop("checked",!1),null!=a.parents("a:first")&&(X("#txtLinkUrl").val(a.parents("a:first").attr("href")),"_blank"==a.parents("a:first").attr("target")?X("#chkNewWindow2").prop("checked",!0):X("#chkNewWindow2").prop("checked",!1)),G.data("imageembed").settings.imageEmbed?(X("#divEmbedOriginal").css("display","none"),X("#btnImgOk").off("keyup"),X("#txtImgUrl").on("keyup",function(){a.attr("src")==X("#txtImgUrl").val()?X("#divEmbedOriginal").css("display","none"):X("#divEmbedOriginal").css("display","block")})):X("#divEmbedOriginal").css("display","none"),X("#chkCrop").removeAttr("checked"),X("#btnImgOk").off("click"),X("#btnImgOk").on("click",function(t){var e;G.parents().each(function(){X(this).data("contentbuilder")&&(e=X(this).data("contentbuilder"))});var i=!1;if(X("#chkCrop").is(":checked")||(i=!0),0==i&&-1!=X("#txtImgUrl").val().indexOf("http")&&(i=!0),a.attr("src")!=X("#txtImgUrl").val()&&(i?(-1!=a.attr("src").indexOf(sScriptPath+"image.png")&&-1==X("#txtImgUrl").val().indexOf(sScriptPath+"image.png")&&(a.css("width",""),a.css("height","")),-1==X("#txtImgUrl").val().indexOf("[Image Data]")&&a.attr("src",X("#txtImgUrl").val())):y(X("#txtImgUrl").val())),a.attr("alt",X("#txtAltText").val()),"http://"==X("#txtLinkUrl").val()||""==X("#txtLinkUrl").val())a.parents("a:first").replaceWith(a.parents("a:first").html());else{var o=X("#txtLinkUrl").val();0==a.parents("a:first").length?a.wrap('<a href="'+o+'"></a>'):a.parents("a:first").attr("href",o),a.parents("a:first").attr("title",X("#txtAltText").val()),X("#chkNewWindow2").is(":checked")?a.parents("a:first").attr("target","_blank"):a.parents("a:first").removeAttr("target"),-1!=o.toLowerCase().indexOf(".jpg")||-1!=o.toLowerCase().indexOf(".jpeg")||-1!=o.toLowerCase().indexOf(".png")||-1!=o.toLowerCase().indexOf(".gif")?a.parents("a:first").addClass("is-lightbox"):a.parents("a:first").removeClass("is-lightbox")}e&&e.applyBehavior(),X("#md-img").data("simplemodal").hide()});var e=a[0].naturalWidth,i=a[0].naturalHeight;if(-1!=a.attr("src").indexOf(sScriptPath+"image.png"))for(var o=0;o<a.attr("style").split(";").length;o++){var n=a.attr("style").split(";")[o];"width"==X.trim(n.split(":")[0])&&(e=parseInt(X.trim(n.split(":")[1]))),"height"==X.trim(n.split(":")[0])&&(i=parseInt(X.trim(n.split(":")[1])))}var s=50;for(o=0;o<231;o++)e<=s&&(o=231,X("#selImgW").val(s)),s+=5;var r=50;for(o=0;o<111;o++)i<=r&&(o=111,X("#selImgH").val(r)),r+=5;500==parseInt(a.css("border-radius"))?(X("#selImgStyle").val("circle"),X("#selImgH").css("display","none")):(X("#selImgStyle").val("square"),X("#selImgH").css("display","inline")),X("#selImgStyle").off("change"),X("#selImgStyle").on("change",function(t){"circle"==X("#selImgStyle").val()?X("#selImgH").css("display","none"):X("#selImgH").css("display","inline"),X("#selImgH").val(X("#selImgW").val())}),X("#selImgW").off("change"),X("#selImgW").on("change",function(t){"circle"==X("#selImgStyle").val()&&X("#selImgH").val(X("#selImgW").val())}),X("#btnInsertPlh").off("click"),X("#btnInsertPlh").on("click",function(t){var e;G.parents().each(function(){X(this).data("contentbuilder")&&(e=X(this).data("contentbuilder"))}),a.attr("src",sScriptPath+"image.png"),a.attr("alt",X("#txtAltText").val()),"circle"==X("#selImgStyle").val()?(a.css("border-radius","500px"),X("#selImgH").val(X("#selImgW").val())):(a.css("border-radius",""),a.removeClass("circle")),a.css("width",X("#selImgW").val()+"px"),a.css("height",X("#selImgH").val()+"px"),e&&e.applyBehavior(),X("#md-img").data("simplemodal").hide()}),t.preventDefault(),t.stopImmediatePropagation()}else G.data("imageembed").settings.onImageSettingClick()}),X("#btnImageBrowse").off("click"),X("#btnImageBrowse").on("click",function(t){X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0),X("#divRteLink").stop(!0,!0).fadeOut(0),X("#divFrameLink").stop(!0,!0).fadeOut(0),"function(){}"!=(G.data("imageembed").settings.onImageSelectClick+"").replace(/\s/g,"")?G.data("imageembed").settings.onImageSelectClick({targetInput:X("#txtImgUrl").get(0),theTrigger:X("#btnImageBrowse").get(0)}):(X("#ifrImageBrowse").attr("src",G.data("imageembed").settings.imageselect),X("#active-input").val("txtImgUrl"),X("#md-imageselect").css("width","65%"),X("#md-imageselect").simplemodal(),X("#md-imageselect").data("simplemodal").show())}),X("#btnFileBrowse").off("click"),X("#btnFileBrowse").on("click",function(t){X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0),X("#divRteLink").stop(!0,!0).fadeOut(0),X("#divFrameLink").stop(!0,!0).fadeOut(0),"function(){}"!=(G.data("imageembed").settings.onFileSelectClick+"").replace(/\s/g,"")?G.data("imageembed").settings.onFileSelectClick({targetInput:X("#txtLinkUrl").get(0),theTrigger:X("#btnFileBrowse").get(0)}):(X("#ifrFileBrowse").attr("src",G.data("imageembed").settings.fileselect),X("#active-input").val("txtLinkUrl"),X("#md-fileselect").css("width","65%"),X("#md-fileselect").simplemodal(),X("#md-fileselect").data("simplemodal").show())}),X(".my-file[type=file]").off("change"),X(".my-file[type=file]").on("change",function(t){w(t),X("#my-image").attr("src","")}),X("#tabImgLnk").off("click"),X("#tabImgLnk").on("click",function(t){X("#tabImgLnk").addClass("active"),X("#tabImgPl").removeClass("active"),X("#divImgPl").fadeOut(300,function(){X("#divImgLnk").fadeIn(0),X("#divImgLnkOk").fadeIn(0)})}),X("#tabImgPl").off("click"),X("#tabImgPl").on("click",function(t){X("#tabImgLnk").removeClass("active"),X("#tabImgPl").addClass("active"),X("#divImgLnk").fadeOut(0),X("#divImgLnkOk").fadeOut(0,function(){X("#divImgPl").fadeIn(300)})});break;case"mouseleave":X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0)}})};var w=function(t){if("undefined"==typeof FileReader)return!0;var e=t.target.files[0];if(e){var i=e.name.substr(e.name.lastIndexOf(".")+1).toLowerCase();"jpg"==i||"jpeg"==i||"png"==i||"gif"==i||"bmp"==i?(X("#divToolImg").stop(!0,!0).fadeOut(0),X("#divToolImgSettings").stop(!0,!0).fadeOut(0),X("#divToolImgLoader").css("top",X("#divToolImg").css("top")),X("#divToolImgLoader").css("left",X("#divToolImg").css("left")),X("#divToolImgLoader").css("display","block"),X(".overlay-bg").css("background","none"),X(".overlay-bg").css("width","100%"),X(".overlay-bg").css("height","100%"),y(e)):alert("Please select an image")}},y=function(e){var H,_;e.name?(H=e.name,_=e.name.substr(e.name.lastIndexOf(".")+1).toLowerCase()):(H=e.substr(e.lastIndexOf("/")+1),_=e.substr(e.lastIndexOf(".")+1).toLowerCase());var W,Q,q=!1;try{q=G.data("imageembed").settings.hiquality}catch(t){}0==q&&("jpg"==_||"jpeg"==_)?(W="image/jpeg",Q=.92):(W="image/png",Q=1),loadImage.parseMetaData(e,function(t){var j;t.exif&&(j=t.exif.get("Orientation")),loadImage(e,function(t){var e,i;X(".overlay-bg").css("background","none"),X(".overlay-bg").css("width","100%"),X(".overlay-bg").css("height","100%"),3200<t.width||3200<t.height?(e=t.width/2,i=t.height/2):2500<t.width||2500<t.height?(e=t.width/1.25,i=t.height/1.25):(e=t.width,i=t.height),4<j&&j<9?(J=i,tt=e):(J=e,tt=i);var o,a,n=!1;tt<=$imgActive.height()&&J>$imgActive.width()?(o=$imgActive.width(),a=tt*$imgActive.width()/J,n=!0):J<=$imgActive.width()&&tt>$imgActive.height()?(a=$imgActive.height(),o=J*$imgActive.height()/tt,n=!0):J<=$imgActive.width()&&tt<=$imgActive.height()?(o=J,a=tt):(o=$imgActive.width(),a=tt*$imgActive.width()/J,n=!0);var s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(s||r){new MegaPixImage(t).render(Y,{width:e,height:i,orientation:j},function(){if(n){var t=new Image,e=J,i=tt;t.onload=function(){i/=2,((e/=2)<o||i<a)&&(e=o,i=a),new MegaPixImage(t).render(Y,{width:e,height:i},function(){e<=o||i<=a||(t.src=Y.toDataURL(W,Q))})},t.src=Y.toDataURL(W,Q)}})}else{var l=Y.getContext("2d");switch(4<j&&j<9?(Y.width=i,Y.height=e):(Y.width=e,Y.height=i),j){case 2:l.transform(-1,0,0,1,e,0);break;case 3:l.transform(-1,0,0,-1,e,i);break;case 4:l.transform(1,0,0,-1,0,i);break;case 5:l.transform(0,1,1,0,0,0);break;case 6:l.transform(0,1,-1,0,i,0);break;case 7:l.transform(0,-1,-1,0,i,e);break;case 8:l.transform(0,-1,1,0,0,e)}if(l.drawImage(t,0,0,e,i),n){var d=new Image,c=J,m=tt;d.onload=function(){m/=2,((c/=2)<o||m<a)&&(c=o,m=a),Y.width=c,Y.height=m,(l=Y.getContext("2d")).drawImage(d,0,0,c,m),c<=o||m<=a||(d.src=Y.toDataURL(W,Q))},d.src=Y.toDataURL(W,Q)}}$imgActive=X("#divToolImg").data("image");var p,g=localStorage.zoom;1==G.data("imageembed").settings.zoom&&(g=1),"img"==$imgActive.prop("tagName").toLowerCase()?p=$imgActive[0].naturalWidth/$imgActive.width():"figure"==$imgActive.prop("tagName").toLowerCase()&&(p=$imgActive.find("img")[0].naturalWidth/$imgActive.find("img").width());var h=0,f=0;if("img"==$imgActive.prop("tagName").toLowerCase()){if(-1!=$imgActive.attr("src").indexOf(sScriptPath+"image.png"))for(var u=0;u<$imgActive.attr("style").split(";").length;u++){var v=$imgActive.attr("style").split(";")[u];"width"==X.trim(v.split(":")[0])&&(p=(h=parseInt(X.trim(v.split(":")[1])))/$imgActive.width()),"height"==X.trim(v.split(":")[0])&&(f=parseInt(X.trim(v.split(":")[1])))}}else if("figure"==$imgActive.prop("tagName").toLowerCase()&&-1!=$imgActive.find("img").attr("src").indexOf(sScriptPath+"image.png"))for(u=0;u<$imgActive.find("img").attr("style").split(";").length;u++){v=$imgActive.find("img").attr("style").split(";")[u];"width"==X.trim(v.split(":")[0])&&(p=(h=parseInt(X.trim(v.split(":")[1])))/$imgActive.find("img").width()),"height"==X.trim(v.split(":")[0])&&(f=parseInt(X.trim(v.split(":")[1])))}var b,C;"img"==$imgActive.prop("tagName").toLowerCase()?(X("#my-mask").css("width",$imgActive.width()*p-0+"px"),X("#my-mask").css("height",$imgActive.height()*p-0+"px")):(X("#my-mask").css("width",$imgActive.innerWidth()*p-0+"px"),X("#my-mask").css("height",$imgActive.innerHeight()*p-0+"px")),0!=h&&X("#my-mask").css("width",h+"px"),0!=f&&X("#my-mask").css("height",f+"px"),X("#my-mask").css("zoom",g/p),X("#my-mask").css("-moz-transform","scale("+g/p+")");var w=$imgActive.width(),y=$imgActive.height();J/tt<w/y?C=tt*(b=w)/J:(b=J*y/tt,C=y),b*=p,C*=p,$imgActive=X("#divToolImg").data("image"),X("#my-image").css("top","0px"),X("#my-image").css("left","0px"),X("#my-image").css("width",b+"px"),X("#my-image").css("height",C+"px");var x,k,S,I;g=localStorage.zoom;g*=1,1==G.data("imageembed").settings.zoom&&(g=1);var T=X(window).scrollTop(),A=$imgActive.offset().top,L=$imgActive.offset().left,R=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),O=detectIE(),P=!0;if((R||O)&&(P=!1),P)x=A*g+(T-T*g),k=L*g,S=(A+5)*g+(T-T*g),I=(L+5)*g;else{if(O){var E=0,B=0;G.parents().each(function(){X(this).data("contentbuilder")&&(E=X(this).getPos().top,B=X(this).getPos().left)});var N=-E*g+E,z=-B*g+B,D=$imgActive.getPos();x=D.top*g+N,k=D.left*g+z,S=(D.top+5)*g+N,I=(D.left+5)*g+z}if(R){var U=parseInt($imgActive.css("width")),F=parseInt($imgActive.css("height"));z=U/2-U/2*g,N=F/2-F/2*g;X("#img-control").css("top",5+N+"px"),X("#img-control").css("left",7+z+"px"),S=(x=A-N)+5,I=(k=L-z)+5}}X("#divImageEdit").css("display","inline-block"),"img-polaroid"==$imgActive.attr("class")?(X("#divImageEdit").css("top",S+"px"),X("#divImageEdit").css("left",I+"px")):(X("#divImageEdit").css("top",x+"px"),X("#divImageEdit").css("left",k+"px")),parseInt(X("#divImageEdit").css("top"))<25&&(X("#img-control").css("top","auto"),X("#img-control").css("bottom","-24px")),X("#my-mask").css("transform-origin","left top"),V(),(R=-1<navigator.userAgent.toLowerCase().indexOf("firefox"))&&sleep(700),X("#btnImageCancel").css("display","none"),X("#btnZoomOut").css("display","none"),X("#btnZoomIn").css("display","none"),X("#btnImageMore").css("display","none"),X("#btnChangeImage").css("display","none");s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(s||r){new MegaPixImage(t).render(K,{width:e,height:i,orientation:j},function(){X("#my-image").attr("src",K.toDataURL(W,Q));var t=new Image,e=J,i=tt;t.onload=function(){i/=2,((e/=2)<b||i<C)&&(e=b,i=C),new MegaPixImage(t).render(K,{width:e,height:i},function(){if(e<=b||i<=C)return Z(),"img-circle"==$imgActive.attr("class")?(X("#my-mask").css("-webkit-border-radius","500px"),X("#my-mask").css("-moz-border-radius","500px"),X("#my-mask").css("border-radius","500px")):(X("#my-mask").css("-webkit-border-radius","0px"),X("#my-mask").css("-moz-border-radius","0px"),X("#my-mask").css("border-radius","0px")),"img"==$imgActive.prop("tagName").toLowerCase()||(X("#btnZoomIn").click(),X("#btnZoomIn").click()),X("#divToolImgLoader").css("display","none"),X("#btnImageCancel").css("display","inline-block"),X("#btnZoomOut").css("display","inline-block"),X("#btnZoomIn").css("display","inline-block"),X("#btnImageMore").css("display","inline-block"),X("#btnChangeImage").css("display","inline-block"),void X(".overlay-bg").css("background","#fff");t.src=K.toDataURL(W,Q)})},t.src=K.toDataURL(W,Q)})}else{var M=K.getContext("2d");switch(4<j&&j<9?(K.width=i,K.height=e):(K.width=e,K.height=i),j){case 2:M.transform(-1,0,0,1,e,0);break;case 3:M.transform(-1,0,0,-1,e,i);break;case 4:M.transform(1,0,0,-1,0,i);break;case 5:M.transform(0,1,1,0,0,0);break;case 6:M.transform(0,1,-1,0,i,0);break;case 7:M.transform(0,-1,-1,0,i,e);break;case 8:M.transform(0,-1,1,0,0,e)}M.drawImage(t,0,0,e,i),X("#my-image").attr("src",K.toDataURL(W,Q));var $=new Image;c=J,m=tt;$.onload=function(){if(m/=2,((c/=2)<b||m<C)&&(c=b,m=C),K.width=c,K.height=m,(M=K.getContext("2d")).drawImage($,0,0,c,m),c<=b||m<=C)return Z(),"img-circle"==$imgActive.attr("class")?(X("#my-mask").css("-webkit-border-radius","500px"),X("#my-mask").css("-moz-border-radius","500px"),X("#my-mask").css("border-radius","500px")):(X("#my-mask").css("-webkit-border-radius","0px"),X("#my-mask").css("-moz-border-radius","0px"),X("#my-mask").css("border-radius","0px")),"img"==$imgActive.prop("tagName").toLowerCase()||(X("#btnZoomIn").click(),X("#btnZoomIn").click()),X("#divToolImgLoader").css("display","none"),X("#btnImageCancel").css("display","inline-block"),X("#btnZoomOut").css("display","inline-block"),X("#btnZoomIn").css("display","inline-block"),X("#btnImageMore").css("display","inline-block"),X("#btnChangeImage").css("display","inline-block"),void X(".overlay-bg").css("background","#fff");$.src=K.toDataURL(W,Q)},$.src=K.toDataURL(W,Q)}X("#btnImageMore").off("click"),X("#btnImageMore").on("click",function(){"block"==X("#divImageMore").css("display")?X("#divImageMore").css("display","none"):(X("#divImageMore").css("display","block"),X("#chkImageNoCrop").attr("checked",!1),0==$imgActive.parents("a:first").length?X("#chkImageClickToEnlarge").attr("checked",!1):-1==$imgActive.parents("a:first").attr("href").toLowerCase().indexOf(".jpg")&&-1==$imgActive.parents("a:first").attr("href").toLowerCase().indexOf(".png")||X("#chkImageClickToEnlarge").attr("checked",!0)),X(".overlay-bg").off("click"),X(".overlay-bg").on("click",function(){X("#divImageMore").css("display","none")}),X("#my-mask").off("click"),X("#my-mask").on("click",function(){X("#divImageMore").css("display","none")})}),X("#btnImageMoreOk").off("click"),X("#btnImageMoreOk").on("click",function(){if(X("#chkImageClickToEnlarge").is(":checked")){0==$imgActive.parents("a:first").length?$imgActive.wrap('<a href="#"></a>'):$imgActive.parents("a:first").attr("href","#"),$imgActive.parents("a:first").attr("title",""),$imgActive.parents("a:first").addClass("is-lightbox")}if(X("#chkImageNoCrop").is(":checked")){var t,e=document.getElementById("myTmpCanvasNoCrop");t=0==q&&("jpg"==_||"jpeg"==_)?e.toDataURL("image/jpeg",.92):e.toDataURL("image/png",1),"img"==$imgActive.prop("tagName").toLowerCase()?($imgActive.attr("src",t),$imgActive.data("filename",H)):"figure"==$imgActive.prop("tagName").toLowerCase()?($imgActive.find("img").attr("src",t),$imgActive.find("img").data("filename",H)):($imgActive.css("background-image","url(data:"+t+")"),$imgActive.data("filename",H)),$imgActive.parent().hasClass("is-lightbox")?(X("#canvasform").attr("action",G.data("imageembed").settings.largerImageHandler),X("#canvasform").submit()):X(".my-file[type=file]").clearInputs()}else X("#btnChangeImage").click();var i;X("#divImageEdit").css("display","none"),X(".overlay-bg").css("width","1px"),X(".overlay-bg").css("height","1px"),X("body").css("overflow",""),"img"==$imgActive.prop("tagName").toLowerCase()?($imgActive.css("width",""),$imgActive.css("height","")):"figure"==$imgActive.prop("tagName").toLowerCase()&&($imgActive.find("img").css("width",""),$imgActive.find("img").css("height","")),G.data("imageembed").settings.onChanged(),X("#divToolImgLoader").css("display","none"),X("#divImageMore").css("display","none"),G.parents().each(function(){X(this).data("contentbuilder")&&(i=X(this).data("contentbuilder"))}),X("#chkImageClickToEnlarge").is(":checked")||0<$imgActive.parents("a:first").length&&(-1==$imgActive.parents("a:first").attr("href").toLowerCase().indexOf(".jpg")&&-1==$imgActive.parents("a:first").attr("href").toLowerCase().indexOf(".png")||$imgActive.parents("a:first").replaceWith($imgActive.parents("a:first").html())),i&&(i.applyBehavior(),i.settings.onRender())}),X("#btnChangeImage").off("click"),X("#btnChangeImage").on("click",function(){var t,e=document.getElementById("myCanvas");$imgActive=X("#divToolImg").data("image"),t=0==q&&("jpg"==_||"jpeg"==_)?e.toDataURL("image/jpeg",.92):e.toDataURL("image/png",1),"img"==$imgActive.prop("tagName").toLowerCase()?($imgActive.attr("src",t),$imgActive.data("filename",H)):"figure"==$imgActive.prop("tagName").toLowerCase()?($imgActive.find("img").attr("src",t),$imgActive.find("img").data("filename",H)):($imgActive.css("background-image","url(data:"+t+")"),$imgActive.data("filename",H)),$imgActive.parent().hasClass("is-lightbox")&&""!=X("#fileImage").val()?(X("#canvasform").attr("action",G.data("imageembed").settings.largerImageHandler),X("#canvasform").submit()):X(".my-file[type=file]").clearInputs(),X("#divImageEdit").css("display","none"),X(".overlay-bg").css("width","1px"),X(".overlay-bg").css("height","1px"),X("body").css("overflow",""),"img"==$imgActive.prop("tagName").toLowerCase()?($imgActive.css("width",""),$imgActive.css("height","")):"figure"==$imgActive.prop("tagName").toLowerCase()&&($imgActive.find("img").css("width",""),$imgActive.find("img").css("height","")),G.data("imageembed").settings.onChanged(),X("#divImageMore").css("display","none")}),X("#btnImageCancel").off("click"),X("#btnImageCancel").on("click",function(){document.getElementById("myCanvas");$imgActive=X("#divToolImg").data("image"),X("#divImageEdit").css("display","none"),X(".overlay-bg").css("width","1px"),X(".overlay-bg").css("height","1px"),X("body").css("overflow",""),X("#divImageMore").css("display","none"),X(".my-file[type=file]").clearInputs()}),X("#btnZoomIn").off("click"),X("#btnZoomIn").on("click",function(){var t=parseInt(X("#my-image").css("width")),e=parseInt(X("#my-image").css("height"));X("#my-image").css("width",t/.9+"px"),X("#my-image").css("height",e/.9+"px"),V(),K.width=t/.9,K.height=e/.9;var i,o,a=X("#my-image")[0],n=(K.getContext("2d"),new Image);i=J,o=tt,n.src=a.src,n.onload=function(){if(o/=2,(i/=2)<a.width&&(i=t/.9),o<a.height&&(o=e/.9),K.width=i,K.height=o,K.getContext("2d").drawImage(n,0,0,i,o),i<=t/.9||o<=e/.9)return V(),void Z();n.src=K.toDataURL(W,Q)},Z()}),X("#btnZoomOut").off("click"),X("#btnZoomOut").on("click",function(){var t=parseInt(X("#my-image").css("width")),e=parseInt(X("#my-image").css("height"));if(!(t/1.1<X("#my-mask").width()||e/1.1<X("#my-mask").height())){X("#my-image").css("width",t/1.1+"px"),X("#my-image").css("height",e/1.1+"px"),V(),K.width=t/1.1,K.height=e/1.1;var i,o,a=X("#my-image")[0],n=(K.getContext("2d"),new Image);i=J,o=tt,n.src=a.src,n.onload=function(){if(o/=2,(i/=2)<a.width&&(i=t/1.1),o<a.height&&(o=e/1.1),K.width=i,K.height=o,K.getContext("2d").drawImage(n,0,0,i,o),i<=t/1.1||o<=e/1.1)return V(),void Z();n.src=K.toDataURL(W,Q)},Z()}})},{canvas:!1})})},Z=function(){var t=parseInt(X("#my-image").css("left"))-1.1,e=parseInt(X("#my-image").css("top"))-1.1,i=parseInt(X("#my-mask").css("width")),o=parseInt(X("#my-mask").css("height")),a=document.getElementById("myCanvas"),n=a.getContext("2d");a.width=i,a.height=o;var s=-1*t,r=-1*e;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){s=-1*t+(t-t/.7),r=-1*e+(e-e/.7)}r>K.height-o&&(r=K.height-o),s>K.width-i&&(s=K.width-i),n.drawImage(K,s,r,i,o,0,0,i,o)},V=function(){X("#my-image").css({top:0,left:0});var t=X("#my-mask").width(),e=X("#my-mask").height(),i=X("#my-image").offset(),o=X("#my-image").width(),a=X("#my-image").height(),n=i.left+t-o,s=i.top+e-a,r=i.left,l=i.top;X("#my-image").draggable({revert:!1,containment:[n,s,r,l],scroll:!1,drag:function(){Z()}}),X("#my-image").css({cursor:"move"})};this.init()},X.fn.imageembed=function(e){return this.each(function(){if(null==X(this).data("imageembed")){var t=new X.imageembed(this,e);X(this).data("imageembed",t)}})}}(jQuery),jQuery.fn.clearFields=jQuery.fn.clearInputs=function(i){var o=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,e=this.tagName.toLowerCase();o.test(t)||"textarea"==e?this.value="":"checkbox"==t||"radio"==t?this.checked=!1:"select"==e?this.selectedIndex=-1:"file"==t?/MSIE/.test(navigator.userAgent)?jQuery(this).replaceWith(jQuery(this).clone(!0)):jQuery(this).val(""):i&&(!0===i&&/hidden/.test(t)||"string"==typeof i&&jQuery(this).is(i))&&(this.value="")})};var zindex=1e4;function saveForUndo(){var i=!1;jQuery(cb_list).each(function(){var t=jQuery(this),e=t.data("contentbuilder");e.undoList[0]?t.html()!=e.undoList[0][0]&&(i=!0):i=!0}),i&&jQuery(cb_list).each(function(){for(var e,i=jQuery(this),o=i.data("contentbuilder"),t=20;1<t;t--)o.undoList[t-1]=o.undoList[t-2];if(window.getSelection)try{e=window.getSelection().getRangeAt(0),o.undoList[0]=[i.html(),e.cloneRange()]}catch(t){o.undoList[0]=[i.html(),null]}else if(document.selection)try{e=document.selection.createRange();var a=document.selection.type;"Text"==a?o.undoList[0]=[i.html(),e.getBookmark(),"Text"]:"Control"==a?(e.item(0).selThis="selThis",o.undoList[0]=[i.html(),null,"Control"],e.item(0).removeAttribute("selThis",0)):o.undoList[0]=[i.html(),e.getBookmark(),"None"]}catch(t){"Text"==a?o.undoList[0]=[i.html(),null,"Text"]:"Control"==a?(e.item(0).selThis="selThis",o.undoList[0]=[i.html(),null,"Control"],e.item(0).removeAttribute("selThis",0)):o.undoList[0]=[i.html(),null,"None"]}o.redoList=[]})}!function(r){r.simplemodal=function(t,e){var i={onCancel:function(){},onFinish:function(){},isModal:!1,noOverlay:!1};this.settings={};var n,s=r(t);t=t;this.init=function(){this.settings=r.extend({},i,e),0==r("#divCb").length&&r("body").append('<div id="divCb"></div>')},this.hide=function(){s.css("display","none"),s.removeClass("md-show"),this.settings.noOverlay||n.remove(),zindex-=2,s.data("simplemodal").settings.onFinish()},this.show=function(t){if(zindex+=1,!this.settings.noOverlay){var e=makeid(),i='<div id="md-overlay-'+e+'" class="md-overlay" style="z-index:'+zindex+'"></div>';this.settings.isModal&&(i='<div id="md-overlay-'+e+'" class="md-overlay" style="z-index:'+zindex+';background:rgba(0, 0, 0, 0.1)"></div>'),r("#divCb").append(i),n=r("#md-overlay-"+e)}if(zindex+=1,s.css("z-index",zindex),s.addClass("md-show"),s.stop(!0,!0).css("display","none").fadeIn(200),s.hasClass("md-draggable")){var o=parseInt(s.css("width")),a=parseInt(s.css("height"));s.css("top",Math.max(0,(r(window).height()-a)/2)+"px"),s.css("left",Math.max(0,(r(window).width()-o)/2)+"px"),0<s.find(".md-modal-handle").length?(s.find(".md-modal-handle").css("cursor","move"),s.draggable({handle:".md-modal-handle"})):s.draggable()}if(0<s.find(".md-modal-close").length&&s.find(".md-modal-close").click(function(){s.data("simplemodal").hide()}),!this.settings.noOverlay){t=t;r("#md-overlay-"+e).off("click"),r("#md-overlay-"+e).click(function(){s.data("simplemodal").settings.isModal||(s.stop(!0,!0).fadeOut(100,function(){s.removeClass("md-show")}),n.remove(),zindex-=2,t&&restoreSelection(t),s.data("simplemodal").settings.onCancel())})}},this.init()},r.fn.simplemodal=function(e){return this.each(function(){if(null==r(this).data("simplemodal")){var t=new r.simplemodal(this,e);r(this).data("simplemodal",t)}})}}(jQuery),jQuery(document).keydown(function(t){90===t.which&&t.ctrlKey&&(t.shiftKey?doRedo():t.altKey||doUndo()),89===t.which&&t.ctrlKey&&(t.altKey||doRedo())});var numUndo=0;function doUndo(){var i=!1;if(jQuery(cb_list).each(function(){var t=jQuery(this),e=t.data("contentbuilder");e.undoList[0]?t.html()!=e.undoList[0][0]&&(i=!0):i=!0}),jQuery(cb_list).each(function(){var e=jQuery(this),i=e.data("contentbuilder");if(i.undoList[0]){for(var t=20;1<t;t--)i.redoList[t-1]=i.redoList[t-2];var o;if(window.getSelection)try{o=window.getSelection().getRangeAt(0),i.redoList[0]=[e.html(),o.cloneRange()]}catch(t){i.redoList[0]=[e.html(),null]}else if(document.selection){o=document.selection.createRange();var a=document.selection.type;"Text"==a?i.redoList[0]=[e.html(),o.getBookmark(),"Text"]:"Control"==a?(o.item(0).selThis="selThis",i.redoList[0]=[e.html(),null,"Control"],o.item(0).removeAttribute("selThis",0)):i.redoList[0]=[e.html(),o.getBookmark(),"None"]}sHTML=i.undoList[0][0],e.html(sHTML);for(t=0;t<19;t++)i.undoList[t]=i.undoList[t+1];i.undoList[19]=null,i.applyBehavior(),i.blockChanged(),i.settings.onRender()}}),0==i&&numUndo<1)return numUndo+=1,void doUndo();numUndo=0}function doRedo(){jQuery(cb_list).each(function(){var e=jQuery(this),i=e.data("contentbuilder");if(i.redoList[0]){for(var t=20;1<t;t--)i.undoList[t-1]=i.undoList[t-2];var o;if(window.getSelection)try{o=window.getSelection().getRangeAt(0),i.undoList[0]=[e.html(),o.cloneRange()]}catch(t){i.undoList[0]=[e.html(),null]}else if(document.selection){o=document.selection.createRange();var a=document.selection.type;"Text"==a?i.undoList[0]=[e.html(),o.getBookmark(),"Text"]:"Control"==a?(o.item(0).selThis="selThis",i.undoList[0]=[e.html(),null,"Control"],o.item(0).removeAttribute("selThis",0)):i.undoList[0]=[e.html(),o.getBookmark(),"None"]}sHTML=i.redoList[0][0],e.html(sHTML);for(t=0;t<19;t++)i.redoList[t]=i.redoList[t+1];i.redoList[19]=null,i.applyBehavior(),i.blockChanged(),i.settings.onRender()}})}function cleanHTML(t){var e=t.replace(/(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/g," "),i=new RegExp("\x3c!--(.*?)--\x3e","g"),o=(e=e.replace(i,""),new RegExp("<(/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>","gi"));e=e.replace(o,"");for(var a=["style","script","applet","embed","noframes","noscript"],n=0;n<a.length;n++)o=new RegExp("<"+a[n]+".*?"+a[n]+"(.*?)>","gi"),e=e.replace(o,"");var s=["style","start"];for(n=0;n<s.length;n++){var r=new RegExp(" "+s[n]+'="(.*?)"',"gi");e=e.replace(r,"")}return e}function selectRange(t){if(t)if(void 0!==t.select)t.select();else if(void 0!==window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}}function selectElementContents(t){var e=document.createRange();e.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges(),i.addRange(e)}function isEven(t){return t%2==0}function getCellIndex(t,e,i){for(var o=0,a=!1,n=0;n<e.cells.length;n++)0==a&&(o+=e.cells[n].colSpan),i==e.cells[n]&&(a=!0);return(o-=i.colSpan-1)-1}function detectIE(){var t=window.navigator.userAgent,e=t.indexOf("MSIE "),i=t.indexOf("Trident/"),o=t.indexOf("Edge/");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<o)return parseInt(t.substring(o+5,t.indexOf(".",o)),10);if(0<i){var a=t.indexOf("rv:");return parseInt(t.substring(a+3,t.indexOf(".",a)),10)}return!1}function detectEdge(){var t=window.navigator.userAgent,e=t.indexOf("Edge/");return 0<e&&parseInt(t.substring(e+5,t.indexOf(".",e)),10)}jQuery.fn.getPos=function(){var t=this[0],e=0,i=0,o=null;o=t.offsetParent;for(var a=t,n=t;null!=n.parentNode;){if(null!=(n=n.parentNode).offsetParent){var s=!0;window.opera&&(n!=a.parentNode&&"TR"!=n.nodeName||(s=!1)),s&&(n.scrollTop&&0<n.scrollTop&&(i-=n.scrollTop),n.scrollLeft&&0<n.scrollLeft&&(e-=n.scrollLeft))}n==o&&(e+=t.offsetLeft,n.clientLeft&&"TABLE"!=n.nodeName&&(e+=n.clientLeft),i+=t.offsetTop,n.clientTop&&"TABLE"!=n.nodeName&&(i+=n.clientTop),null==(t=n).offsetParent&&(t.offsetLeft&&(e+=t.offsetLeft),t.offsetTop&&(i+=t.offsetTop)),o=t.offsetParent)}return{left:e,top:i}},jQuery.fn.contrastingText=function(){var t,e=this;for(t=function(t){var e=t.match(/[0-9]+/g);return null!==e&&!!e[3]};t(e.css("background-color"));)e=e.parent();return parts=e.css("background-color").match(/[0-9]+/g),this.lightBackground=!!Math.round((parseInt(parts[0],10)+parseInt(parts[1],10)+parseInt(parts[2],10))/765),this.lightBackground?this.css("color","black"):this.css("color","rgba(255, 255, 255, 0.7)"),this},getScripts([sScriptPath+"codemirror/lib/codemirror.js"],function(){getScripts([sScriptPath+"codemirror/mode/xml/xml.js",sScriptPath+"codemirror/mode/javascript/javascript.js",sScriptPath+"codemirror/mode/css/css.js"],function(){jQuery("body").addClass("is-cmloaded")})}),eval(function(t,e,i,o,a,n){if(a=function(t){return(t<62?"":a(parseInt(t/62)))+(35<(t%=62)?String.fromCharCode(t+29):t.toString(36))},!"".replace(/^/,String)){for(;i--;)n[a(i)]=o[i]||a(i);o=[function(t){return n[t]}],a=function(){return"\\w+"},i=1}for(;i--;)o[i]&&(t=t.replace(new RegExp("\\b"+a(i)+"\\b","g"),o[i]));return t}("(n(){n 1n(h){9 p=h.U,m=h.M;f(p*m>1b*1b){9 e=O.Q('e');e.a=e.b=1;9 c=e.W('X');c.12(h,-p+1,0);y c.1h(0,0,1,1).11[3]===0}x{y 1Z}}n 1p(h,p,m){9 e=O.Q('e');e.a=1;e.b=m;9 c=e.W('X');c.12(h,0,0);9 11=c.1h(0,0,1,m).11;9 r=0;9 16=m;9 s=m;17(s>r){9 1q=11[(s-1)*4+3];f(1q===0){16=s}x{r=s}s=(16+r)>>1}9 18=(s/m);y(18===0)?1:18}n 1j(h,j,v){9 e=O.Q('e');1c(h,e,j,v);y e.1X(\"1v/1w\",j.1V||0.8)}n 1c(h,e,j,v){9 p=h.U,m=h.M;f(!(p+m))y;9 a=j.a,b=j.b;9 c=e.W('X');c.1U();1i(e,c,a,b,j.10);9 1k=1n(h);f(1k){p/=2;m/=2}9 d=1b;9 F=O.Q('e');F.a=F.b=d;9 Z=F.W('X');9 1u=v?1p(h,p,m):1;9 1d=w.1x(d*a/p);9 14=w.1x(d*b/m/1u);9 r=0;9 1a=0;17(r<m){9 P=0;9 19=0;17(P<p){Z.1S(0,0,d,d);Z.12(h,-P,-r);c.12(F,0,0,d,d,19,1a,1d,14);P+=d;19+=1d}r+=d;1a+=14}c.1Q();F=Z=T}n 1i(e,c,a,b,10){1m(10){o 5:o 6:o 7:o 8:e.a=b;e.b=a;q;1r:e.a=a;e.b=b}1m(10){o 2:c.C(a,0);c.Y(-1,1);q;o 3:c.C(a,b);c.L(w.G);q;o 4:c.C(0,b);c.Y(1,-1);q;o 5:c.L(0.5*w.G);c.Y(1,-1);q;o 6:c.L(0.5*w.G);c.C(0,-b);q;o 7:c.L(0.5*w.G);c.C(a,-b);c.Y(-1,1);q;o 8:c.L(-0.5*w.G);c.C(-a,0);q;1r:q}}9 t=u.t&&u.t.13?u.t:u.15&&u.15.13?u.15:T;n E(l){f(u.1l&&l 1P 1l){f(!t){1N 1M(\"1L 13 n 1K 1I 1H A 1G\");}9 h=1D 1C();h.1e=t.13(l);g.A=l;l=h}f(!l.U&&!l.M){9 I=g;l.1O=l.1B=n(){9 S=I.H;f(S){I.H=T;1y(9 i=0,1t=S.1E;i<1t;i++){S[i]()}}};g.H=[]}g.l=l}E.1F.1s=n(z,j,N){f(g.H){9 I=g;g.H.1J(n(){I.1s(z,j,N)});y}j=j||{};9 B=g.l.U,D=g.l.M,a=j.a,b=j.b,J=j.J,K=j.K,v=!g.A||g.A.1A==='1v/1w';f(a&&!b){b=(D*a/B)<<0}x f(b&&!a){a=(B*b/D)<<0}x{a=B;b=D}f(J&&a>J){a=J;b=(D*a/B)<<0}f(K&&b>K){b=K;a=(B*b/D)<<0}9 V={a:a,b:b};1y(9 k 1R j)V[k]=j[k];9 R=z.R.1T();f(R==='h'){z.1e=1j(g.l,V,v)}x f(R==='e'){1c(g.l,z,V,v)}f(1g g.1z==='n'){g.1z(z)}f(N){N()}f(g.A){g.A=T;t.1W(g.l.1e)}};f(1g 1f==='n'&&1f.1Y){1f([],n(){y E})}x f(1g 1o==='20'){21.1o=E}x{g.E=E}})();",0,126,"|||||||||var|width|height|ctx||canvas|if|this|img||options||srcImage|ih|function|case|iw|break|sy|py|URL|window|doSquash|Math|else|return|target|blob|imgWidth|translate|imgHeight|MegaPixImage|tmpCanvas|PI|imageLoadListeners|_this|maxWidth|maxHeight|rotate|naturalHeight|callback|document|sx|createElement|tagName|listeners|null|naturalWidth|opt|getContext|2d|scale|tmpCtx|orientation|data|drawImage|createObjectURL|dh|webkitURL|ey|while|ratio|dx|dy|1024|renderImageToCanvas|dw|src|define|typeof|getImageData|transformCoordinate|renderImageToDataURL|subsampled|Blob|switch|detectSubsampling|exports|detectVerticalSquash|alpha|default|render|len|vertSquashRatio|image|jpeg|ceil|for|onrender|type|onerror|Image|new|length|prototype|url|create|to|push|found|No|Error|throw|onload|instanceof|restore|in|clearRect|toLowerCase|save|quality|revokeObjectURL|toDataURL|amd|false|object|module".split("|"),0,{})),eval(function(t,e,i,o,a,n){if(a=function(t){return(t<62?"":a(parseInt(t/62)))+(35<(t%=62)?String.fromCharCode(t+29):t.toString(36))},!"".replace(/^/,String)){for(;i--;)n[a(i)]=o[i]||a(i);o=[function(t){return n[t]}],a=function(){return"\\w+"},i=1}for(;i--;)o[i]&&(t=t.replace(new RegExp("\\b"+a(i)+"\\b","g"),o[i]));return t}("(7(4){4.w.8='H'G p;c(!4.w.8){f}d 6=4.U.D.L,g=6.g,h=6.h,a;7 5(2,r){c(2.k.F.J>1){f}2.B();d 8=2.k.q[0],l=p.N('O');l.S(r,i,i,V,1,8.W,8.X,8.Y,8.A,b,b,b,b,0,C);2.z.E(l)}6.m=7(2){d 3=e;c(a||!3.I(2.k.q[0])){f}a=i;3.j=b;5(2,'K');5(2,'s');5(2,'M')};6.n=7(2){c(!a){f}e.j=i;5(2,'s')};6.o=7(2){c(!a){f}5(2,'P');5(2,'Q');c(!e.j){5(2,'R')}a=b};6.g=7(){d 3=e;3.u.T({v:4.9(3,'m'),x:4.9(3,'n'),y:4.9(3,'o')});g.t(3)};6.h=7(){d 3=e;3.u.Z({v:4.9(3,'m'),x:4.9(3,'n'),y:4.9(3,'o')});h.t(3)}})(4);",0,62,"||event|self|jQuery|simulateMouseEvent|mouseProto|function|touch|proxy|touchHandled|false|if|var|this|return|_mouseInit|_mouseDestroy|true|_touchMoved|originalEvent|simulatedEvent|_touchStart|_touchMove|_touchEnd|document|changedTouches|simulatedType|mousemove|call|element|touchstart|support|touchmove|touchend|target|clientY|preventDefault|null|mouse|dispatchEvent|touches|in|ontouchend|_mouseCapture|length|mouseover|prototype|mousedown|createEvent|MouseEvents|mouseup|mouseout|click|initMouseEvent|bind|ui|window|screenX|screenY|clientX|unbind".split("|"),0,{})),function(t,e){"object"==typeof exports?module.exports=e(t):"function"==typeof define&&define.amd?define("colors",[],function(){return e(t)}):t.Colors=e(t)}(this,function(t,d){"use strict";function n(t,e,i,o,a){if("string"==typeof e)i=(e=$.txt2color(e)).type,M[i]=e[i],a=a!==d?a:e.alpha;else if(e)for(var n in e)t[i][n]=r(e[n]/z[i][n][1],0,1);return a!==d&&(t.alpha=r(+a,0,1)),s(i,o?t:d)}function s(t,e){var i,o,a,n,s,r,l,d,c=e||M,m=$,p=F.options,g=z,h=c.RND,f="",u="",v={hsl:"hsv",rgb:t},b=h.rgb;if("alpha"!==t){for(var C in g)if(!g[C][C])for(f in t!==C&&(u=v[C]||"rgb",c[C]=m[u+"2"+C](c[u])),h[C]||(h[C]={}),i=c[C])h[C][f]=U(i[f]*g[C][f][1]);b=h.rgb,c.HEX=m.RGB2HEX(b),c.equivalentGrey=p.grey.r*c.rgb.r+p.grey.g*c.rgb.g+p.grey.b*c.rgb.b,c.webSave=o=E(b,51),c.webSmart=a=E(b,17),c.saveColor=b.r===o.r&&b.g===o.g&&b.b===o.b?"web save":b.r===a.r&&b.g===a.g&&b.b===a.b?"web smart":"",c.hueRGB=$.hue2RGB(c.hsv.h),e&&(c.background=(n=b,s=c.rgb,r=c.alpha,l=F.options.grey,(d={}).RGB={r:n.r,g:n.g,b:n.b},d.rgb={r:s.r,g:s.g,b:s.b},d.alpha=r,d.equivalentGrey=U(l.r*n.r+l.g*n.g+l.b*n.b),d.rgbaMixBlack=N(s,{r:0,g:0,b:0},r,1),d.rgbaMixWhite=N(s,{r:1,g:1,b:1},r,1),d.rgbaMixBlack.luminance=B(d.rgbaMixBlack,!0),d.rgbaMixWhite.luminance=B(d.rgbaMixWhite,!0),F.options.customBG&&(d.rgbaMixCustom=N(s,F.options.customBG,r,1),d.rgbaMixCustom.luminance=B(d.rgbaMixCustom,!0),F.options.customBG.luminance=B(F.options.customBG,!0)),d))}var w,y,x,k,S,I,T,A,L=c.rgb,R=c.alpha,O="luminance",P=c.background;return(w=N(L,{r:0,g:0,b:0},R,1))[O]=B(w,!0),c.rgbaMixBlack=w,(y=N(L,{r:1,g:1,b:1},R,1))[O]=B(y,!0),c.rgbaMixWhite=y,p.customBG&&((x=N(L,P.rgbaMixCustom,R,1))[O]=B(x,!0),x.WCAG2Ratio=(T=x[O],A=P.rgbaMixCustom[O],U(100*(A<=T?(T+.05)/(A+.05):(A+.05)/(T+.05)))/100),(c.rgbaMixBGMixCustom=x).luminanceDelta=D.abs(x[O]-P.rgbaMixCustom[O]),x.hueDelta=(k=P.rgbaMixCustom,S=x,I=!0,(D.max(k.r-S.r,S.r-k.r)+D.max(k.g-S.g,S.g-k.g)+D.max(k.b-S.b,S.b-k.b))*(I?255:1)/765)),c.RGBLuminance=B(b),c.HUELuminance=B(c.hueRGB),p.convertCallback&&p.convertCallback(c,t),c}function E(t,e){var i={},o=0,a=e/2;for(var n in t)o=t[n]%e,i[n]=t[n]+(a<o?e-o:-o);return i}function B(t,e){for(var i=e?1:255,o=[t.r/i,t.g/i,t.b/i],a=F.options.luminance,n=o.length;n--;)o[n]=o[n]<=.03928?o[n]/12.92:D.pow((o[n]+.055)/1.055,2.4);return a.r*o[0]+a.g*o[1]+a.b*o[2]}function N(t,e,i,o){var a={},n=i!==d?i:1,s=o!==d?o:1,r=n+s*(1-n);for(var l in t)a[l]=(t[l]*n+e[l]*s*(1-n))/r;return a.a=r,a}function r(t,e,i){return i<t?i:t<e?e:t}var z={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},D=t.Math,U=D.round,F={},M={},e={r:.298954,g:.586434,b:.114612},i={r:.2126,g:.7152,b:.0722},o=function(t){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:e,luminance:i,valueRanges:z},a(this,t||{})},a=function(t,e){var i,o=t.options;for(var a in l(t),e)e[a]!==d&&(o[a]=e[a]);i=o.customBG,o.customBG="string"==typeof i?$.txt2color(i).rgb:i,M=n(t.colors,o.color,d,!0)},l=function(t){F!==t&&(M=(F=t).colors)};o.prototype.setColor=function(t,e,i){return l(this),t?n(this.colors,t,e,d,i):(i!==d&&(this.colors.alpha=r(i,0,1)),s(e))},o.prototype.setCustomBackground=function(t){return l(this),this.options.customBG="string"==typeof t?$.txt2color(t).rgb:t,n(this.colors,d,"rgb")},o.prototype.saveAsBackground=function(){return l(this),n(this.colors,d,"rgb",!0)},o.prototype.toString=function(t,e){return $.color2text((t||"rgb").toLowerCase(),this.colors,e)};var $={txt2color:function(t){var e={},i=t.replace(/(?:#|\)|%)/g,"").split("("),o=(i[1]||"").split(/,\s*/),a=i[1]?i[0].substr(0,3):"rgb",n="";if(e.type=a,e[a]={},i[1])for(var s=3;s--;)n=a[s]||a.charAt(s),e[a][n]=+o[s]/z[a][n][1];else e.rgb=$.HEX2rgb(i[0]);return e.alpha=o[3]?+o[3]:1,e},color2text:function(t,e,i){var o=!1!==i&&U(100*e.alpha)/100,a="number"==typeof o&&!1!==i&&(i||1!==o),n=e.RND.rgb,s=e.RND.hsl,r="hex"===t&&a,l="hex"===t&&!r,d="rgb"===t||r?n.r+", "+n.g+", "+n.b:l?"#"+e.HEX:s.h+", "+s.s+"%, "+s.l+"%";return l?d:(r?"rgb":t)+(a?"a":"")+"("+d+(a?", "+o:"")+")"},RGB2HEX:function(t){return((t.r<16?"0":"")+t.r.toString(16)+(t.g<16?"0":"")+t.g.toString(16)+(t.b<16?"0":"")+t.b.toString(16)).toUpperCase()},HEX2rgb:function(t){return{r:+("0x"+(t=t.split(""))[0]+t[t[3]?1:0])/255,g:+("0x"+t[t[3]?2:1]+(t[3]||t[1]))/255,b:+("0x"+(t[4]||t[2])+(t[5]||t[2]))/255}},hue2RGB:function(t){var e=6*t,i=~~e%6,o=6===e?0:e-i;return{r:U(255*[1,1-o,0,0,o,1][i]),g:U(255*[o,1,1,1-o,0,0][i]),b:U(255*[0,0,o,1,1,1-o][i])}},rgb2hsv:function(t){var e,i,o=t.r,a=t.g,n=t.b,s=0;return a<n&&(a=n+(n=a,0),s=-1),i=n,o<a&&(o=a+(a=o,0),s=-2/6-s,i=D.min(a,n)),e=o-i,{h:(o?e/o:0)<1e-15?M&&M.hsl&&M.hsl.h||0:e?D.abs(s+(a-n)/(6*e)):0,s:o?e/o:M&&M.hsv&&M.hsv.s||0,v:o}},hsv2rgb:function(t){var e=6*t.h,i=t.s,o=t.v,a=~~e,n=e-a,s=o*(1-i),r=o*(1-n*i),l=o*(1-(1-n)*i),d=a%6;return{r:[o,r,s,s,l,o][d],g:[l,o,o,r,s,s][d],b:[s,s,l,o,o,r][d]}},hsv2hsl:function(t){var e=(2-t.s)*t.v,i=t.s*t.v;return i=t.s?e<1?e?i/e:0:i/(2-e):0,{h:t.h,s:t.v||i?i:M&&M.hsl&&M.hsl.s||0,l:e/2}},rgb2hsl:function(t,e){var i=$.rgb2hsv(t);return $.hsv2hsl(e?i:M.hsv=i)},hsl2rgb:function(t){var e=6*t.h,i=t.s,o=t.l,a=o<.5?o*(1+i):o+i-i*o,n=o+o-a,s=~~e,r=a*(a?(a-n)/a:0)*(e-s),l=n+r,d=a-r,c=s%6;return{r:[a,d,n,n,l,a][c],g:[l,a,a,d,n,n][c],b:[n,n,l,a,a,d][c]}}};return o}),function(i,o){"object"==typeof exports?module.exports=o(i,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(t,e){return o(i,t,e)}):o(i,i.jQuery,i.Colors)}(this,function(n,s,e,f){"use strict";function r(t){return t.value||t.getAttribute("value")||s(t).css("background-color")||"#FFF"}function a(t){return(t=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches[0]:t).originalEvent?t.originalEvent:t}function l(t){return s(t.find(b.doRender)[0]||t[0])}function i(t){var e=s(this),i=e.offset(),o=s(n),a=b.gap;t?((C=l(e))._colorMode=C.data("colorMode"),g.$trigger=e,(h||(s("head")[b.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(b.css||N)+(b.cssAddon||"")+"</style>"),s(B).css({margin:b.margin}).appendTo("body").show(0,function(){g.$UI=h=s(this),P=b.GPU&&h.css("perspective")!==f,w=s(".cp-z-slider",this),y=s(".cp-xy-slider",this),x=s(".cp-xy-cursor",this),k=s(".cp-z-cursor",this),S=s(".cp-alpha",this),I=s(".cp-alpha-cursor",this),b.buildCallback.call(g,h),h.prepend("<div>").children().eq(0).css("width",h.children().eq(0).width()),h._width=this.offsetWidth,h._height=this.offsetHeight}).hide())).css(b.positionCallback.call(g,e)||{left:(h._left=i.left)-(0<(h._left+=h._width-(o.scrollLeft()+o.width()))+a?h._left+a:0),top:(h._top=i.top+e.outerHeight())-(0<(h._top+=h._height-(o.scrollTop()+o.height()))+a?h._top+a:0)}).show(b.animationSpeed,function(){!0!==t&&(S.toggle(!!b.opacity)._width=S.width(),y._width=y.width(),y._height=y.height(),w._height=w.height(),v.setColor(r(C[0])),p(!0))}).off(".tcp").on(R,".cp-xy-slider,.cp-z-slider,.cp-alpha",d)):g.$trigger&&s(h).hide(b.animationSpeed,function(){p(!1),g.$trigger=null}).off(".tcp")}function d(t){var e=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");1<(t.button||t.which)||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,C._offset=s(this).offset(),(e="xy_slider"===e?o:"z_slider"===e?c:m)(t),p(),T.on(O,function(){T.off(".tcp")}).on(L,function(t){e(t),p()}))}function o(t){var e=a(t),i=e.pageX-C._offset.left,o=e.pageY-C._offset.top;v.setColor({s:i/y._width*100,v:100-o/y._height*100},"hsv")}function c(t){var e=a(t).pageY-C._offset.top;v.setColor({h:360-e/w._height*360},"hsv")}function m(t){var e=(a(t).pageX-C._offset.left)/S._width;v.setColor({},"rgb",e)}function p(t){var e=v.colors,i=e.hueRGB,o=(e.RND.rgb,e.RND.hsl,b.dark),a=b.light,n=v.toString(C._colorMode,b.forceAlpha),s=.22<e.HUELuminance?o:a,r=.22<e.rgbaMixBlack.luminance?o:a,l=(1-e.hsv.h)*w._height,d=e.hsv.s*y._width,c=(1-e.hsv.v)*y._height,m=e.alpha*S._width,p=P?"translate3d":"",g=C[0].value,h=C[0].hasAttribute("value")&&""===g&&t!==f;y._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},x._css={transform:p+"("+d+"px, "+c+"px, 0)",left:P?"":d,top:P?"":c,borderColor:.22<e.RGBLuminance?o:a},k._css={transform:p+"(0, "+l+"px, 0)",top:P?"":l,borderColor:"transparent "+s},S._css={backgroundColor:"#"+e.HEX},I._css={transform:p+"("+m+"px, 0, 0)",left:P?"":m,borderColor:r+" transparent"},C._css={backgroundColor:h?"":n,color:h?"":.22<e.rgbaMixBGMixCustom.luminance?o:a},C.text=h?"":g!==n?n:"",t!==f?u(t):E(u)}function u(t){y.css(y._css),x.css(x._css),k.css(k._css),S.css(S._css),I.css(I._css),b.doRender&&C.css(C._css),C.text&&C.val(C.text),b.renderCallback.call(g,C,"boolean"==typeof t?t:f)}var g,v,b,C,h,w,y,x,k,S,I,T=s(document),A=s(),L="touchmove.tcp mousemove.tcp pointermove.tcp",R="touchstart.tcp mousedown.tcp pointerdown.tcp",O="touchend.tcp mouseup.tcp pointerup.tcp",P=!1,E=n.requestAnimationFrame||n.webkitRequestAnimationFrame||function(t){t()},B='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',N=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",z=function(t){v=this.color=new e(t),b=v.options,g=this};z.prototype={render:p,toggle:i},s.fn.colorPicker=function(o){var e=this,t=function(){};return o=s.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:t,buildCallback:t,positionCallback:t,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},o),!g&&o.scrollResize&&s(n).on("resize.tcp scroll.tcp",function(){g.$trigger&&g.toggle.call(g.$trigger[0],!0)}),A=A.add(this),this.colorPicker=g||new z(o),this.options=o,s(o.body).off(".tcp").on(R,function(t){-1===A.add(h).add(s(h).find(t.target)).index(t.target)&&i()}),this.on("focusin.tcp click.tcp",function(t){g.color.options=s.extend(g.color.options,b=e.options),i.call(this,t)}).on("change.tcp",function(){v.setColor(this.value||"#FFF"),e.colorPicker.render(!0)}).each(function(){var t=r(this),e=t.split("("),i=l(s(this));i.data("colorMode",e[1]?e[0].substr(0,3):"HEX").attr("readonly",b.preventFocus),o.doRender&&i.css({"background-color":t,color:function(){return.22<v.setColor(t).rgbaMixBGMixCustom.luminance?o.dark:o.light}})})},s.fn.colorPicker.destroy=function(){s("*").off(".tcp"),g.toggle(!1),A=s()}});